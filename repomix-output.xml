This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.claude/
  settings.local.json
.github/
  workflows/
    deploy.yml
functions/
  .gitignore
  index.js
  package.json
scripts/
  validate-env.cjs
src/
  modules/
    dashboard/
      dashboard-controller.js
      dashboard-service.js
      dashboard-ui.js
    messaging/
      messaging-controller.js
      messaging-service.js
      messaging-ui.js
    navigation/
      navigation.js
    programmer/
      programmer-dashboard.js
      programmer-profile.js
    recommendations/
      recommendations.js
    search/
      search-controller.js
      search-data.js
      search-ui.js
      search-visibility-fix.js
    settings/
      user-settings.js
  services/
    auth.js
    data.js
    firebase.js
  ui/
    toast.js
    ui.js
    view-renderers.js
  utils/
    checkbox-helpers.js
    store.js
    translations.js
.gitignore
firebase.json
firestore.indexes.json
firestore.rules
index.html
main.js
package.json
postcss.config.js
REFACTOR_SUMMARY.md
seed-test-data-local.js
seed-test-data.js
storage.rules
style.css
tailwind.config.js
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".claude/settings.local.json">
{
  "permissions": {
    "allow": [
      "Bash(npm run dev:*)",
      "Bash(node:*)",
      "Bash(curl:*)",
      "Bash(ls:*)",
      "Bash(cat:*)",
      "Bash(grep:*)",
      "Bash(ping:*)",
      "Bash(nc -zv -w 5 community.dansdichterdans.be 21:*)",
      "WebFetch(domain:community.dansdichterdans.be)",
      "Bash(md5:*)",
      "Bash(zip:*)",
      "Bash(firebase use:*)",
      "Bash(npm i:*)",
      "Bash(sudo npm i:*)",
      "Bash(awk:*)",
      "Bash(git add:*)",
      "Bash(git commit -m \"$\\(cat <<''EOF''\nRefactor: Move artist-dashboard HTML to JS render function\n\n- Create renderArtistDashboard\\(\\) function in artist-dashboard.js\n- Replace static HTML in index.html with empty container\n- Call renderArtistDashboard\\(\\) from ui.js when showing artist dashboard\n- Maintains all existing functionality while improving code organization\n\nü§ñ Generated with [Claude Code]\\(https://claude.com/claude-code\\)\n\nCo-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git commit -m \"$\\(cat <<''EOF''\nRefactor: Move programmer-dashboard HTML to JS render function\n\n- Create renderProgrammerDashboard\\(\\) function in programmer-dashboard.js\n- Replace static HTML in index.html with empty container\n- Call renderProgrammerDashboard\\(\\) from ui.js when showing programmer dashboard\n- Maintains all existing functionality while improving code organization\n\nü§ñ Generated with [Claude Code]\\(https://claude.com/claude-code\\)\n\nCo-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(firebase deploy:*)",
      "Bash(npm run build:*)",
      "Bash(git commit:*)",
      "Bash(find:*)",
      "Bash(git push:*)",
      "Bash(git revert:*)",
      "Bash(git checkout:*)",
      "Bash(mv:*)",
      "Bash(npm run build:staging:*)",
      "Bash(npm run build:prod:*)",
      "Bash(npm run dev:staging:*)",
      "Bash(npm run:*)",
      "Bash(tree:*)",
      "Bash(wc:*)",
      "Bash(rm:*)",
      "Bash(test:*)",
      "Bash(mkdir:*)"
    ]
  }
}
</file>

<file path="functions/.gitignore">
node_modules/
*.local
</file>

<file path="functions/package.json">
{
  "name": "functions",
  "description": "Cloud Functions for Firebase",
  "scripts": {
    "serve": "firebase emulators:start --only functions",
    "shell": "firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "20"
  },
  "main": "index.js",
  "dependencies": {
    "firebase-admin": "^12.0.0",
    "firebase-functions": "^5.0.0"
  },
  "devDependencies": {},
  "private": true
}
</file>

<file path="scripts/validate-env.cjs">
#!/usr/bin/env node

/**
 * Build Guard: Pre-build Environment Validation
 *
 * This script validates that all required VITE_ environment variables
 * are present before allowing the build to proceed.
 *
 * Usage:
 *   node scripts/validate-env.js staging
 *   node scripts/validate-env.js production
 */

const fs = require('fs');
const path = require('path');

// Get the mode from command line argument
const mode = process.argv[2];

if (!mode) {
  console.error('‚ùå ERROR: Mode argument is required (staging or production)');
  console.error('Usage: node scripts/validate-env.js <staging|production>');
  process.exit(1);
}

if (mode !== 'staging' && mode !== 'production') {
  console.error(`‚ùå ERROR: Invalid mode "${mode}". Must be "staging" or "production"`);
  process.exit(1);
}

// Determine which .env file to check
const envFile = mode === 'production' ? '.env.production' : '.env.staging';
const envPath = path.join(__dirname, '..', envFile);

console.log('üîç BUILD GUARD: Validating environment configuration...');
console.log(`üìã Mode: ${mode}`);
console.log(`üìÑ File: ${envFile}`);

// Check if the env file exists
if (!fs.existsSync(envPath)) {
  console.error(`‚ùå FATAL: Environment file ${envFile} not found!`);
  console.error(`Expected path: ${envPath}`);
  process.exit(1);
}

// Read and parse the env file
const envContent = fs.readFileSync(envPath, 'utf8');
const envVars = {};

envContent.split('\n').forEach(line => {
  const trimmed = line.trim();
  if (trimmed && !trimmed.startsWith('#')) {
    const [key, ...valueParts] = trimmed.split('=');
    if (key && valueParts.length > 0) {
      // Remove quotes from value if present
      let value = valueParts.join('=').trim();
      value = value.replace(/^["']|["']$/g, '');
      envVars[key] = value;
    }
  }
});

// Required environment variables
const requiredVars = [
  'VITE_FIREBASE_API_KEY',
  'VITE_FIREBASE_AUTH_DOMAIN',
  'VITE_FIREBASE_PROJECT_ID',
  'VITE_FIREBASE_STORAGE_BUCKET',
  'VITE_FIREBASE_MESSAGING_SENDER_ID',
  'VITE_FIREBASE_APP_ID'
];

// Validate each required variable
const missing = [];
const invalid = [];

requiredVars.forEach(varName => {
  if (!envVars[varName]) {
    missing.push(varName);
  } else if (envVars[varName].length < 5) {
    invalid.push(varName);
  }
});

// Expected project IDs for validation
const expectedProjectId = mode === 'production' ? 'dans-dichter-db' : 'ddd-spark';
const actualProjectId = envVars['VITE_FIREBASE_PROJECT_ID'];

// Report results
console.log('');
console.log('‚úì Environment file exists');
console.log(`‚úì Found ${Object.keys(envVars).length} environment variables`);

if (missing.length > 0) {
  console.error('');
  console.error('‚ùå FATAL: Missing required environment variables:');
  missing.forEach(v => console.error(`   - ${v}`));
  process.exit(1);
}

if (invalid.length > 0) {
  console.error('');
  console.error('‚ùå FATAL: Invalid (too short) environment variables:');
  invalid.forEach(v => console.error(`   - ${v}: "${envVars[v]}"`));
  process.exit(1);
}

// Validate project ID matches expected environment
if (actualProjectId !== expectedProjectId) {
  console.error('');
  console.error('‚ùå FATAL: Project ID mismatch!');
  console.error(`   Expected for ${mode}: ${expectedProjectId}`);
  console.error(`   Found in ${envFile}: ${actualProjectId}`);
  console.error('');
  console.error('This prevents accidental cross-environment deployment.');
  process.exit(1);
}

// All checks passed
console.log(`‚úì All ${requiredVars.length} required variables present`);
console.log(`‚úì Project ID verified: ${actualProjectId}`);
console.log('');
console.log('‚úÖ BUILD GUARD: Environment validation passed');
console.log(`üöÄ Proceeding with ${mode} build...`);
console.log('');

process.exit(0);
</file>

<file path="src/modules/dashboard/dashboard-controller.js">
/**
 * dashboard-controller.js
 * Event handling and initialization for artist dashboard
 * Uses robust event delegation for dynamic content
 */

import { getStore, setStore } from '../../utils/store.js';
import { updateArtistProfile } from './dashboard-service.js';
import {
  renderArtistDashboard,
  renderProfileEditor,
  displayProfileOverview,
  populateProfileEditor,
  getCheckboxValues
} from './dashboard-ui.js';
import { loadRecommendations } from '../recommendations/recommendations.js';

/**
 * Setup artist dashboard
 * Main entry point called from ui.js
 */
export function setupArtistDashboard() {
  console.log("[DASHBOARD] Setting up artist dashboard...");

  // Render the dashboard HTML
  renderArtistDashboard();

  // Display profile overview
  const currentUserData = getStore('currentUserData');
  if (currentUserData) {
    displayProfileOverview(currentUserData);
  }

  // Setup event listeners with delegation
  setupEventListeners();

  // Load recommendations
  loadArtistRecommendations();

  console.log("[DASHBOARD] ‚úÖ Artist dashboard setup complete");
}

/**
 * Setup all event listeners using delegation
 * Robust approach that works even when DOM is re-rendered
 */
function setupEventListeners() {
  const dashboard = document.getElementById('artist-dashboard');

  if (!dashboard) {
    console.warn("[DASHBOARD] Dashboard container not found");
    return;
  }

  // Check if listeners already attached
  if (dashboard.dataset.listenersAttached === 'true') {
    console.log("[DASHBOARD] Event listeners already attached, skipping");
    return;
  }

  // Event delegation on dashboard container
  dashboard.addEventListener('click', handleDashboardClick);

  // Mark as attached
  dashboard.dataset.listenersAttached = 'true';

  console.log("[DASHBOARD] Event listeners attached via delegation");
}

/**
 * Handle all clicks on dashboard using event delegation
 */
function handleDashboardClick(e) {
  // Edit Profile Button
  if (e.target.closest('#edit-artist-profile-btn')) {
    e.preventDefault();
    showProfileEditor();
    return;
  }

  // Cancel Edit Button
  if (e.target.closest('#cancel-edit-profile-btn')) {
    e.preventDefault();
    hideProfileEditor();
    return;
  }

  // Profile Picture Upload
  if (e.target.id === 'artist-edit-profile-pic') {
    setupProfilePicPreview();
    return;
  }

  // Document Upload
  if (e.target.id === 'artist-edit-document') {
    setupDocumentInput();
    return;
  }

  // Profile Form Submit (handled separately via form event)
  const form = e.target.closest('#artist-profile-form');
  if (form && e.target.type === 'submit') {
    // Let the form submit event handle this
    return;
  }
}

/**
 * Show profile editor
 */
function showProfileEditor() {
  console.log("[DASHBOARD] Showing profile editor");

  const editor = document.getElementById('artist-profile-editor');
  const overview = document.getElementById('artist-profile-overview');

  if (!editor || !overview) {
    console.warn("[DASHBOARD] Editor or overview not found");
    return;
  }

  // Render the editor HTML
  renderProfileEditor();

  // Show editor, hide overview
  editor.classList.remove('hidden');
  overview.classList.add('hidden');

  // Populate with current data
  const currentUserData = getStore('currentUserData');
  if (currentUserData) {
    populateProfileEditor(currentUserData);
  }

  // Setup form submission handler
  const form = document.getElementById('artist-profile-form');
  if (form) {
    form.addEventListener('submit', handleProfileSubmit);
  }

  // Setup file input handlers
  setupProfilePicPreview();
  setupDocumentInput();

  // Re-initialize Lucide icons
  if (window.lucide) {
    window.lucide.createIcons();
  }
}

/**
 * Hide profile editor and show overview
 */
function hideProfileEditor() {
  console.log("[DASHBOARD] Hiding profile editor");

  const editor = document.getElementById('artist-profile-editor');
  const overview = document.getElementById('artist-profile-overview');

  if (!editor || !overview) {
    console.warn("[DASHBOARD] Editor or overview not found");
    return;
  }

  // Hide editor, show overview
  editor.classList.add('hidden');
  overview.classList.remove('hidden');

  // Refresh overview data
  const currentUserData = getStore('currentUserData');
  if (currentUserData) {
    displayProfileOverview(currentUserData);
  }
}

/**
 * Setup profile picture preview
 */
function setupProfilePicPreview() {
  const fileInput = document.getElementById('artist-edit-profile-pic');
  const previewImg = document.getElementById('artist-profile-pic-preview');

  if (!fileInput || !previewImg) return;

  // Remove existing listener if any
  const newFileInput = fileInput.cloneNode(true);
  fileInput.parentNode.replaceChild(newFileInput, fileInput);

  newFileInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file) {
      // Validate file size (max 5MB)
      if (file.size > 5 * 1024 * 1024) {
        alert('File size must be less than 5MB');
        newFileInput.value = '';
        return;
      }

      // Validate file type
      if (!file.type.startsWith('image/')) {
        alert('Please select an image file');
        newFileInput.value = '';
        return;
      }

      // Show preview
      const reader = new FileReader();
      reader.onload = (event) => {
        previewImg.src = event.target.result;
      };
      reader.readAsDataURL(file);
    }
  });
}

/**
 * Setup document input
 */
function setupDocumentInput() {
  const fileInput = document.getElementById('artist-edit-document');
  const filenameSpan = document.getElementById('artist-document-filename');

  if (!fileInput || !filenameSpan) return;

  // Remove existing listener if any
  const newFileInput = fileInput.cloneNode(true);
  fileInput.parentNode.replaceChild(newFileInput, fileInput);

  newFileInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file) {
      // Validate file size (max 10MB)
      if (file.size > 10 * 1024 * 1024) {
        alert('File size must be less than 10MB');
        newFileInput.value = '';
        filenameSpan.textContent = 'No file chosen';
        return;
      }

      // Validate file type
      const validTypes = [
        'application/pdf',
        'application/msword',
        'application/vnd.openxmlformats-officedocument.wordprocessingml.document'
      ];

      if (!validTypes.includes(file.type)) {
        alert('Please select a PDF, DOC, or DOCX file');
        newFileInput.value = '';
        filenameSpan.textContent = 'No file chosen';
        return;
      }

      filenameSpan.textContent = file.name;
    } else {
      filenameSpan.textContent = 'No file chosen';
    }
  });
}

/**
 * Handle profile form submission
 */
async function handleProfileSubmit(e) {
  e.preventDefault();

  const successMsg = document.getElementById('artist-profile-success');
  const errorMsg = document.getElementById('artist-profile-error');
  const submitBtn = e.submitter || e.target.querySelector('button[type="submit"]');

  // Reset messages
  successMsg.textContent = '';
  errorMsg.textContent = '';

  // Disable button
  submitBtn.disabled = true;
  submitBtn.textContent = 'Saving...';

  try {
    const currentUser = getStore('currentUser');
    if (!currentUser) {
      throw new Error("No user logged in");
    }

    const uid = currentUser.uid;

    // Collect checkbox values
    const genres = getCheckboxValues('artist-edit-genres');
    const languages = getCheckboxValues('artist-edit-languages');
    const paymentMethods = getCheckboxValues('artist-edit-payment');

    // Validate checkbox groups
    if (genres.length === 0) {
      throw new Error("Please select at least one genre");
    }
    if (languages.length === 0) {
      throw new Error("Please select at least one language");
    }
    if (paymentMethods.length === 0) {
      throw new Error("Please select at least one payment method");
    }

    // Collect all form data
    const profileData = {
      // Personal Details
      firstName: document.getElementById('artist-edit-firstname').value.trim(),
      lastName: document.getElementById('artist-edit-lastname').value.trim(),
      stageName: document.getElementById('artist-edit-stagename').value.trim(),
      phone: document.getElementById('artist-edit-phone').value.trim(),
      dob: document.getElementById('artist-edit-dob').value,
      gender: document.getElementById('artist-edit-gender').value,
      location: document.getElementById('artist-edit-location').value.trim(),

      // Professional Details
      genres: genres,
      languages: languages,
      paymentMethods: paymentMethods,
      bio: document.getElementById('artist-edit-bio').value.trim(),
      pitch: document.getElementById('artist-edit-pitch').value.trim(),

      // Media
      videoUrl: document.getElementById('artist-edit-video').value.trim(),
      audioUrl: document.getElementById('artist-edit-audio').value.trim(),
      textContent: document.getElementById('artist-edit-text').value.trim(),

      // Notification Settings
      notifyEmail: document.getElementById('artist-edit-notify-email').checked,
      notifySms: document.getElementById('artist-edit-notify-sms').checked
    };

    // Validate required fields
    if (!profileData.firstName || !profileData.lastName || !profileData.phone ||
      !profileData.dob || !profileData.gender || !profileData.location ||
      !profileData.bio || !profileData.pitch) {
      throw new Error("Please fill in all required fields (marked with *)");
    }

    // Get file inputs
    const profilePicInput = document.getElementById('artist-edit-profile-pic');
    const documentInput = document.getElementById('artist-edit-document');
    const profilePicFile = profilePicInput?.files[0];
    const documentFile = documentInput?.files[0];

    // Update profile
    const updatedData = await updateArtistProfile(uid, profileData, profilePicFile, documentFile);

    // Update local store
    const currentUserData = getStore('currentUserData');
    setStore('currentUserData', { ...currentUserData, ...updatedData });

    // Show success message
    successMsg.textContent = '‚úì Profile updated successfully!';

    // Clear file inputs
    if (profilePicFile && profilePicInput) {
      profilePicInput.value = '';
    }
    if (documentFile && documentInput) {
      documentInput.value = '';
      const filenameSpan = document.getElementById('artist-document-filename');
      if (filenameSpan) filenameSpan.textContent = 'No file chosen';
    }

    // Wait a moment, then hide editor
    setTimeout(() => {
      hideProfileEditor();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }, 1000);

  } catch (error) {
    console.error("[DASHBOARD] Error saving profile:", error);
    errorMsg.textContent = 'Error: ' + error.message;
    errorMsg.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  } finally {
    submitBtn.disabled = false;
    submitBtn.textContent = 'Save All Changes';
  }
}

/**
 * Load artist's own recommendations
 */
function loadArtistRecommendations() {
  const currentUser = getStore('currentUser');

  if (!currentUser) {
    console.warn("[DASHBOARD] No user logged in, cannot load recommendations");
    return;
  }

  const recommendationsSection = document.getElementById('artist-recommendations-section');
  if (!recommendationsSection) {
    console.log("[DASHBOARD] Recommendations section not found, skipping");
    return;
  }

  // Show the recommendations section
  recommendationsSection.classList.remove('hidden');
  recommendationsSection.style.display = 'block';

  // Load recommendations
  loadRecommendations(currentUser.uid);
}

/**
 * Exported function to populate editor (called from ui.js for backwards compatibility)
 */
export function populateArtistEditor() {
  const currentUserData = getStore('currentUserData');
  if (currentUserData) {
    populateProfileEditor(currentUserData);
  }
}
</file>

<file path="src/modules/dashboard/dashboard-service.js">
/**
 * dashboard-service.js
 * Data operations for artist dashboard
 * Handles Firestore queries for bookings, statistics, and profile data
 */

import { db } from '../../services/firebase.js';
import { doc, getDoc, updateDoc, collection, query, where, getDocs } from 'firebase/firestore';
import { getStorage, ref, uploadBytes, getDownloadURL } from "firebase/storage";

/**
 * Calculate age from date of birth
 */
export function calculateAge(dob) {
  if (!dob) return null;

  const birthDate = new Date(dob);
  const today = new Date();

  let age = today.getFullYear() - birthDate.getFullYear();
  const monthDiff = today.getMonth() - birthDate.getMonth();

  if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
    age--;
  }

  return age;
}

/**
 * Fetch artist profile data
 */
export async function fetchArtistProfile(uid) {
  try {
    const artistRef = doc(db, 'artists', uid);
    const artistSnap = await getDoc(artistRef);

    if (!artistSnap.exists()) {
      console.warn("Artist profile not found:", uid);
      return null;
    }

    return { id: artistSnap.id, ...artistSnap.data() };
  } catch (error) {
    console.error("Error fetching artist profile:", error);
    throw error;
  }
}

/**
 * Update artist profile in Firestore
 */
export async function updateArtistProfile(uid, profileData, profilePicFile = null, documentFile = null) {
  try {
    const docRef = doc(db, 'artists', uid);
    const storage = getStorage();
    const dataToUpdate = { ...profileData };

    // Handle profile picture upload
    if (profilePicFile) {
      console.log("Uploading profile picture...");
      const storageRef = ref(storage, `artists/${uid}/profile.jpg`);
      const snapshot = await uploadBytes(storageRef, profilePicFile);
      const downloadURL = await getDownloadURL(snapshot.ref);
      console.log("Profile picture uploaded:", downloadURL);
      dataToUpdate.profilePicUrl = downloadURL;
    }

    // Handle document upload
    if (documentFile) {
      console.log("Uploading document...");
      const fileExtension = documentFile.name.split('.').pop();
      const storageRef = ref(storage, `artists/${uid}/document.${fileExtension}`);
      const snapshot = await uploadBytes(storageRef, documentFile);
      const downloadURL = await getDownloadURL(snapshot.ref);
      console.log("Document uploaded:", downloadURL);
      dataToUpdate.documentUrl = downloadURL;
      dataToUpdate.documentName = documentFile.name;
    }

    // Update Firestore
    await updateDoc(docRef, dataToUpdate);
    console.log("Profile updated successfully");

    return dataToUpdate;
  } catch (error) {
    console.error("Error updating profile:", error);
    throw error;
  }
}

/**
 * Fetch artist bookings/gigs (placeholder for future implementation)
 */
export async function fetchArtistBookings(uid) {
  try {
    // TODO: Implement bookings collection query
    // For now, return empty array
    console.log("Fetching bookings for artist:", uid);
    return [];
  } catch (error) {
    console.error("Error fetching bookings:", error);
    return [];
  }
}

/**
 * Fetch artist statistics (placeholder for future implementation)
 */
export async function fetchArtistStats(uid) {
  try {
    // TODO: Implement stats aggregation
    // For now, return placeholder stats
    console.log("Fetching stats for artist:", uid);

    return {
      profileViews: 0,
      messageCount: 0,
      recommendationCount: 0,
      bookings: 0
    };
  } catch (error) {
    console.error("Error fetching stats:", error);
    return {
      profileViews: 0,
      messageCount: 0,
      recommendationCount: 0,
      bookings: 0
    };
  }
}
</file>

<file path="src/modules/dashboard/dashboard-ui.js">
/**
 * dashboard-ui.js
 * Apple-style UI rendering for artist dashboard
 * Focuses on clean, minimal widgets with premium styling
 */

import { calculateAge } from './dashboard-service.js';

/**
 * Renders the artist dashboard HTML structure
 * Apple-esque design: white cards, rounded corners, subtle shadows
 */
export function renderArtistDashboard() {
  const container = document.getElementById('artist-dashboard');

  if (!container) {
    console.warn("Artist dashboard container not found");
    return;
  }

  container.innerHTML = `
    <!-- Profile Overview Card -->
    <div id="artist-profile-overview" class="bg-white p-10 rounded-3xl shadow-sm border border-gray-100 mb-8">
      <div class="flex items-center justify-between mb-8 pb-6 border-b border-gray-100">
        <h3 class="text-3xl font-bold text-gray-900 tracking-tight">Your Profile</h3>
        <button id="edit-artist-profile-btn" class="bg-indigo-600 text-white px-6 py-3 rounded-2xl font-semibold hover:bg-indigo-700 transition-all shadow-sm hover:shadow">
          Edit Profile
        </button>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
        <!-- Profile Picture -->
        <div class="flex justify-center md:justify-start">
          <img id="artist-overview-pic" src="https://placehold.co/200x200/e0e7ff/6366f1?text=A" alt="Profile" class="w-52 h-52 md:w-72 md:h-72 object-cover rounded-3xl shadow-lg border border-gray-100">
        </div>

        <!-- Profile Info -->
        <div class="space-y-5">
          <div class="pb-5 border-b border-gray-50">
            <h4 id="artist-overview-name" class="text-4xl font-bold text-gray-900 tracking-tight mb-2">Artist Name</h4>
            <p id="artist-overview-stagename" class="text-2xl text-indigo-600 font-semibold">Stage Name</p>
          </div>

          <div class="grid grid-cols-2 gap-4 text-sm">
            <div class="bg-gray-50 p-3 rounded-xl">
              <span class="block text-xs font-semibold text-gray-500 mb-1">LOCATION</span>
              <span id="artist-overview-location" class="font-medium text-gray-900">Location</span>
            </div>
            <div class="bg-gray-50 p-3 rounded-xl">
              <span class="block text-xs font-semibold text-gray-500 mb-1">PHONE</span>
              <span id="artist-overview-phone" class="font-medium text-gray-900">Phone</span>
            </div>
            <div class="bg-gray-50 p-3 rounded-xl">
              <span class="block text-xs font-semibold text-gray-500 mb-1">GENDER</span>
              <span id="artist-overview-gender" class="font-medium text-gray-900">Gender</span>
            </div>
            <div class="bg-gray-50 p-3 rounded-xl">
              <span class="block text-xs font-semibold text-gray-500 mb-1">AGE</span>
              <span id="artist-overview-age" class="font-medium text-gray-900">Age</span>
            </div>
          </div>

          <!-- Genres -->
          <div>
            <span class="block text-xs font-semibold text-gray-500 mb-2">GENRES</span>
            <div id="artist-overview-genres" class="flex flex-wrap gap-2">
              <!-- Badges will be inserted here -->
            </div>
          </div>

          <!-- Languages -->
          <div>
            <span class="block text-xs font-semibold text-gray-500 mb-2">LANGUAGES</span>
            <div id="artist-overview-languages" class="flex flex-wrap gap-2">
              <!-- Badges will be inserted here -->
            </div>
          </div>

          <!-- Payment Methods -->
          <div>
            <span class="block text-xs font-semibold text-gray-500 mb-2">PAYMENT METHODS</span>
            <div id="artist-overview-payment" class="flex flex-wrap gap-2">
              <!-- Badges will be inserted here -->
            </div>
          </div>
        </div>
      </div>

      <!-- Bio & Pitch -->
      <div class="mt-8 space-y-4">
        <div class="bg-gray-50 p-4 rounded-xl">
          <p class="text-xs font-semibold text-gray-500 mb-2">BIO</p>
          <p id="artist-overview-bio" class="text-gray-700 leading-relaxed">Bio content here</p>
        </div>

        <div class="bg-gray-50 p-4 rounded-xl">
          <p class="text-xs font-semibold text-gray-500 mb-2">PITCH</p>
          <p id="artist-overview-pitch" class="text-gray-700 leading-relaxed">Pitch content here</p>
        </div>
      </div>
    </div>

    <!-- Profile Editor (Hidden by default) -->
    <div id="artist-profile-editor" class="hidden">
      <!-- Editor content will be rendered dynamically -->
    </div>

    <!-- Artist Recommendations Section -->
    <div id="artist-recommendations-section" class="hidden bg-white p-10 rounded-3xl shadow-sm border border-gray-100">
      <h3 class="text-3xl font-bold text-gray-900 tracking-tight mb-8 pb-6 border-b border-gray-100">My Recommendations</h3>

      <!-- Loading State -->
      <div id="recommendations-loading" class="text-center py-8">
        <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div>
        <p class="text-gray-600 mt-4">Loading recommendations...</p>
      </div>

      <!-- Error State -->
      <div id="recommendations-error" class="text-center py-8 text-red-600" style="display: none;">
        Error loading recommendations
      </div>

      <!-- Empty State -->
      <div id="recommendations-empty" class="text-center py-8 bg-gray-50 rounded-xl" style="display: none;">
        <p class="text-gray-600">No recommendations yet. Programmers can write recommendations after viewing your profile.</p>
      </div>

      <!-- Recommendations List -->
      <div id="recommendations-list" class="space-y-4" style="display: none;">
        <!-- Recommendations will be inserted here dynamically -->
      </div>
    </div>

    <!-- Version Badge -->
    <div class="text-center py-6 text-xs text-gray-400">
      Staging v2.1 (Modular Dashboard) [23-12-2025]
    </div>
  `;

  console.log("Artist dashboard HTML rendered with Apple-esque styling");
}

/**
 * Render the profile editor form
 */
export function renderProfileEditor() {
  const container = document.getElementById('artist-profile-editor');

  if (!container) {
    console.warn("Profile editor container not found");
    return;
  }

  container.innerHTML = `
    <div class="bg-white p-10 rounded-3xl shadow-lg border border-gray-100">
      <div class="flex items-center justify-between mb-8 pb-6 border-b border-gray-100">
        <div>
          <h4 class="text-3xl font-bold text-gray-900 tracking-tight">Edit Your Profile</h4>
          <p class="text-sm text-gray-500 mt-2">Update your information below. Fields marked with * are required.</p>
        </div>
        <button id="cancel-edit-profile-btn" class="text-gray-600 hover:text-gray-900 font-semibold transition-colors px-4 py-2 rounded-xl hover:bg-gray-50">
          Cancel
        </button>
      </div>

      <form id="artist-profile-form" class="space-y-10">

        <!-- Profile Picture -->
        <div class="border-b border-gray-100 pb-8">
          <h5 class="text-xl font-bold text-gray-900 mb-6">Profile Picture</h5>
          <div class="flex items-center gap-8">
            <img id="artist-profile-pic-preview" src="https://placehold.co/100x100/e0e7ff/6366f1?text=Your+Photo" alt="Profile preview" class="w-28 h-28 rounded-3xl object-cover shadow-md border border-gray-100">
            <div class="flex flex-col gap-3">
              <label for="artist-edit-profile-pic" class="cursor-pointer bg-gray-900 text-white py-3 px-6 rounded-2xl text-sm font-semibold hover:bg-gray-800 transition-all inline-block text-center shadow-sm hover:shadow">
                Upload New Photo
                <input id="artist-edit-profile-pic" type="file" accept="image/*" class="sr-only">
              </label>
              <p class="text-xs text-gray-500 leading-relaxed">JPG, PNG or GIF. Max 5MB.</p>
            </div>
          </div>
        </div>

        <!-- Personal Details -->
        <div class="border-b border-gray-100 pb-6">
          <h5 class="text-lg font-bold text-gray-900 mb-4">Personal Details</h5>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label for="artist-edit-firstname" class="block text-sm font-semibold text-gray-700 mb-2">First Name *</label>
              <input id="artist-edit-firstname" type="text" required class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
            </div>
            <div>
              <label for="artist-edit-lastname" class="block text-sm font-semibold text-gray-700 mb-2">Last Name *</label>
              <input id="artist-edit-lastname" type="text" required class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
            </div>
            <div>
              <label for="artist-edit-stagename" class="block text-sm font-semibold text-gray-700 mb-2">Stage Name</label>
              <input id="artist-edit-stagename" type="text" class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
            </div>
            <div>
              <label for="artist-edit-phone" class="block text-sm font-semibold text-gray-700 mb-2">Phone Number *</label>
              <input id="artist-edit-phone" type="tel" required class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
            </div>
            <div>
              <label for="artist-edit-dob" class="block text-sm font-semibold text-gray-700 mb-2">Date of Birth *</label>
              <input id="artist-edit-dob" type="date" required class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
            </div>
            <div>
              <label for="artist-edit-gender" class="block text-sm font-semibold text-gray-700 mb-2">Gender *</label>
              <select id="artist-edit-gender" required class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
                <option value="">Select...</option>
                <option value="f">Female</option>
                <option value="m">Male</option>
                <option value="x">Other / Prefer not to say</option>
              </select>
            </div>
            <div class="md:col-span-2">
              <label for="artist-edit-location" class="block text-sm font-semibold text-gray-700 mb-2">Location (City, Country) *</label>
              <input id="artist-edit-location" type="text" required placeholder="e.g. Amsterdam, Netherlands" class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
            </div>
          </div>
        </div>

        <!-- Professional Details with CHECKBOX GROUPS -->
        <div class="border-b border-gray-100 pb-6">
          <h5 class="text-lg font-bold text-gray-900 mb-4">Professional Details</h5>

          <!-- Genres -->
          <div class="mb-4">
            <label class="block text-sm font-semibold text-gray-700 mb-3">Genres (select all that apply) *</label>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
              ${renderCheckbox('artist-edit-genres', 'performance-poetry', 'Performance Poetry')}
              ${renderCheckbox('artist-edit-genres', 'poetry-slam', 'Poetry Slam')}
              ${renderCheckbox('artist-edit-genres', 'jazz-poetry', 'Jazz Poetry')}
              ${renderCheckbox('artist-edit-genres', 'rap', 'Rap')}
              ${renderCheckbox('artist-edit-genres', 'storytelling', 'Storytelling')}
              ${renderCheckbox('artist-edit-genres', 'comedy', 'Comedy')}
              ${renderCheckbox('artist-edit-genres', '1-on-1', '1-on-1 Sessions')}
            </div>
          </div>

          <!-- Languages -->
          <div class="mb-4">
            <label class="block text-sm font-semibold text-gray-700 mb-3">Languages (select all that apply) *</label>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-2">
              ${renderCheckbox('artist-edit-languages', 'nl', 'NL (Dutch)')}
              ${renderCheckbox('artist-edit-languages', 'en', 'EN (English)')}
              ${renderCheckbox('artist-edit-languages', 'fr', 'FR (French)')}
            </div>
          </div>

          <!-- Payment Methods -->
          <div class="mb-4">
            <label class="block text-sm font-semibold text-gray-700 mb-3">Payment Methods (select all that apply) *</label>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
              ${renderCheckbox('artist-edit-payment', 'invoice', 'Invoice')}
              ${renderCheckbox('artist-edit-payment', 'payrolling', 'Payrolling')}
              ${renderCheckbox('artist-edit-payment', 'sbk', 'Other (SBK)')}
              ${renderCheckbox('artist-edit-payment', 'volunteer-fee', 'Volunteer Fee')}
              ${renderCheckbox('artist-edit-payment', 'other', 'Other')}
            </div>
          </div>

          <!-- Bio & Pitch -->
          <div class="grid grid-cols-1 gap-4">
            <div>
              <label for="artist-edit-bio" class="block text-sm font-semibold text-gray-700 mb-2">Bio / Background Info *</label>
              <textarea id="artist-edit-bio" rows="4" required class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all"></textarea>
            </div>
            <div>
              <label for="artist-edit-pitch" class="block text-sm font-semibold text-gray-700 mb-2">Pitch (a short summary for programmers) *</label>
              <textarea id="artist-edit-pitch" rows="2" required class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all"></textarea>
            </div>
          </div>
        </div>

        <!-- Media & Portfolio -->
        <div class="border-b border-gray-100 pb-6">
          <h5 class="text-lg font-bold text-gray-900 mb-4">Media & Portfolio</h5>
          <div class="space-y-4">
            <div>
              <label for="artist-edit-video" class="block text-sm font-semibold text-gray-700 mb-2">YouTube/Vimeo Link</label>
              <input id="artist-edit-video" type="url" placeholder="https://youtube.com/watch?v=..." class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
            </div>
            <div>
              <label for="artist-edit-audio" class="block text-sm font-semibold text-gray-700 mb-2">Spotify/SoundCloud Link</label>
              <input id="artist-edit-audio" type="url" placeholder="https://soundcloud.com/..." class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
            </div>
            <div>
              <label for="artist-edit-text" class="block text-sm font-semibold text-gray-700 mb-2">Text Material (up to 2000 words)</label>
              <textarea id="artist-edit-text" rows="8" class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all"></textarea>
            </div>

            <!-- Document Upload -->
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Upload Document (PDF, DOC, DOCX)</label>
              <div class="flex items-center gap-4">
                <label for="artist-edit-document" class="cursor-pointer bg-gray-900 text-white py-2.5 px-4 rounded-xl text-sm font-semibold hover:bg-gray-800 transition-colors">
                  Choose File
                  <input id="artist-edit-document" type="file" accept=".pdf,.doc,.docx" class="sr-only">
                </label>
                <span id="artist-document-filename" class="text-sm text-gray-500">No file chosen</span>
              </div>
              <p class="mt-2 text-xs text-gray-500">Maximum file size: 10MB</p>
              <div id="artist-current-document" class="mt-2 hidden">
                <p class="text-sm text-gray-700">Current document: <a id="artist-current-document-link" href="#" target="_blank" class="text-indigo-600 hover:text-indigo-800 underline">View</a></p>
              </div>
            </div>
          </div>
        </div>

        <!-- Notification Settings -->
        <div class="border-b border-gray-100 pb-6">
          <h5 class="text-lg font-bold text-gray-900 mb-4">Notification Settings</h5>
          <div class="space-y-3">
            <label class="flex items-center gap-3 cursor-pointer group">
              <input id="artist-edit-notify-email" type="checkbox" class="w-5 h-5 text-indigo-600 bg-gray-50 border-gray-300 rounded focus:ring-2 focus:ring-indigo-500 transition-all">
              <span class="text-sm text-gray-700 group-hover:text-gray-900">Receive email notifications</span>
            </label>
            <label class="flex items-center gap-3 cursor-pointer group">
              <input id="artist-edit-notify-sms" type="checkbox" class="w-5 h-5 text-indigo-600 bg-gray-50 border-gray-300 rounded focus:ring-2 focus:ring-indigo-500 transition-all">
              <span class="text-sm text-gray-700 group-hover:text-gray-900">Receive SMS notifications (for direct messages from programmers only)</span>
            </label>
          </div>
        </div>

        <!-- Save Button -->
        <div class="space-y-4 pt-4">
          <button type="submit" class="w-full bg-indigo-600 text-white px-6 py-5 rounded-2xl font-bold text-lg hover:bg-indigo-700 transition-all shadow-md hover:shadow-lg">
            Save All Changes
          </button>
          <p id="artist-profile-success" class="text-green-600 text-sm text-center"></p>
          <p id="artist-profile-error" class="text-red-600 text-sm text-center"></p>
        </div>
      </form>
    </div>
  `;

  console.log("Profile editor rendered");
}

/**
 * Helper: Render checkbox input
 */
function renderCheckbox(name, value, label) {
  return `
    <label class="flex items-center gap-2 p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition-colors group">
      <input type="checkbox" name="${name}" value="${value}" class="w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
      <span class="text-sm text-gray-700 group-hover:text-gray-900">${label}</span>
    </label>
  `;
}

/**
 * Display artist profile overview
 */
export function displayProfileOverview(currentUserData) {
  if (!currentUserData) {
    console.warn("No artist data found for overview");
    return;
  }

  // Profile Picture
  const overviewPic = document.getElementById('artist-overview-pic');
  if (overviewPic) {
    overviewPic.src = currentUserData.profilePicUrl ||
      `https://placehold.co/200x200/e0e7ff/6366f1?text=${encodeURIComponent((currentUserData.stageName || currentUserData.firstName || 'A').charAt(0))}`;
  }

  // Name & Stage Name
  document.getElementById('artist-overview-name').textContent =
    `${currentUserData.firstName || ''} ${currentUserData.lastName || ''}`.trim() || 'Artist Name';
  document.getElementById('artist-overview-stagename').textContent =
    currentUserData.stageName || 'No stage name';

  // Basic Info
  document.getElementById('artist-overview-location').textContent = currentUserData.location || 'Not specified';
  document.getElementById('artist-overview-phone').textContent = currentUserData.phone || 'Not specified';

  // Gender
  const genderMap = { 'f': 'Female', 'm': 'Male', 'x': 'Other' };
  document.getElementById('artist-overview-gender').textContent = genderMap[currentUserData.gender] || 'Not specified';

  // Age
  if (currentUserData.dob) {
    const age = calculateAge(currentUserData.dob);
    document.getElementById('artist-overview-age').textContent = `${age} years old`;
  } else {
    document.getElementById('artist-overview-age').textContent = 'Not specified';
  }

  // Genres
  const genresContainer = document.getElementById('artist-overview-genres');
  genresContainer.innerHTML = '';
  if (currentUserData.genres && currentUserData.genres.length > 0) {
    currentUserData.genres.forEach(genre => {
      const badge = document.createElement('span');
      badge.className = 'inline-block bg-indigo-50 text-indigo-700 px-3 py-1 rounded-lg text-sm font-medium';
      badge.textContent = genre;
      genresContainer.appendChild(badge);
    });
  } else {
    genresContainer.textContent = 'No genres specified';
  }

  // Languages
  const languagesContainer = document.getElementById('artist-overview-languages');
  languagesContainer.innerHTML = '';
  if (currentUserData.languages && currentUserData.languages.length > 0) {
    currentUserData.languages.forEach(lang => {
      const badge = document.createElement('span');
      badge.className = 'inline-block bg-green-50 text-green-700 px-3 py-1 rounded-lg text-sm font-medium';
      badge.textContent = lang.toUpperCase();
      languagesContainer.appendChild(badge);
    });
  } else {
    languagesContainer.textContent = 'No languages specified';
  }

  // Payment Methods
  const paymentContainer = document.getElementById('artist-overview-payment');
  paymentContainer.innerHTML = '';
  if (currentUserData.paymentMethods && currentUserData.paymentMethods.length > 0) {
    currentUserData.paymentMethods.forEach(method => {
      const badge = document.createElement('span');
      badge.className = 'inline-block bg-purple-50 text-purple-700 px-3 py-1 rounded-lg text-sm font-medium';
      badge.textContent = method;
      paymentContainer.appendChild(badge);
    });
  } else {
    paymentContainer.textContent = 'No payment methods specified';
  }

  // Bio & Pitch
  document.getElementById('artist-overview-bio').textContent = currentUserData.bio || 'No bio available';
  document.getElementById('artist-overview-pitch').textContent = currentUserData.pitch || 'No pitch available';
}

/**
 * Populate the profile editor with current data
 */
export function populateProfileEditor(currentUserData) {
  if (!currentUserData) {
    console.warn("No artist data found to populate editor");
    return;
  }

  console.log("Populating profile editor with:", currentUserData);

  // Personal Details
  document.getElementById('artist-edit-firstname').value = currentUserData.firstName || '';
  document.getElementById('artist-edit-lastname').value = currentUserData.lastName || '';
  document.getElementById('artist-edit-stagename').value = currentUserData.stageName || '';
  document.getElementById('artist-edit-phone').value = currentUserData.phone || '';
  document.getElementById('artist-edit-dob').value = currentUserData.dob || '';
  document.getElementById('artist-edit-gender').value = currentUserData.gender || '';
  document.getElementById('artist-edit-location').value = currentUserData.location || '';

  // Professional Details (checkboxes)
  setCheckboxValues('artist-edit-genres', currentUserData.genres || []);
  setCheckboxValues('artist-edit-languages', currentUserData.languages || []);
  setCheckboxValues('artist-edit-payment', currentUserData.paymentMethods || []);

  // Bio & Pitch
  document.getElementById('artist-edit-bio').value = currentUserData.bio || '';
  document.getElementById('artist-edit-pitch').value = currentUserData.pitch || '';

  // Media
  document.getElementById('artist-edit-video').value = currentUserData.videoUrl || '';
  document.getElementById('artist-edit-audio').value = currentUserData.audioUrl || '';
  document.getElementById('artist-edit-text').value = currentUserData.textContent || '';

  // Notification Settings
  document.getElementById('artist-edit-notify-email').checked = currentUserData.notifyEmail !== false;
  document.getElementById('artist-edit-notify-sms').checked = currentUserData.notifySms || false;

  // Profile Picture
  const previewImg = document.getElementById('artist-profile-pic-preview');
  if (currentUserData.profilePicUrl) {
    previewImg.src = currentUserData.profilePicUrl;
  } else {
    previewImg.src = `https://placehold.co/100x100/e0e7ff/6366f1?text=${encodeURIComponent((currentUserData.stageName || currentUserData.firstName || 'A').charAt(0))}`;
  }

  // Document
  const currentDocDiv = document.getElementById('artist-current-document');
  const currentDocLink = document.getElementById('artist-current-document-link');
  if (currentUserData.documentUrl) {
    currentDocDiv.classList.remove('hidden');
    currentDocLink.href = currentUserData.documentUrl;
  } else {
    currentDocDiv.classList.add('hidden');
  }
}

/**
 * Helper: Set checkbox values
 */
function setCheckboxValues(name, values) {
  const checkboxes = document.querySelectorAll(`input[name="${name}"]`);
  checkboxes.forEach(checkbox => {
    checkbox.checked = values.includes(checkbox.value);
  });
}

/**
 * Helper: Get checkbox values
 */
export function getCheckboxValues(name) {
  const checkboxes = document.querySelectorAll(`input[name="${name}"]:checked`);
  return Array.from(checkboxes).map(cb => cb.value);
}
</file>

<file path="src/modules/navigation/navigation.js">
/**
 * navigation.js
 * Centralized navigation component that renders both desktop and mobile navigation.
 * This ensures consistent navigation state across all views.
 */

import { getStore } from '../../utils/store.js';

/**
 * Renders the desktop top navigation bar
 */
export function renderDesktopNav() {
  const container = document.getElementById('desktop-nav-container');
  if (!container) {
    console.warn('Desktop nav container not found');
    return;
  }

  const currentUserData = getStore('currentUserData');

  // Get profile picture URL or generate placeholder
  let profilePicUrl = 'https://placehold.co/40x40';
  if (currentUserData?.profilePicUrl) {
    profilePicUrl = currentUserData.profilePicUrl;
  } else if (currentUserData) {
    const initial = currentUserData.firstName?.charAt(0) || currentUserData.stageName?.charAt(0) || 'U';
    profilePicUrl = `https://placehold.co/40x40/e0e7ff/6366f1?text=${encodeURIComponent(initial)}`;
  }

  container.innerHTML = `
    <nav id="desktop-top-nav" class="hidden md:block bg-white border-b border-gray-200 sticky top-0 z-50">
      <div class="max-w-7xl mx-auto px-6 py-4">
        <div class="flex items-center justify-between">
          <!-- Logo -->
          <div class="flex items-center space-x-8">
            <h1 class="text-xl font-bold text-gray-900 tracking-tight">
              SPOKEN WORD PLATFORM
            </h1>
          </div>

          <!-- Menu Items -->
          <div class="flex items-center space-x-6">
            <button id="desktop-nav-profile" class="text-gray-700 hover:text-indigo-600 font-medium px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors">
              Zoeken
            </button>
            <button id="desktop-nav-messages" class="relative text-gray-700 hover:text-indigo-600 font-medium px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors">
              Berichten
              <span id="messages-badge-desktop" class="notification-badge hidden">0</span>
            </button>

            <!-- Profile Menu Dropdown -->
            <div class="relative">
              <button id="desktop-profile-btn" class="flex items-center space-x-2 text-gray-700 hover:text-indigo-600">
                <img id="desktop-profile-pic" src="${profilePicUrl}" class="h-8 w-8 rounded-full object-cover" alt="Profile">
                <i data-lucide="chevron-down" class="h-4 w-4"></i>
              </button>

              <!-- Dropdown Menu (hidden by default) - Compacter -->
              <div id="desktop-profile-dropdown" class="hidden absolute right-0 mt-2 w-52 bg-white rounded-lg shadow-md py-1 z-50 border border-gray-200/80">
                <button id="desktop-profile-settings" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 font-medium">
                  Profiel Instellingen
                </button>
                <button id="desktop-account-settings" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 font-medium">
                  Account Instellingen
                </button>
                <hr class="my-1 border-gray-200">
                <button id="desktop-logout" class="block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 font-medium">
                  Logout
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </nav>
  `;

  // Re-initialize Lucide icons
  if (window.lucide) {
    setTimeout(() => lucide.createIcons(), 50);
  }
}

/**
 * Renders the mobile bottom navigation bar
 */
export function renderMobileNav() {
  const container = document.getElementById('mobile-nav-container');
  if (!container) {
    console.warn('Mobile nav container not found');
    return;
  }

  const currentUserData = getStore('currentUserData');

  container.innerHTML = `
    <nav id="bottom-nav" class="bottom-nav">
      <button class="bottom-nav-item active" data-nav="search">
        <i data-lucide="search" class="bottom-nav-icon"></i>
        <span class="bottom-nav-label">Zoeken</span>
      </button>
      <button class="bottom-nav-item" data-nav="settings">
        <i data-lucide="settings" class="bottom-nav-icon"></i>
        <span class="bottom-nav-label">Instellingen</span>
      </button>
    </nav>
  `;

  // Re-initialize Lucide icons
  if (window.lucide) {
    setTimeout(() => lucide.createIcons(), 50);
  }
}

/**
 * Updates the active state of mobile bottom navigation
 * @param {string} activeNav - The navigation item to mark as active ('search', 'messages', 'profile')
 */
export function updateMobileNavActive(activeNav) {
  const bottomNav = document.getElementById('bottom-nav');
  if (!bottomNav) return;

  const allItems = bottomNav.querySelectorAll('.bottom-nav-item');
  allItems.forEach(item => {
    if (item.dataset.nav === activeNav) {
      item.classList.add('active');
    } else {
      item.classList.remove('active');
    }
  });
}

/**
 * Updates the desktop navigation based on current user state
 * Refreshes profile picture
 */
export function updateDesktopNav() {
  const currentUserData = getStore('currentUserData');
  if (!currentUserData) return;

  // Update profile picture
  const profilePic = document.getElementById('desktop-profile-pic');
  if (profilePic) {
    if (currentUserData.profilePicUrl) {
      profilePic.src = currentUserData.profilePicUrl;
    } else {
      const initial = currentUserData.firstName?.charAt(0) || currentUserData.stageName?.charAt(0) || 'U';
      profilePic.src = `https://placehold.co/40x40/e0e7ff/6366f1?text=${encodeURIComponent(initial)}`;
    }
  }
}

/**
 * Shows or hides navigation based on authentication state
 * @param {boolean} isAuthenticated - Whether the user is logged in
 */
export function setNavigationVisibility(isAuthenticated) {
  const desktopContainer = document.getElementById('desktop-nav-container');
  const mobileContainer = document.getElementById('mobile-nav-container');

  if (isAuthenticated) {
    // Show navigation
    if (desktopContainer) desktopContainer.classList.remove('hidden');
    if (mobileContainer) mobileContainer.classList.remove('hidden');
  } else {
    // Hide navigation
    if (desktopContainer) desktopContainer.classList.add('hidden');
    if (mobileContainer) mobileContainer.classList.add('hidden');
  }
}
</file>

<file path="src/modules/programmer/programmer-dashboard.js">
/**
 * programmer-dashboard.js
 * Manages only the programmer's profile overview (read-only display)
 * - Name, Organization, Photo, Contact Info, About
 * - Public profile preview
 *
 * Profile editing is handled by programmer-profile.js
 * Artist search is handled by artist-search.js
 */

import { getStore } from '../../utils/store.js';

/**
 * Renders the programmer dashboard HTML structure
 */
export function renderProgrammerDashboard() {
  const container = document.getElementById('programmer-dashboard');

  if (!container) {
    console.warn("Programmer dashboard container not found");
    return;
  }

  container.innerHTML = `
    <!-- View voor "Pending" -->
    <div id="programmer-pending-view" class="hidden bg-yellow-50 border border-yellow-200 p-8 rounded-2xl shadow-sm mb-6">
        <div class="flex items-start space-x-4">
            <i data-lucide="clock" class="h-8 w-8 text-yellow-600 flex-shrink-0 mt-1"></i>
            <div>
                <h3 class="text-xl font-bold text-yellow-900 mb-2">Account Pending Approval</h3>
                <p class="text-yellow-800 leading-relaxed" data-i18n="pending_approval">
                    Your account is <strong>pending admin approval</strong>. You will be notified by email once it's published.
                </p>
            </div>
        </div>
    </div>

    <!-- Programmer Profile Overview Card (Apple Style) -->
    <div id="programmer-profile-overview" class="bg-white p-10 rounded-3xl shadow-sm border border-gray-100 mb-8">
        <div class="flex items-center justify-between mb-8 pb-6 border-b border-gray-100">
            <h3 class="text-3xl font-bold text-gray-900 tracking-tight">Your Profile</h3>
            <button id="edit-programmer-profile-btn" class="bg-indigo-600 text-white px-6 py-3 rounded-2xl font-semibold hover:bg-indigo-700 transition-all shadow-sm hover:shadow">
                Edit Profile
            </button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
            <!-- Profile Picture -->
            <div class="flex justify-center md:justify-start">
                <img id="programmer-overview-pic" src="https://placehold.co/200x200/e0e7ff/6366f1?text=P" alt="Profile" class="w-52 h-52 md:w-72 md:h-72 object-cover rounded-3xl shadow-lg border border-gray-100">
            </div>

            <!-- Profile Info -->
            <div class="space-y-5">
                <div class="pb-5 border-b border-gray-50">
                    <h4 id="programmer-overview-name" class="text-4xl font-bold text-gray-900 tracking-tight mb-2">Programmer Name</h4>
                    <p id="programmer-overview-org" class="text-2xl text-indigo-600 font-semibold">Organization Name</p>
                </div>

                <div class="grid grid-cols-2 gap-4 text-sm">
                    <div class="bg-gray-50 p-3 rounded-xl">
                        <span class="block text-xs font-semibold text-gray-500 mb-1">EMAIL</span>
                        <span id="programmer-overview-email" class="font-medium text-gray-900">email@example.com</span>
                    </div>
                    <div class="bg-gray-50 p-3 rounded-xl">
                        <span class="block text-xs font-semibold text-gray-500 mb-1">PHONE</span>
                        <span id="programmer-overview-phone" class="font-medium text-gray-900">Phone</span>
                    </div>
                    <div class="col-span-2 bg-gray-50 p-3 rounded-xl">
                        <span class="block text-xs font-semibold text-gray-500 mb-1">WEBSITE</span>
                        <a id="programmer-overview-website" href="#" target="_blank" class="font-medium text-indigo-600 hover:text-indigo-800 transition-colors">Website</a>
                    </div>
                </div>

                <div class="bg-gray-50 p-4 rounded-xl">
                    <p class="text-xs font-semibold text-gray-500 mb-2">ABOUT ORGANIZATION</p>
                    <p id="programmer-overview-about" class="text-gray-700 leading-relaxed">Organization description here</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Programmer Profile Editor (rendered by programmer-profile.js) -->
    <div id="programmer-profile-editor" class="hidden">
        <!-- Content will be rendered by renderProgrammerProfileEditor() -->
    </div>

    <!-- Programmer Public Preview Section (Apple Style) -->
    <div id="programmer-public-preview" class="bg-white p-10 rounded-3xl shadow-sm border border-gray-100 mb-8">
        <div class="flex items-center justify-between mb-8 pb-6 border-b border-gray-100">
            <h3 class="text-3xl font-bold text-gray-900 tracking-tight">Public Profile Preview</h3>
            <button id="refresh-programmer-preview-btn" class="bg-indigo-600 text-white px-5 py-3 rounded-2xl font-semibold hover:bg-indigo-700 transition-all shadow-sm hover:shadow">
                <i data-lucide="refresh-cw" class="h-4 w-4 inline mr-1"></i>
                Refresh Preview
            </button>
        </div>

        <div class="bg-gray-50 p-8 rounded-3xl border-2 border-dashed border-gray-200">
            <p class="text-sm text-gray-600 mb-4 flex items-center">
                <i data-lucide="info" class="h-4 w-4 mr-2 flex-shrink-0"></i>
                This is how artists see your profile when they view your organization information.
            </p>

            <!-- Preview Content Container -->
            <div id="programmer-preview-content" class="bg-white rounded-2xl shadow-sm border border-gray-100">
                <!-- Preview will be rendered here -->
                <div class="text-center py-12 text-gray-500">
                    <i data-lucide="eye" class="h-12 w-12 mx-auto mb-4 text-gray-400"></i>
                    <p class="font-medium">Click "Refresh Preview" to see how your profile looks</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Search and Filter Section (Content rendered dynamically by renderArtistSearch() in artist-search.js) -->
    <div id="artist-search-section" class="bg-white p-4 md:p-6 rounded-2xl md:rounded-3xl shadow-sm border border-gray-100" style="min-height: 400px; display: block; opacity: 1; visibility: visible;">
        <!-- Content will be injected dynamically -->
    </div>

    <!-- Version Badge (Programmer Dashboard) -->
    <div class="text-center py-6 text-xs text-gray-400">
        Staging v2.1 (Modular Dashboard) [23-12-2025]
    </div>
  `;

  console.log("Programmer dashboard HTML rendered");
}

/**
 * Setup programmer dashboard
 * Only handles the profile overview display and public preview
 */
export function setupProgrammerDashboard() {
  console.log("[SETUP PROGRAMMER DASHBOARD] Starting programmer dashboard setup...");

  // Display profile overview
  displayProgrammerProfileOverview();

  // Setup public profile preview
  setupPublicPreview();

  // ‚≠ê FIX: Setup edit profile button click handler
  setupEditProfileButton();

  console.log("[SETUP PROGRAMMER DASHBOARD] ‚úÖ Programmer dashboard setup complete");
}

/**
 * Setup edit profile button click handler
 * Uses event delegation on the container for reliability
 */
function setupEditProfileButton() {
  const container = document.getElementById('programmer-dashboard');
  const editor = document.getElementById('programmer-profile-editor');

  if (!container || !editor) {
    console.warn("[SETUP EDIT BTN] Dashboard container or editor not found");
    return;
  }

  // Check if listener is already attached to prevent duplicates
  if (container.dataset.editListenerAttached === 'true') {
    console.log("[PROGRAMMER DASHBOARD] Edit button listener already attached, skipping");
    return;
  }

  // Use event delegation on the container
  // This works even if the button is re-rendered
  container.addEventListener('click', (e) => {
    // Check if the clicked element is the edit button or any child of it
    const clickedBtn = e.target.closest('#edit-programmer-profile-btn');
    if (clickedBtn) {
      e.preventDefault();
      e.stopPropagation();
      console.log("[PROGRAMMER DASHBOARD] Edit profile button clicked");

      // Import the functions we need
      import('./programmer-profile.js').then(module => {
        const isHidden = editor.classList.contains('hidden') || editor.style.display === 'none';

        if (isHidden) {
          // Show editor
          console.log("[PROGRAMMER DASHBOARD] Showing editor");
          module.renderProgrammerProfileEditor();
          editor.classList.remove('hidden');
          editor.style.display = 'block';

          // Setup form handlers after rendering
          module.setupProfileFormHandlers();

          // Populate with current data
          module.populateProgrammerEditor();

          // Scroll to editor
          setTimeout(() => {
            editor.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }, 100);
        } else {
          // Hide editor
          console.log("[PROGRAMMER DASHBOARD] Hiding editor, showing overview");
          editor.classList.add('hidden');
          editor.style.display = 'none';

          // Refresh the profile overview
          displayProgrammerProfileOverview();
        }
      }).catch(error => {
        console.error("[EDIT BTN] Error loading programmer-profile.js:", error);
      });
    }
  });

  // Mark listener as attached
  container.dataset.editListenerAttached = 'true';

  console.log("[PROGRAMMER DASHBOARD] Edit button listener attached via event delegation");
}

/**
 * Displays the programmer profile overview (read-only)
 * Called on initial load and after profile updates
 */
export function displayProgrammerProfileOverview() {
  const currentUserData = getStore('currentUserData');
  const currentUser = getStore('currentUser');

  // If no data yet (e.g., during page load before login), skip
  if (!currentUserData || !currentUser) {
    console.log("[PROFILE] No user data yet, skipping profile overview display");
    return;
  }

  // Profile Picture
  const overviewPic = document.getElementById('programmer-overview-pic');
  if (overviewPic) {
    overviewPic.src = currentUserData.profilePicUrl ||
                      `https://placehold.co/200x200/e0e7ff/6366f1?text=${encodeURIComponent((currentUserData.firstName || 'P').charAt(0))}`;
  }

  // Name & Organization
  const nameEl = document.getElementById('programmer-overview-name');
  if (nameEl) {
    nameEl.textContent = `${currentUserData.firstName || ''} ${currentUserData.lastName || ''}`.trim() || 'Programmer Name';
  }

  const orgEl = document.getElementById('programmer-overview-org');
  if (orgEl) {
    orgEl.textContent = currentUserData.organizationName || 'Organization Name';
  }

  // Contact Info
  const emailEl = document.getElementById('programmer-overview-email');
  if (emailEl) {
    emailEl.textContent = currentUser?.email || 'email@example.com';
  }

  const phoneEl = document.getElementById('programmer-overview-phone');
  if (phoneEl) {
    phoneEl.textContent = currentUserData.phone || 'Not specified';
  }

  // Website
  const websiteElement = document.getElementById('programmer-overview-website');
  if (websiteElement) {
    if (currentUserData.website) {
      websiteElement.href = currentUserData.website;
      websiteElement.textContent = currentUserData.website.replace(/^https?:\/\//, '');
    } else {
      websiteElement.href = '#';
      websiteElement.textContent = 'Not specified';
    }
  }

  // About
  const aboutEl = document.getElementById('programmer-overview-about');
  if (aboutEl) {
    aboutEl.textContent = currentUserData.organizationAbout || 'No description available';
  }

  console.log("[PROFILE] Profile overview displayed successfully");
}

/**
 * Setup public profile preview functionality
 */
function setupPublicPreview() {
  const refreshBtn = document.getElementById('refresh-programmer-preview-btn');

  if (!refreshBtn) {
    console.warn("Refresh programmer preview button not found");
    return;
  }

  // Setup refresh button click handler
  refreshBtn.addEventListener('click', () => {
    renderPublicPreview();
  });

  // Show initial preview
  renderPublicPreview();

  console.log("Programmer public preview setup complete");
}

/**
 * Render the public profile preview
 * Shows how the programmer's profile looks to artists
 */
export function renderPublicPreview() {
  const previewContent = document.getElementById('programmer-preview-content');
  const currentUserData = getStore('currentUserData');
  const currentUser = getStore('currentUser');

  if (!previewContent) {
    console.warn("Programmer preview content container not found");
    return;
  }

  if (!currentUserData) {
    console.warn("No programmer data found for preview");
    previewContent.innerHTML = `
      <div class="text-center py-12 text-gray-500">
        <p>No profile data available. Please complete your profile first.</p>
      </div>
    `;
    return;
  }

  // Generate preview HTML with Apple styling
  const profilePicUrl = currentUserData.profilePicUrl ||
    `https://placehold.co/200x200/e0e7ff/6366f1?text=${encodeURIComponent((currentUserData.firstName || 'P').charAt(0))}`;

  const fullName = `${currentUserData.firstName || ''} ${currentUserData.lastName || ''}`.trim() || 'Programmer Name';
  const organizationName = currentUserData.organizationName || 'Organization Name';
  const email = currentUser?.email || 'email@example.com';
  const phone = currentUserData.phone || 'Not specified';
  const website = currentUserData.website || '';
  const about = currentUserData.organizationAbout || 'No description available';

  previewContent.innerHTML = `
    <div class="p-6">
      <!-- Header with profile pic and basic info (Apple Style) -->
      <div class="flex flex-col md:flex-row items-start space-y-4 md:space-y-0 md:space-x-6 mb-6">
        <img src="${profilePicUrl}" alt="Profile" class="w-28 h-28 rounded-2xl object-cover shadow-sm border-2 border-gray-100">
        <div class="flex-1">
          <h4 class="text-2xl font-bold text-gray-900 tracking-tight">${fullName}</h4>
          <p class="text-lg text-indigo-600 font-semibold mt-1">${organizationName}</p>
          <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
            <div class="bg-gray-50 p-2.5 rounded-xl flex items-center">
              <i data-lucide="mail" class="h-4 w-4 mr-2 text-gray-500 flex-shrink-0"></i>
              <a href="mailto:${email}" class="text-gray-700 hover:text-indigo-600 transition-colors truncate">${email}</a>
            </div>
            <div class="bg-gray-50 p-2.5 rounded-xl flex items-center">
              <i data-lucide="phone" class="h-4 w-4 mr-2 text-gray-500 flex-shrink-0"></i>
              <span class="text-gray-700">${phone}</span>
            </div>
            ${website ? `
              <div class="col-span-full bg-gray-50 p-2.5 rounded-xl flex items-center">
                <i data-lucide="globe" class="h-4 w-4 mr-2 text-gray-500 flex-shrink-0"></i>
                <a href="${website}" target="_blank" rel="noopener noreferrer" class="text-indigo-600 hover:text-indigo-800 transition-colors truncate">
                  ${website.replace(/^https?:\/\//, '')}
                </a>
              </div>
            ` : ''}
          </div>
        </div>
      </div>

      <!-- About Organization (Apple Style) -->
      <div class="mb-4 bg-gray-50 p-4 rounded-xl">
        <h5 class="text-xs font-bold text-gray-500 mb-2 uppercase tracking-wide flex items-center">
          <i data-lucide="building-2" class="h-4 w-4 inline mr-2"></i>
          About ${organizationName}
        </h5>
        <p class="text-gray-700 leading-relaxed">${about}</p>
      </div>

      <!-- Badge (Apple Style) -->
      <div class="flex items-center justify-center pt-4 border-t border-gray-100">
        <div class="inline-flex items-center px-4 py-2 bg-indigo-50 text-indigo-700 rounded-xl text-sm font-semibold">
          <i data-lucide="check-circle" class="h-4 w-4 mr-2"></i>
          Verified Programmer
        </div>
      </div>
    </div>
  `;

  // Re-initialize Lucide icons for the new content
  if (window.lucide) {
    window.lucide.createIcons();
  }

  console.log("Programmer public preview rendered");
}
</file>

<file path="src/modules/programmer/programmer-profile.js">
/**
 * programmer-profile.js
 * Handles profile editing functionality for programmers
 */

import { getStore, setStore } from '../../utils/store.js';
import { getStorage, ref, uploadBytes, getDownloadURL } from "firebase/storage";
import { doc, updateDoc } from "firebase/firestore";
import { db } from '../../services/firebase.js';
import { setLanguage } from '../../utils/translations.js';
import { displayProgrammerProfileOverview, renderPublicPreview } from './programmer-dashboard.js';

/**
 * Renders the programmer profile editor HTML
 */
export function renderProgrammerProfileEditor() {
  const container = document.getElementById('programmer-profile-editor');

  if (!container) {
    console.warn("Programmer profile editor container not found");
    return;
  }

  container.innerHTML = `
    <div class="bg-white p-10 rounded-3xl shadow-lg border border-gray-100">
      <div class="flex items-center justify-between mb-8 pb-6 border-b border-gray-100">
        <div>
          <h3 class="text-3xl font-bold text-gray-900 tracking-tight">Edit Your Profile</h3>
          <p class="text-sm text-gray-500 mt-2">Update your information below. Fields marked with * are required.</p>
        </div>
        <button id="cancel-edit-profile-btn" type="button" class="text-gray-600 hover:text-gray-900 font-semibold transition-colors px-4 py-2 rounded-xl hover:bg-gray-50">
          Cancel
        </button>
      </div>

      <form id="programmer-profile-form" class="space-y-10">
        <!-- Profile Picture (Apple Style) -->
        <div class="border-b border-gray-100 pb-8">
          <h5 class="text-xl font-bold text-gray-900 mb-6">Profile Picture</h5>
          <div class="flex items-center gap-8">
            <img id="programmer-profile-pic-preview"
                 src="https://placehold.co/100x100/e0e7ff/6366f1?text=P"
                 alt="Profile Preview"
                 class="w-28 h-28 rounded-3xl object-cover shadow-md border border-gray-100">
            <div class="flex flex-col gap-3">
              <label for="programmer-edit-profile-pic" class="cursor-pointer bg-gray-900 text-white py-3 px-6 rounded-2xl text-sm font-semibold hover:bg-gray-800 transition-all inline-block text-center shadow-sm hover:shadow">
                Upload New Photo
                <input id="programmer-edit-profile-pic" type="file" accept="image/*" class="sr-only">
              </label>
              <p class="text-xs text-gray-500 leading-relaxed">JPG, PNG or GIF. Max 5MB.</p>
            </div>
          </div>
        </div>

        <!-- Personal Details (Apple Style) -->
        <div class="border-b border-gray-100 pb-6">
          <h5 class="text-lg font-bold text-gray-900 mb-4">Personal Details</h5>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label for="programmer-edit-firstname" class="block text-sm font-semibold text-gray-700 mb-2">First Name *</label>
              <input id="programmer-edit-firstname" type="text" required
                     class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
            </div>
            <div>
              <label for="programmer-edit-lastname" class="block text-sm font-semibold text-gray-700 mb-2">Last Name *</label>
              <input id="programmer-edit-lastname" type="text" required
                     class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
            </div>
            <div>
              <label for="programmer-edit-phone" class="block text-sm font-semibold text-gray-700 mb-2">Phone Number</label>
              <input id="programmer-edit-phone" type="tel"
                     class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
            </div>
          </div>
        </div>

        <!-- Organization Details (Apple Style) -->
        <div class="border-b border-gray-100 pb-6">
          <h5 class="text-lg font-bold text-gray-900 mb-4">Organization Details</h5>
          <div class="grid grid-cols-1 gap-4">
            <div>
              <label for="programmer-edit-org-name" class="block text-sm font-semibold text-gray-700 mb-2">Organization Name *</label>
              <input id="programmer-edit-org-name" type="text" required
                     class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
            </div>
            <div>
              <label for="programmer-edit-website" class="block text-sm font-semibold text-gray-700 mb-2">Website</label>
              <input id="programmer-edit-website" type="url" placeholder="https://..."
                     class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
            </div>
            <div>
              <label for="programmer-edit-org-about" class="block text-sm font-semibold text-gray-700 mb-2">About Organization</label>
              <textarea id="programmer-edit-org-about" rows="4"
                        class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all"></textarea>
            </div>
          </div>
        </div>

        <!-- Preferences (Apple Style) -->
        <div class="border-b border-gray-100 pb-6">
          <h5 class="text-lg font-bold text-gray-900 mb-4">Preferences</h5>
          <div>
            <label for="programmer-edit-language" class="block text-sm font-semibold text-gray-700 mb-2">Language</label>
            <select id="programmer-edit-language"
                    class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
              <option value="nl">Nederlands</option>
              <option value="en">English</option>
            </select>
          </div>
        </div>

        <!-- Submit Button (Apple Style) -->
        <div class="space-y-4 pt-4">
          <button type="submit"
                  class="w-full bg-indigo-600 text-white px-6 py-5 rounded-2xl font-bold text-lg hover:bg-indigo-700 transition-all shadow-md hover:shadow-lg">
            Save All Changes
          </button>
          <p id="programmer-profile-success" class="text-green-600 text-sm text-center"></p>
          <p id="programmer-profile-error" class="text-red-600 text-sm text-center"></p>
        </div>
      </form>
    </div>
  `;

  console.log("Programmer profile editor HTML rendered");
}

/**
 * Sets up the programmer profile editor
 */
export function setupProgrammerProfile() {
  const editBtn = document.getElementById('edit-programmer-profile-btn');
  const editor = document.getElementById('programmer-profile-editor');

  if (!editBtn || !editor) {
    console.warn("Programmer profile elements not found");
    return;
  }

  // Render the profile editor HTML first
  renderProgrammerProfileEditor();

  // Now get the form element after rendering
  const form = document.getElementById('programmer-profile-form');

  if (!form) {
    console.warn("Programmer profile form not found after rendering");
    return;
  }

  // Toggle editor visibility
  editBtn.addEventListener('click', () => {
    const isHidden = editor.style.display === 'none' || editor.style.display === '';
    editor.style.display = isHidden ? 'block' : 'none';

    // Populate form when opening
    if (isHidden) {
      populateProgrammerEditor();
    }
  });

  // Setup profile picture preview
  setupProfilePicPreview();

  // Handle form submission
  form.addEventListener('submit', handleProgrammerProfileSubmit);

  console.log("Programmer profile editor setup complete");
}

/**
 * Setup profile form handlers (called after rendering HTML)
 * Exported for use in ui.js when showing settings view
 */
export function setupProfileFormHandlers() {
  const form = document.getElementById('programmer-profile-form');
  const editor = document.getElementById('programmer-profile-editor');
  const cancelBtn = document.getElementById('cancel-edit-profile-btn');

  if (!form || !editor) {
    console.warn("Programmer profile form or editor not found for handler setup");
    return;
  }

  // Remove any existing listeners by cloning the form
  const newForm = form.cloneNode(true);
  form.parentNode.replaceChild(newForm, form);

  // Setup cancel button
  if (cancelBtn) {
    cancelBtn.addEventListener('click', () => {
      console.log("[PROFILE] Cancel button clicked - hiding editor");
      editor.classList.add('hidden');
      editor.style.display = 'none';

      // Refresh the profile overview
      displayProgrammerProfileOverview();
    });
  }

  // Setup profile picture preview
  setupProfilePicPreview();

  // Handle form submission
  newForm.addEventListener('submit', handleProgrammerProfileSubmit);

  console.log("Programmer profile form handlers attached");
}

/**
 * Setup profile picture preview on file selection
 */
function setupProfilePicPreview() {
  const fileInput = document.getElementById('programmer-edit-profile-pic');
  const previewImg = document.getElementById('programmer-profile-pic-preview');

  if (!fileInput || !previewImg) return;

  fileInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file) {
      // Validate file size (max 5MB)
      if (file.size > 5 * 1024 * 1024) {
        alert('File size must be less than 5MB');
        fileInput.value = '';
        return;
      }

      // Validate file type
      if (!file.type.startsWith('image/')) {
        alert('Please select an image file');
        fileInput.value = '';
        return;
      }

      // Show preview
      const reader = new FileReader();
      reader.onload = (event) => {
        previewImg.src = event.target.result;
      };
      reader.readAsDataURL(file);
    }
  });
}

/**
 * Populates the editor with current user data
 */
export function populateProgrammerEditor() {
  const currentUserData = getStore('currentUserData');
  
  if (!currentUserData) {
    console.warn("No programmer data found to populate editor");
    return;
  }
  
  console.log("Populating programmer editor with:", currentUserData);
  
  // Populate form fields
  document.getElementById('programmer-edit-firstname').value = currentUserData.firstName || '';
  document.getElementById('programmer-edit-lastname').value = currentUserData.lastName || '';
  document.getElementById('programmer-edit-phone').value = currentUserData.phone || '';
  document.getElementById('programmer-edit-org-name').value = currentUserData.organizationName || '';
  document.getElementById('programmer-edit-org-about').value = currentUserData.organizationAbout || '';
  document.getElementById('programmer-edit-website').value = currentUserData.website || '';
  document.getElementById('programmer-edit-language').value = currentUserData.language || 'nl';

  // Show current profile picture
  const previewImg = document.getElementById('programmer-profile-pic-preview');
  if (currentUserData.profilePicUrl) {
    previewImg.src = currentUserData.profilePicUrl;
  } else {
    previewImg.src = "https://placehold.co/100x100/e0e7ff/6366f1?text=" + 
                     encodeURIComponent(currentUserData.firstName?.charAt(0) || 'P');
  }
}

/**
 * Handles form submission to save profile changes
 */
async function handleProgrammerProfileSubmit(e) {
  e.preventDefault();
  
  const successMsg = document.getElementById('programmer-profile-success');
  const errorMsg = document.getElementById('programmer-profile-error');
  const submitBtn = e.submitter || e.target.querySelector('button[type="submit"]');
  
  // Reset messages
  successMsg.textContent = '';
  errorMsg.textContent = '';
  
  // Disable button
  submitBtn.disabled = true;
  submitBtn.textContent = 'Saving...';
  
  try {
    const currentUser = getStore('currentUser');
    if (!currentUser) {
      throw new Error("No user logged in");
    }
    
    const uid = currentUser.uid;
    const docRef = doc(db, 'programmers', uid);
    
    // Collect form data
    const dataToUpdate = {
      firstName: document.getElementById('programmer-edit-firstname').value.trim(),
      lastName: document.getElementById('programmer-edit-lastname').value.trim(),
      phone: document.getElementById('programmer-edit-phone').value.trim(),
      organizationName: document.getElementById('programmer-edit-org-name').value.trim(),
      organizationAbout: document.getElementById('programmer-edit-org-about').value.trim(),
      website: document.getElementById('programmer-edit-website').value.trim(),
      language: document.getElementById('programmer-edit-language').value
    };
    
    // Validate required fields
    if (!dataToUpdate.firstName || !dataToUpdate.lastName || !dataToUpdate.organizationName) {
      throw new Error("Please fill in all required fields (marked with *)");
    }
    
    // Handle profile picture upload
    const fileInput = document.getElementById('programmer-edit-profile-pic');
    const file = fileInput.files[0];
    
    if (file) {
      console.log("Uploading profile picture...");
      const storage = getStorage();
      const storageRef = ref(storage, `programmers/${uid}/profile.jpg`);
      
      // Upload file
      const snapshot = await uploadBytes(storageRef, file);
      
      // Get download URL
      const downloadURL = await getDownloadURL(snapshot.ref);
      console.log("Profile picture uploaded:", downloadURL);
      
      // Add URL to data
      dataToUpdate.profilePicUrl = downloadURL;
      
      // Update preview
      document.getElementById('programmer-profile-pic-preview').src = downloadURL;
    }
    
    // Update Firestore
    await updateDoc(docRef, dataToUpdate);
    console.log("Profile updated successfully");
    
    // Update local store
    const currentUserData = getStore('currentUserData');
    setStore('currentUserData', { ...currentUserData, ...dataToUpdate });

    // Apply language change immediately
    setLanguage(dataToUpdate.language);

    // Refresh the profile overview display
    displayProgrammerProfileOverview();

    // Refresh the public preview
    renderPublicPreview();

    // Show success message
    successMsg.textContent = '‚úì Profile updated successfully!';
    
    // Clear file input
    if (file) {
      fileInput.value = '';
    }
    
  } catch (error) {
    console.error("Error saving profile:", error);
    errorMsg.textContent = 'Error: ' + error.message;
  } finally {
    submitBtn.disabled = false;
    submitBtn.textContent = 'Save Profile Changes';
  }
}
</file>

<file path="src/modules/recommendations/recommendations.js">
/**
 * recommendations.js
 * Handles recommendation functionality for programmers to recommend artists
 */

import { collection, addDoc, query, where, getDocs, orderBy, serverTimestamp, doc, getDoc, deleteDoc } from "firebase/firestore";
import { db } from '../../services/firebase.js';
import { getStore } from '../../utils/store.js';
import { t } from '../../utils/translations.js';
import { sendRecommendationNotification } from '../messaging/messaging-controller.js';

/**
 * Setup recommendation modal and form
 */
export function setupRecommendations() {
  const modal = document.getElementById('recommendation-modal');
  const closeBtn = document.getElementById('close-recommendation-modal');
  const cancelBtn = document.getElementById('cancel-recommendation-btn');
  const form = document.getElementById('recommendation-form');

  if (!modal || !closeBtn || !form) {
    console.warn("Recommendation elements not found");
    return;
  }

  // Close modal
  closeBtn.addEventListener('click', closeRecommendationModal);

  // Cancel button also closes modal
  if (cancelBtn) {
    cancelBtn.addEventListener('click', closeRecommendationModal);
  }

  // Handle form submission
  form.addEventListener('submit', handleRecommendationSubmit);

  console.log("Recommendations setup complete");
}

/**
 * Open recommendation modal for a specific artist
 * @param {string} artistId - The artist's user ID
 * @param {object} artistData - The artist's profile data
 */
export function openRecommendationModal(artistId, artistData) {
  const currentUserData = getStore('currentUserData');

  // Security check: only programmers can write recommendations
  if (!currentUserData || currentUserData.role !== 'programmer') {
    alert(t('error_only_programmers_recommend'));
    return;
  }

  const modal = document.getElementById('recommendation-modal');
  const artistNameSpan = document.getElementById('recommendation-artist-name');
  const form = document.getElementById('recommendation-form');

  if (!modal || !artistNameSpan || !form) return;

  // Set artist name in modal
  artistNameSpan.textContent = artistData.stageName || `${artistData.firstName} ${artistData.lastName}`;

  // Store artist data in modal for later use
  form.dataset.artistId = artistId;
  form.dataset.artistName = artistData.stageName || `${artistData.firstName} ${artistData.lastName}`;
  form.dataset.artistEmail = artistData.email;

  // Reset form
  form.reset();
  document.getElementById('recommendation-error').style.display = 'none';
  document.getElementById('recommendation-success').style.display = 'none';

  // Show modal
  modal.classList.remove('hidden');
  modal.classList.add('flex');
}

/**
 * Close recommendation modal
 */
function closeRecommendationModal() {
  const modal = document.getElementById('recommendation-modal');
  if (modal) {
    modal.classList.add('hidden');
    modal.classList.remove('flex');
  }
}

/**
 * Handle recommendation form submission
 */
async function handleRecommendationSubmit(e) {
  e.preventDefault();

  const errorMsg = document.getElementById('recommendation-error');
  const successMsg = document.getElementById('recommendation-success');
  const submitBtn = e.submitter || e.target.querySelector('button[type="submit"]');

  // Reset messages
  errorMsg.style.display = 'none';
  successMsg.style.display = 'none';

  // Disable button
  submitBtn.disabled = true;
  submitBtn.textContent = t('submitting') || 'Submitting...';

  try {
    const currentUser = getStore('currentUser');
    const currentUserData = getStore('currentUserData');

    if (!currentUser || !currentUserData) {
      throw new Error(t('error_must_be_logged_in'));
    }

    if (currentUserData.role !== 'programmer') {
      throw new Error(t('error_only_programmers_recommend'));
    }

    const artistId = e.target.dataset.artistId;
    const artistName = e.target.dataset.artistName;
    const artistEmail = e.target.dataset.artistEmail;
    const text = document.getElementById('recommendation-text').value.trim();

    if (!text) {
      throw new Error(t('error_recommendation_required'));
    }

    if (text.length < 10) {
      throw new Error(t('error_recommendation_too_short'));
    }

    // Create recommendation document
    const recommendationData = {
      artistId: artistId,
      artistName: artistName,
      artistEmail: artistEmail,
      programmerId: currentUser.uid,
      programmerName: `${currentUserData.firstName} ${currentUserData.lastName}`,
      programmerOrganization: currentUserData.organizationName || '',
      programmerEmail: currentUserData.email || '',
      programmerProfilePic: currentUserData.profilePicUrl || '',
      text: text,
      createdAt: serverTimestamp(),
      isApproved: true // Auto-approve for now
    };

    // Add to Firestore
    const recDoc = await addDoc(collection(db, 'recommendations'), recommendationData);

    console.log("Recommendation submitted successfully:", recDoc.id);

    // Send notification message to artist
    try {
      await sendRecommendationNotification(
        artistId,
        artistEmail,
        artistName,
        currentUser.uid,
        currentUserData,
        text
      );
      console.log("Notification sent to artist");
    } catch (notifError) {
      console.error("Failed to send notification:", notifError);
      // Don't throw - recommendation was saved successfully
    }

    // Show success message
    successMsg.textContent = t('recommendation_success');
    successMsg.style.display = 'block';

    // Clear form
    e.target.reset();

    // ‚úÖ FIX: Close modal immediately after 1 second (faster UX)
    setTimeout(() => {
      closeRecommendationModal();
      // Reload recommendations if on artist detail page
      const currentArtistId = document.getElementById('artist-detail-view')?.dataset?.artistId;
      if (currentArtistId === artistId) {
        loadRecommendations(artistId);
      }
    }, 1000);

  } catch (error) {
    console.error("Error submitting recommendation:", error);
    errorMsg.textContent = error.message;
    errorMsg.style.display = 'block';
  } finally {
    submitBtn.disabled = false;
    submitBtn.textContent = t('submit_recommendation') || 'Submit Recommendation';
  }
}

/**
 * Load recommendations for a specific artist
 * @param {string} artistId - The artist's user ID
 */
export async function loadRecommendations(artistId) {
  const container = document.getElementById('recommendations-list');
  const loadingEl = document.getElementById('recommendations-loading');
  const emptyEl = document.getElementById('recommendations-empty');
  const errorEl = document.getElementById('recommendations-error');

  if (!container) {
    console.warn("Recommendations container not found");
    return;
  }

  // Show loading
  if (loadingEl) loadingEl.style.display = 'block';
  if (emptyEl) emptyEl.style.display = 'none';
  if (errorEl) errorEl.style.display = 'none';
  container.innerHTML = '';
  container.style.display = 'none';

  try {
    console.log("Loading recommendations for artist:", artistId);
    
    const recommendationsRef = collection(db, 'recommendations');
    const q = query(
      recommendationsRef,
      where('artistId', '==', artistId),
      where('isApproved', '==', true),
      orderBy('createdAt', 'desc')
    );

    const querySnapshot = await getDocs(q);

    const recommendations = [];
    querySnapshot.forEach((doc) => {
      recommendations.push({ id: doc.id, ...doc.data() });
    });

    console.log(`Found ${recommendations.length} recommendations`);

    // Hide loading
    if (loadingEl) loadingEl.style.display = 'none';

    if (recommendations.length === 0) {
      if (emptyEl) emptyEl.style.display = 'block';
    } else {
      container.style.display = 'block';
      displayRecommendations(recommendations);
    }

  } catch (error) {
    console.error("Error loading recommendations:", error);
    
    // Hide loading
    if (loadingEl) loadingEl.style.display = 'none';
    
    // Show error message
    if (errorEl) {
      errorEl.textContent = 'Fout bij laden. Probeer het later opnieuw.';
      errorEl.style.display = 'block';
    }
  }
}

/**
 * Display recommendations list
 */
function displayRecommendations(recommendations) {
  const container = document.getElementById('recommendations-list');
  const currentUser = getStore('currentUser');

  if (!container) return;

  container.innerHTML = '';

  recommendations.forEach(rec => {
    const recDiv = document.createElement('div');
    recDiv.className = 'bg-gray-50 p-6 rounded-lg shadow-sm border border-gray-200';

    // Format date
    let dateText = '';
    if (rec.createdAt && rec.createdAt.toDate) {
      const date = rec.createdAt.toDate();
      dateText = date.toLocaleDateString('nl-NL', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });
    }

    // Check if current user owns this recommendation (for delete button)
    const canDelete = currentUser && currentUser.uid === rec.programmerId;

    // Programmer name - clickable if viewing as artist or different programmer
    const programmerNameHtml = currentUser && currentUser.uid !== rec.programmerId
      ? `<button onclick="viewProgrammerProfile('${rec.programmerId}')" class="font-semibold text-indigo-600 hover:text-indigo-800 underline">${rec.programmerName}</button>`
      : `<h4 class="font-semibold text-gray-900">${rec.programmerName}</h4>`;

    recDiv.innerHTML = `
      <div class="flex justify-between items-start mb-3">
        <div>
          ${programmerNameHtml}
          ${rec.programmerOrganization ? `<p class="text-sm text-gray-600">${rec.programmerOrganization}</p>` : ''}
          <p class="text-xs text-gray-500 mt-1">${dateText}</p>
        </div>
        ${canDelete ? `
          <button onclick="deleteRecommendation('${rec.id}')" class="text-red-600 hover:text-red-800 text-sm">
            <i data-lucide="trash-2" class="h-4 w-4"></i>
          </button>
        ` : ''}
      </div>
      <p class="text-gray-800 italic">"${rec.text}"</p>
    `;

    container.appendChild(recDiv);
  });

  // Activate Lucide icons
  if (window.lucide) {
    window.lucide.createIcons();
  }
}

/**
 * View programmer profile
 */
window.viewProgrammerProfile = async function(programmerId) {
  try {
    console.log("Viewing programmer profile:", programmerId);
    
    const programmerRef = doc(db, 'programmers', programmerId);
    const programmerSnap = await getDoc(programmerRef);
    
    if (!programmerSnap.exists()) {
      alert('Programmer profile not found');
      return;
    }
    
    const programmer = { id: programmerId, ...programmerSnap.data() };
    
    // Show programmer profile modal
    showProgrammerProfileModal(programmer);
    
  } catch (error) {
    console.error("Error loading programmer profile:", error);
    alert('Failed to load programmer profile');
  }
};

/**
 * Show programmer profile in a modal
 */
function showProgrammerProfileModal(programmer) {
  // Create modal HTML
  const modalHTML = `
    <div id="programmer-profile-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center">
      <div class="relative p-8 bg-white w-full max-w-2xl m-auto rounded-lg shadow-xl">
        <!-- Close button -->
        <button onclick="closeProgrammerProfileModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
          <i data-lucide="x" class="h-6 w-6"></i>
        </button>
        
        <!-- Profile content -->
        <div class="mt-3">
          <div class="flex items-start gap-6 mb-6">
            <img src="${programmer.profilePicUrl || 'https://placehold.co/100x100/e0e7ff/6366f1?text=' + encodeURIComponent((programmer.firstName || 'P').charAt(0))}" 
                 alt="Profile" 
                 class="h-24 w-24 rounded-full object-cover border-4 border-indigo-100">
            <div class="flex-1">
              <h3 class="text-2xl font-bold text-gray-900">${programmer.firstName} ${programmer.lastName}</h3>
              <p class="text-lg text-indigo-600 font-semibold">${programmer.organizationName || ''}</p>
              ${programmer.website ? `<a href="${programmer.website}" target="_blank" class="text-sm text-blue-600 hover:underline">${programmer.website}</a>` : ''}
            </div>
          </div>
          
          <div class="space-y-4">
            ${programmer.organizationAbout ? `
              <div>
                <h4 class="font-semibold text-gray-700 mb-2">About</h4>
                <p class="text-gray-600">${programmer.organizationAbout}</p>
              </div>
            ` : ''}
            
            <div class="grid grid-cols-2 gap-4 text-sm">
              ${programmer.phone ? `
                <div>
                  <span class="font-semibold text-gray-700">Phone:</span>
                  <span class="ml-2 text-gray-600">${programmer.phone}</span>
                </div>
              ` : ''}
              ${programmer.email ? `
                <div>
                  <span class="font-semibold text-gray-700">Email:</span>
                  <a href="mailto:${programmer.email}" class="ml-2 text-blue-600 hover:underline">${programmer.email}</a>
                </div>
              ` : ''}
            </div>
          </div>
          
          <div class="mt-6 flex justify-end">
            <button onclick="closeProgrammerProfileModal()" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-md hover:bg-gray-300">
              Close
            </button>
          </div>
        </div>
      </div>
    </div>
  `;
  
  // Remove existing modal if present
  const existingModal = document.getElementById('programmer-profile-modal');
  if (existingModal) {
    existingModal.remove();
  }
  
  // Add modal to body
  document.body.insertAdjacentHTML('beforeend', modalHTML);
  
  // Activate Lucide icons
  if (window.lucide) {
    window.lucide.createIcons();
  }
}

/**
 * Close programmer profile modal
 */
window.closeProgrammerProfileModal = function() {
  const modal = document.getElementById('programmer-profile-modal');
  if (modal) {
    modal.remove();
  }
};

/**
 * Get recommendation count for an artist
 * @param {string} artistId - The artist's user ID
 * @returns {Promise<number>} - Number of recommendations
 */
export async function getRecommendationCount(artistId) {
  try {
    const recommendationsRef = collection(db, 'recommendations');
    const q = query(
      recommendationsRef,
      where('artistId', '==', artistId),
      where('isApproved', '==', true)
    );

    const querySnapshot = await getDocs(q);
    return querySnapshot.size;
  } catch (error) {
    console.error("Error getting recommendation count:", error);
    return 0;
  }
}

/**
 * Delete a recommendation (only owner can delete)
 */
window.deleteRecommendation = async function(recommendationId) {
  if (!confirm(t('confirm_delete_recommendation') || 'Are you sure you want to delete this recommendation?')) {
    return;
  }

  try {
    const currentUser = getStore('currentUser');
    if (!currentUser) {
      throw new Error(t('error_must_be_logged_in'));
    }

    // Get recommendation to verify ownership
    const recRef = doc(db, 'recommendations', recommendationId);
    const recSnap = await getDoc(recRef);

    if (!recSnap.exists()) {
      throw new Error('Recommendation not found');
    }

    const recData = recSnap.data();

    // Verify ownership
    if (recData.programmerId !== currentUser.uid) {
      throw new Error('You can only delete your own recommendations');
    }

    // Delete the recommendation
    await deleteDoc(recRef);

    console.log("Recommendation deleted successfully");

    // Reload recommendations
    const artistId = recData.artistId;
    loadRecommendations(artistId);

  } catch (error) {
    console.error("Error deleting recommendation:", error);
    alert(error.message);
  }
};
</file>

<file path="src/modules/search/search-controller.js">
/**
 * search-controller.js
 * Controller that connects data and UI layers
 * Manages event listeners, user interactions, and browser history
 */

import { loadArtistsData, fetchArtistById, requireAuth, isAuthenticatedProgrammer } from './search-data.js';
import { renderArtistSearch, renderArtists, populateArtistDetail } from './search-ui.js';
import { loadRecommendations, openRecommendationModal } from '../recommendations/recommendations.js';
import { getStore } from '../../utils/store.js';
import { showErrorToast } from '../../ui/toast.js';
import { hideProfileSectionsForSearch } from './search-visibility-fix.js';

/**
 * Setup artist search functionality (SECURED)
 * Sets up search button, back button, and browser history
 */
export function setupArtistSearch() {
  console.log("[SETUP ARTIST SEARCH] Starting artist search setup...");

  const artistSearchSection = document.getElementById('artist-search-section');
  
  // ‚úÖ GUARD: Prevent duplicate setup
  if (artistSearchSection && artistSearchSection.dataset.setupComplete === 'true') {
    console.log("[SETUP ARTIST SEARCH] Already set up, skipping");
    return;
  }

  // 1. RENDER THE NEW UI
  renderArtistSearch();

  // 2. SETUP INTERACTIONS (Event Delegation)
  setupSearchInteractions();

  // 3. INITIAL LOAD
  // Only load if we are in the search view context
  // loadArtists(); // Optional: might want to wait for user input or explicit load

  // Setup browser back/forward buttons (SECURED)
  setupBrowserHistory();

  // Setup back button for detail view (if it exists outside the module)
  const backToSearchBtn = document.getElementById('back-to-search-btn');
  if (backToSearchBtn) {
    backToSearchBtn.addEventListener('click', (e) => {
      e.preventDefault();
      if (!requireAuth()) return;
      showSearchView();
      window.history.pushState({ view: 'search' }, '', '#search');
    });
  }

  // ‚úÖ Mark setup as complete
  if (artistSearchSection) {
    artistSearchSection.dataset.setupComplete = 'true';
  }

  console.log("[SETUP ARTIST SEARCH] ‚úÖ Artist search setup complete");
}

/**
 * Setup all interactions for the search module using Event Delegation
 * Handles: Layout switching, Filter toggling (Mobile), Apply filters, Input changes
 */
function setupSearchInteractions() {
  const root = document.getElementById('search-module-root');
  if (!root) {
    console.warn("[SETUP] Search module root not found");
    return;
  }

  // Debounce timer for text inputs
  let debounceTimer;
  const debouncedSearch = () => {
    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(() => {
      loadArtists();
    }, 500);
  };

  root.addEventListener('click', (e) => {
    // 1. Handle data-action clicks
    const actionBtn = e.target.closest('[data-action]');
    if (actionBtn) {
      const action = actionBtn.dataset.action;
      const targetId = actionBtn.dataset.target;
      const value = actionBtn.dataset.value;

      if (action === 'set-layout') {
        setSearchLayout(value);
      } else if (action === 'toggle-filter') {
        toggleMobileFilter(targetId, actionBtn);
      } else if (action === 'apply-filter') {
        applyMobileFilter(targetId, actionBtn);
      }
      return;
    }

    // 2. Handle Artist Card Clicks
    const card = e.target.closest('[data-artist-id]');
    if (card) {
      const artistId = card.dataset.artistId;
      console.log('[ARTIST CARDS] Card clicked, artist ID:', artistId);
      showArtistDetail(artistId);
    }
  });

  // 3. Handle Input Changes (Desktop & Mobile)
  root.addEventListener('input', (e) => {
    const target = e.target;
    // Debounce text inputs
    if (target.type === 'text') {
      debouncedSearch();
    }
  });

  // 4. Handle Checkbox Changes
  root.addEventListener('change', (e) => {
    const target = e.target;
    if (target.type === 'checkbox') {
      loadArtists();
    }
  });

  // 5. Desktop "Apply Filters" Button (if user prefers explicit click)
  const applyBtn = document.getElementById('apply-filters-btn');
  if (applyBtn) {
    applyBtn.addEventListener('click', loadArtists);
  }

  console.log("[SETUP] Search interactions attached via event delegation");
}

/**
 * Load artists with filters (SECURED)
 */
export async function loadArtists() {
  const resultsGrid = document.getElementById('search-grid');
  const resultsCount = document.getElementById('results-count');

  if (!resultsGrid) {
    console.error("Search grid not found!");
    return;
  }

  // Show loading state
  resultsGrid.style.opacity = '0.5';
  
  try {
    // Collect filter values (Desktop & Mobile sync is implied by using values from both or specific visible ones)
    // For simplicity, we prioritize desktop inputs if visible, else mobile, or just check both.
    
    const nameFilter = (document.getElementById('desktop-input-name')?.value || document.getElementById('mobile-input-name')?.value || '').toLowerCase().trim();
    const locationFilter = (document.getElementById('desktop-input-location')?.value || document.getElementById('mobile-input-location')?.value || '').toLowerCase().trim();
    
    // Genres (collect from both mobile and desktop checkboxes)
    const genreCheckboxes = document.querySelectorAll('input[name="desktop-genre"]:checked, input[name="mobile-genre"]:checked');
    const genreFilters = Array.from(genreCheckboxes).map(cb => cb.value.toLowerCase().trim());

    // Call data layer
    const artists = await loadArtistsData({
      nameFilter,
      locationFilter,
      genreFilters,
      // Add other filters as needed (age, etc.)
    });

    // Update UI
    renderArtists(artists);

    // Update Count
    if (resultsCount) {
      resultsCount.textContent = `${artists.length} gevonden`;
    }

  } catch (error) {
    console.error("‚ùå Error loading artists:", error);
    showErrorToast(error.message || 'Error loading artists');
    resultsGrid.innerHTML = `<p class="col-span-full text-center text-red-500 py-10">Error loading artists.</p>`;
  } finally {
    resultsGrid.style.opacity = '1';
  }
}

// --- UI Logic Helpers (moved from inline script) ---

function setSearchLayout(cols) {
  const grid = document.getElementById('search-grid');
  if (!grid) return;

  grid.classList.remove('grid-cols-1', 'grid-cols-2', 'lg:grid-cols-2');
  
  if (cols === '1') {
    grid.classList.add('grid-cols-1');
  } else {
    grid.classList.add('grid-cols-2', 'lg:grid-cols-2');
  }

  // Update Buttons
  document.querySelectorAll('[id^="btn-col-"]').forEach(btn => {
    btn.classList.remove('bg-white', 'text-gray-900', 'shadow-sm');
    btn.classList.add('text-gray-500');
  });
  const active = document.getElementById('btn-col-' + cols);
  if (active) {
    active.classList.remove('text-gray-500');
    active.classList.add('bg-white', 'text-gray-900', 'shadow-sm');
  }
}

function toggleMobileFilter(filterId, btnElement) {
  const target = document.getElementById('filter-' + filterId);
  if (!target) return;

  // Close others
  ['name', 'location', 'genre'].forEach(f => {
    if (f !== filterId) {
      const other = document.getElementById('filter-' + f);
      const otherBtn = document.getElementById('btn-filter-' + f);
      if (other) other.classList.add('hidden');
      if (otherBtn) otherBtn.classList.remove('bg-gray-100', 'border-blue-500', 'text-blue-600');
    }
  });

  // Toggle
  target.classList.toggle('hidden');
  const isVisible = !target.classList.contains('hidden');

  if (isVisible) {
    btnElement.classList.add('bg-gray-100', 'border-blue-500', 'text-blue-600');
  } else {
    btnElement.classList.remove('bg-gray-100', 'border-blue-500', 'text-blue-600');
  }
}

function applyMobileFilter(filterId, applyBtn) {
  const container = document.getElementById('filter-' + filterId);
  const toggleBtn = document.getElementById('btn-filter-' + filterId);
  const originalText = applyBtn.innerHTML;

  applyBtn.innerHTML = '...'; 

  // Trigger search
  loadArtists().then(() => {
    setTimeout(() => {
      if (container) container.classList.add('hidden');
      if (toggleBtn) {
        toggleBtn.classList.remove('bg-gray-100', 'border-blue-500', 'text-blue-600');
        toggleBtn.classList.add('bg-green-50', 'border-green-500', 'text-green-700');
      }
      applyBtn.innerHTML = '‚úì';
      setTimeout(() => { applyBtn.innerHTML = originalText; }, 1000);
    }, 300);
  });
}

/**
 * Show artist detail view (SECURED)
 */
export async function showArtistDetail(artistId, pushHistory = true) {
  if (!requireAuth()) return;

  try {
    const artist = await fetchArtistById(artistId);
    if (!artist) { alert("Artist not found"); return; }

    populateArtistDetail(artist);

    document.getElementById('programmer-dashboard').style.display = 'none';
    const detailView = document.getElementById('artist-detail-view');
    detailView.style.display = 'block';
    detailView.dataset.artistId = artistId;

    loadRecommendations(artistId);

    // Setup "Write Recommendation" button
    const writeRecommendationBtn = document.getElementById('write-recommendation-btn');
    if (writeRecommendationBtn) {
        const currentUserData = getStore('currentUserData');
        if (currentUserData && currentUserData.role === 'programmer') {
          writeRecommendationBtn.classList.remove('hidden');
          writeRecommendationBtn.onclick = () => openRecommendationModal(artistId, artist);
        } else {
          writeRecommendationBtn.classList.add('hidden');
        }
    }

    if (pushHistory) {
      window.history.pushState({ view: 'artist-detail', artistId: artistId }, '', `#artist/${artistId}`);
    }
    window.scrollTo({ top: 0, behavior: 'smooth' });

  } catch (error) {
    console.error("Error loading artist detail:", error);
    showErrorToast(error.message);
  }
}

/**
 * Gaat terug naar de search results view (SECURED)
 */
function showSearchView() {
  if (!requireAuth()) return;
  document.getElementById('artist-detail-view').style.display = 'none';
  document.getElementById('programmer-dashboard').style.display = 'block';
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

/**
 * Setup browser history management (SECURED)
 */
function setupBrowserHistory() {
  window.addEventListener('popstate', (event) => {
    if (!isAuthenticatedProgrammer()) {
      const loginView = document.getElementById('login-view');
      if (loginView) loginView.style.display = 'block';
      document.getElementById('programmer-dashboard')?.classList.add('hidden');
      document.getElementById('artist-detail-view')?.classList.add('hidden');
      return;
    }

    if (event.state) {
      if (event.state.view === 'search') {
        showSearchView();
      } else if (event.state.view === 'artist-detail' && event.state.artistId) {
        showArtistDetail(event.state.artistId, false);
      }
    } else {
      showSearchView();
    }
  });

  if (!window.history.state) {
    window.history.replaceState({ view: 'search' }, '', '#search');
  }
}
</file>

<file path="src/modules/search/search-data.js">
/**
 * search-data.js
 * Handles all Firebase queries and data fetching for artist search
 * No DOM manipulation - pure data operations
 */

import { collection, getDocs, query, where, doc, getDoc } from "firebase/firestore";
import { db } from '../../services/firebase.js';
import { getStore } from '../../utils/store.js';

/**
 * Security: Check if user is authenticated as a programmer
 * @returns {boolean} True if authenticated programmer, false otherwise
 */
export function isAuthenticatedProgrammer() {
  const currentUser = getStore('currentUser');
  const currentUserData = getStore('currentUserData');
  const userRole = currentUserData?.role;

  // DEBUG: Log wat we hebben
  console.log('[AUTH CHECK] currentUser:', currentUser ? 'EXISTS (uid: ' + currentUser.uid + ')' : 'NULL');
  console.log('[AUTH CHECK] userRole:', userRole);

  if (!currentUser) {
    console.warn("[AUTH CHECK] ‚ùå Access denied: No currentUser in store");
    return false;
  }

  if (userRole !== 'programmer') {
    console.warn("[AUTH CHECK] ‚ùå Access denied: userRole is not 'programmer', got:", userRole);
    return false;
  }

  console.log("[AUTH CHECK] ‚úÖ Authentication passed - User is authenticated programmer");
  return true;
}

/**
 * Security: Require authentication for sensitive operations
 * Redirects to login if not authenticated
 */
export function requireAuth() {
  console.log("[REQUIRE AUTH] Checking authentication...");

  if (!isAuthenticatedProgrammer()) {
    console.error("[REQUIRE AUTH] ‚ùå Access denied: Redirecting to login");
    console.error("[REQUIRE AUTH] TIP: Check if auth.js properly sets store values:");
    console.error("[REQUIRE AUTH]   - setStore('currentUser', user)");
    console.error("[REQUIRE AUTH]   - setStore('userRole', 'programmer')");

    alert("You must be logged in as a programmer to access this page.");

    // Hide all content
    const programmerDashboard = document.getElementById('programmer-dashboard');
    const artistDetailView = document.getElementById('artist-detail-view');

    if (programmerDashboard) programmerDashboard.classList.add('hidden');
    if (artistDetailView) artistDetailView.classList.add('hidden');

    // Show login page
    const loginView = document.getElementById('login-view');
    if (loginView) {
      loginView.style.display = 'block';
    }

    return false;
  }

  console.log("[REQUIRE AUTH] ‚úÖ Auth check passed");
  return true;
}

/**
 * Calculate age from date of birth
 */
export function calculateAge(dob) {
  if (!dob) return null;

  const birthDate = new Date(dob);
  const today = new Date();

  let age = today.getFullYear() - birthDate.getFullYear();
  const monthDiff = today.getMonth() - birthDate.getMonth();

  if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
    age--;
  }

  return age;
}

/**
 * Fetch a single artist by ID
 * @param {string} artistId - The artist's document ID
 * @returns {Promise<object|null>} Artist data or null if not found
 */
export async function fetchArtistById(artistId) {
  try {
    console.log("Fetching artist data:", artistId);

    const artistRef = doc(db, 'artists', artistId);
    const artistSnap = await getDoc(artistRef);

    if (!artistSnap.exists()) {
      console.warn("Artist not found:", artistId);
      return null;
    }

    return { id: artistSnap.id, ...artistSnap.data() };
  } catch (error) {
    console.error("Error fetching artist:", error);
    throw error;
  }
}

/**
 * Load artists with filters (SECURED + FIXED v2 - Normalize spaces/dashes)
 * @param {object} filters - Filter values from UI
 * @returns {Promise<Array>} Filtered artists array
 */
export async function loadArtistsData(filters = {}) {
  // Security check: Only allow authenticated programmers
  if (!requireAuth()) {
    throw new Error("Authentication required");
  }

  // Helper function to normalize values (trim, lowercase, replace spaces with dashes)
  const normalize = (value) => {
    if (!value || typeof value !== 'string') return '';
    return value.trim().toLowerCase().replace(/\s+/g, '-');
  };

  try {
    const {
      nameFilter = '',
      locationFilter = '',
      genderFilter = '',
      paymentFilters = [],
      genreFilters = [],
      languageFilters = [],
      ageMin = null,
      ageMax = null
    } = filters;

    console.log("üîç Filter values:", {
      nameFilter,
      locationFilter,
      genderFilter,
      paymentFilters,
      genreFilters,
      languageFilters,
      ageRange: ageMin !== null || ageMax !== null ? `${ageMin || 'any'}-${ageMax || 'any'}` : 'not set'
    });

    // Build Firestore query
    let q = query(collection(db, 'artists'), where('published', '==', true));

    // Add gender filter if selected
    if (genderFilter) {
      q = query(q, where('gender', '==', genderFilter));
    }

    // Fetch all artists
    const snapshot = await getDocs(q);
    console.log(`üìä Found ${snapshot.size} artists before client-side filtering`);

    let artists = [];
    snapshot.forEach((doc) => {
      artists.push({ id: doc.id, ...doc.data() });
    });

    // Exclude current user if they are also an artist (prevents showing own profile)
    const currentUser = getStore('currentUser');
    if (currentUser) {
      const beforeCount = artists.length;
      artists = artists.filter(artist => artist.id !== currentUser.uid);
      if (beforeCount > artists.length) {
        console.log(`üö´ Filtered out current user's own profile`);
      }
    }

    // DEBUG: Log first artist's data structure
    if (artists.length > 0) {
      console.log("üìã Sample artist data:", {
        id: artists[0].id,
        stageName: artists[0].stageName,
        genres: artists[0].genres,
        genresNormalized: artists[0].genres?.map(g => normalize(g)),
        paymentMethods: artists[0].paymentMethods,
        paymentsNormalized: artists[0].paymentMethods?.map(p => normalize(p)),
        languages: artists[0].languages
      });
    }

    // Client-side filtering

    // Filter by name (stage name or full name)
    if (nameFilter) {
      artists = artists.filter(artist => {
        const stageName = (artist.stageName || '').toLowerCase();
        const fullName = `${artist.firstName || ''} ${artist.lastName || ''}`.toLowerCase();
        return stageName.includes(nameFilter) || fullName.includes(nameFilter);
      });
      console.log(`üîç After name filter: ${artists.length} artists`);
    }

    // Filter by location
    if (locationFilter) {
      artists = artists.filter(artist => {
        const location = (artist.location || '').toLowerCase();
        return location.includes(locationFilter);
      });
      console.log(`üìç After location filter: ${artists.length} artists`);
    }

    // Filter by payment methods (checkboxes - any match)
    if (paymentFilters.length > 0) {
      console.log(`üí≥ Filtering by payment methods:`, paymentFilters);

      let debugLogged = false;
      artists = artists.filter(artist => {
        const artistPayments = (artist.paymentMethods || []).map(p => normalize(p));

        // DEBUG: Log comparison for first artist only once
        if (!debugLogged) {
          console.log(`  Sample artist payment methods (normalized):`, artistPayments);
          console.log(`  Filter payment methods (normalized):`, paymentFilters);
          debugLogged = true;
        }

        // Artist must have at least one of the selected payment methods
        const hasMatch = paymentFilters.some(payment => artistPayments.includes(payment));
        return hasMatch;
      });

      console.log(`üí≥ After payment filter: ${artists.length} artists`);
    }

    // Filter by genres (checkboxes - any match)
    if (genreFilters.length > 0) {
      console.log(`üé≠ Filtering by genres:`, genreFilters);

      let debugLogged = false;
      artists = artists.filter(artist => {
        const artistGenres = (artist.genres || []).map(g => normalize(g));

        // DEBUG: Log comparison for first artist only once
        if (!debugLogged) {
          console.log(`  Sample artist genres (normalized):`, artistGenres);
          console.log(`  Filter genres (normalized):`, genreFilters);
          debugLogged = true;
        }

        // Artist must have at least one of the selected genres
        const hasMatch = genreFilters.some(genre => artistGenres.includes(genre));
        return hasMatch;
      });

      console.log(`üé≠ After genre filter: ${artists.length} artists`);
    }

    // Filter by languages (checkboxes - any match)
    if (languageFilters.length > 0) {
      console.log(`üó£Ô∏è Filtering by languages:`, languageFilters);

      let debugLogged = false;
      artists = artists.filter(artist => {
        const artistLanguages = (artist.languages || [])
          .filter(l => l && typeof l === 'string')
          .map(l => l.toLowerCase().trim());

        // DEBUG: Log comparison for first artist only once
        if (!debugLogged) {
          console.log(`  Sample artist languages (lowercase):`, artistLanguages);
          console.log(`  Filter languages (lowercase):`, languageFilters);
          debugLogged = true;
        }

        // Artist must have at least one of the selected languages
        const hasMatch = languageFilters.some(lang => artistLanguages.includes(lang));
        return hasMatch;
      });

      console.log(`üó£Ô∏è After language filter: ${artists.length} artists`);
    }

    // Filter by age (only if age filters are set)
    if (ageMin !== null || ageMax !== null) {
      artists = artists.filter(artist => {
        if (!artist.dob) return false; // Exclude artists without birthdate when age filter is active

        const age = calculateAge(artist.dob);
        const meetsMin = ageMin === null || age >= ageMin;
        const meetsMax = ageMax === null || age <= ageMax;
        return meetsMin && meetsMax;
      });
      console.log(`üéÇ After age filter: ${artists.length} artists`);
    }

    console.log(`‚úÖ ${artists.length} artists after all filtering`);

    return artists;

  } catch (error) {
    console.error("‚ùå Error loading artists:", error);
    console.error("Full error details:", error);

    // Check if it's a Firestore index error
    if (error.message && error.message.includes('index')) {
      console.error("üîó FIRESTORE INDEX REQUIRED!");
      console.error("Click this link to create the index:", error.message.match(/https:\/\/[^\s]+/)?.[0]);
    }

    throw error;
  }
}
</file>

<file path="src/modules/search/search-ui.js">
/**
 * search-ui.js
 * Handles all HTML generation for artist search
 * Premium Apple Design - Responsive filters and card layout
 */

import { calculateAge } from './search-data.js';
import { getStore } from '../../utils/store.js';
import { openMessageModal } from '../messaging/messaging-controller.js';
import { hideProfileSectionsForSearch } from './search-visibility-fix.js';

/**
 * Render the artist search view HTML
 * Desktop: Split-view met sidebar links en results rechts
 * Mobile: Pills bovenaan met slide-in menus
 */
export function renderArtistSearch() {
  const searchSection = document.getElementById('artist-search-section');
  if (!searchSection) {
    console.error('[RENDER ARTIST SEARCH] artist-search-section not found!');
    return;
  }

  // Clean search view: Hide profile sections
  hideProfileSectionsForSearch();

  searchSection.innerHTML = `
    <h3 class="text-2xl font-semibold mb-6" data-i18n="search_for_artists">Search for Artists</h3>

    <!-- RADICAL OVERWRITE: New Search Module Root -->
    <div id="search-module-root" class="w-full max-w-7xl mx-auto flex flex-col lg:flex-row gap-8 items-start py-6">

      <!-- SIDEBAR (Filters & Controls) -->
      <aside class="w-full lg:w-1/4 space-y-6 sticky top-4 z-50">

        <!-- MOBILE ONLY: Horizontal Filter Menu -->
        <div class="lg:hidden relative mb-2">
          <!-- Scrollable Filter Buttons -->
          <div class="flex gap-3 overflow-x-auto no-scrollbar pb-1">
            <button data-action="toggle-filter" data-target="name" id="btn-filter-name" class="flex-none px-4 py-2 bg-white border border-gray-200 rounded-full text-sm font-medium text-gray-700 shadow-sm whitespace-nowrap active:scale-95 transition-transform flex items-center">
              Naam <span class="ml-1 text-[10px] opacity-50">‚ñº</span>
            </button>
            <button data-action="toggle-filter" data-target="location" id="btn-filter-location" class="flex-none px-4 py-2 bg-white border border-gray-200 rounded-full text-sm font-medium text-gray-700 shadow-sm whitespace-nowrap active:scale-95 transition-transform flex items-center">
              Locatie <span class="ml-1 text-[10px] opacity-50">‚ñº</span>
            </button>
            <button data-action="toggle-filter" data-target="genre" id="btn-filter-genre" class="flex-none px-4 py-2 bg-white border border-gray-200 rounded-full text-sm font-medium text-gray-700 shadow-sm whitespace-nowrap active:scale-95 transition-transform flex items-center">
              Genre <span class="ml-1 text-[10px] opacity-50">‚ñº</span>
            </button>
          </div>

          <!-- Mobile Overlays (Absolute) -->
          <div id="filter-name" class="hidden absolute top-12 left-0 w-full bg-white/95 backdrop-blur-xl border border-gray-200/50 p-3 rounded-2xl shadow-2xl animate-slide-down z-50">
            <div class="flex gap-2 items-center">
              <input id="mobile-input-name" type="text" placeholder="Typ een naam..." class="flex-1 px-4 py-3 rounded-xl bg-gray-100 border-none outline-none text-base">
              <button data-action="apply-filter" data-target="name" class="flex-none w-12 h-12 bg-green-500 text-white rounded-full flex items-center justify-center shadow-lg hover:bg-green-600">‚úì</button>
            </div>
          </div>
          <div id="filter-location" class="hidden absolute top-12 left-0 w-full bg-white/95 backdrop-blur-xl border border-gray-200/50 p-3 rounded-2xl shadow-2xl animate-slide-down z-50">
            <div class="flex gap-2 items-center">
              <input id="mobile-input-location" type="text" placeholder="Stad..." class="flex-1 px-4 py-3 rounded-xl bg-gray-100 border-none outline-none text-base">
              <button data-action="apply-filter" data-target="location" class="flex-none w-12 h-12 bg-green-500 text-white rounded-full flex items-center justify-center shadow-lg hover:bg-green-600">‚úì</button>
            </div>
          </div>
          <div id="filter-genre" class="hidden absolute top-12 left-0 w-full bg-white/95 backdrop-blur-xl border border-gray-200/50 p-3 rounded-2xl shadow-2xl animate-slide-down z-50">
            <div class="space-y-1 mb-3 max-h-48 overflow-y-auto">
              <label class="flex items-center space-x-3 p-3 bg-gray-50 rounded-xl"><input type="checkbox" name="mobile-genre" value="Design" class="h-5 w-5 rounded text-blue-600"><span class="text-gray-900">Design</span></label>
              <label class="flex items-center space-x-3 p-3 bg-gray-50 rounded-xl"><input type="checkbox" name="mobile-genre" value="Dev" class="h-5 w-5 rounded text-blue-600"><span class="text-gray-900">Dev</span></label>
            </div>
            <div class="flex justify-end pt-2"><button data-action="apply-filter" data-target="genre" class="w-12 h-12 bg-green-500 text-white rounded-full flex items-center justify-center shadow-lg">‚úì</button></div>
          </div>
        </div>

        <!-- DESKTOP SIDEBAR FILTERS (Hidden on Mobile) -->
        <div class="bg-white/70 backdrop-blur-xl border border-white/40 p-6 rounded-3xl shadow-sm hidden lg:block">
          <h2 class="text-xl font-semibold text-gray-900 tracking-tight mb-6">Filters</h2>
          <div class="space-y-6">
            <!-- Inputs -->
            <div>
              <label class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 block">Naam</label>
              <input id="desktop-input-name" type="text" placeholder="Typ een naam..." class="w-full px-4 py-3 rounded-xl bg-gray-50 border border-gray-200 focus:ring-2 focus:ring-blue-500/20 outline-none">
            </div>
            <div>
              <label class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 block">Locatie</label>
              <input id="desktop-input-location" type="text" placeholder="Stad of regio..." class="w-full px-4 py-3 rounded-xl bg-gray-50 border border-gray-200 focus:ring-2 focus:ring-blue-500/20 outline-none">
            </div>
            <!-- Checkboxes -->
            <div>
              <label class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 block">Genre</label>
              <div class="space-y-2">
                <label class="flex items-center space-x-3 p-2 hover:bg-gray-50 rounded-lg cursor-pointer"><input type="checkbox" name="desktop-genre" value="Design" class="h-5 w-5 rounded text-blue-600"><span class="text-sm font-medium">Design</span></label>
                <label class="flex items-center space-x-3 p-2 hover:bg-gray-50 rounded-lg cursor-pointer"><input type="checkbox" name="desktop-genre" value="Dev" class="h-5 w-5 rounded text-blue-600"><span class="text-sm font-medium">Dev</span></label>
              </div>
            </div>
            <button id="apply-filters-btn" class="w-full py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-xl shadow-md transition-transform active:scale-95">Filters Toepassen</button>
          </div>
        </div>

        <!-- INFO & LAYOUT CONTROL -->
        <div class="bg-white/70 backdrop-blur-xl border border-white/40 p-6 rounded-3xl shadow-sm relative z-0">
          <h2 class="text-lg font-semibold text-gray-900 tracking-tight mb-1">Resultaten</h2>
          <p id="results-count" class="text-sm text-gray-500 mb-4">0 gevonden</p>
          <hr class="border-gray-200/60 mb-4">
          <div class="space-y-3">
            <p class="text-xs font-bold text-gray-400 uppercase tracking-wider">Weergave</p>
            <div class="bg-gray-200/50 p-1 rounded-xl flex flex-row gap-1">
              <button data-action="set-layout" data-value="1" id="btn-col-1" class="flex-1 px-4 py-2 rounded-lg text-sm font-medium text-gray-500 hover:text-gray-900">üì± 1</button>
              <button data-action="set-layout" data-value="2" id="btn-col-2" class="flex-1 px-4 py-2 rounded-lg text-sm font-medium bg-white text-gray-900 shadow-sm">üíª 2</button>
            </div>
          </div>
        </div>
      </aside>

      <!-- GRID RESULTS (3/4 Width) -->
      <main class="w-full lg:w-3/4">
        <!-- Default: 2 columns on ALL screens (grid-cols-2) -->
        <div id="search-grid" class="grid grid-cols-2 lg:grid-cols-2 gap-4 md:gap-6 transition-all duration-500 ease-in-out">
          <!-- Results will be injected here -->
        </div>
      </main>

    </div>
  `;

  // Reset setup flags
  if (searchSection) {
    searchSection.dataset.setupComplete = 'false';
  }

  // Re-initialize Lucide icons
  if (window.lucide) {
    window.lucide.createIcons();
  }

  console.log('[RENDER ARTIST SEARCH] ‚úÖ Artist search view rendered (Cleaned)');
}


/**
 * Render artists in the results container
 * RADICAL OVERWRITE: Injects artist cards into the new #search-grid
 */
export function renderArtists(artists) {
  const searchGrid = document.getElementById('search-grid');
  if (!searchGrid) {
    console.error("[RENDER ARTISTS] ‚ùå search-grid not found! Make sure renderArtistSearch() was called first.");
    return;
  }

  // Clear the grid
  searchGrid.innerHTML = '';

  // Generate artist cards using the radical overwrite design
  const artistCards = artists.map(artist => {
    const profilePic = artist.profilePicUrl || "https://images.unsplash.com/photo-1682687220742-aba13b6e50ba?w=800&q=80";
    const age = artist.dob ? calculateAge(artist.dob) : (artist.age || null);
    const location = artist.location || 'BE';
    const genre = artist.genres && artist.genres.length > 0 ? artist.genres[0] : 'ARTIST';
    const stageName = artist.stageName || 'No Stage Name';

    return `
      <div class="group bg-white rounded-3xl overflow-hidden border border-gray-100 cursor-pointer h-full flex flex-col hover:shadow-lg transition-all duration-300" data-artist-id="${artist.id}">
        <!-- Square Image -->
        <div class="aspect-square overflow-hidden relative">
          <img src="${profilePic}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" alt="${stageName}">
          ${age ? `<div class="absolute top-3 right-3 bg-white/90 backdrop-blur-md px-2 py-1 rounded-lg text-xs font-bold text-gray-900 shadow-sm">${age} jr</div>` : ''}
        </div>
        <div class="p-4 md:p-6 flex-1 flex flex-col justify-between">
          <div>
            <span class="inline-block px-2 py-1 bg-blue-50 text-blue-600 text-[10px] uppercase font-bold rounded-md mb-2">${genre}</span>
            <h3 class="text-base md:text-lg font-semibold text-gray-900 mb-1 leading-tight">${stageName}</h3>
            <p class="text-gray-500 text-xs md:text-sm line-clamp-2">${location}</p>
          </div>
        </div>
      </div>
    `;
  }).join('');

  // Inject into grid
  searchGrid.innerHTML = artistCards;

  // Re-initialize Lucide icons
  if (window.lucide) {
    window.lucide.createIcons();
  }

  // Update results count
  const resultsCount = document.getElementById('results-count');
  if (resultsCount) {
    resultsCount.textContent = `${artists.length} gevonden`;
  }

  console.log(`[RENDER ARTISTS] ‚úÖ Rendered ${artists.length} artist cards in RADICAL OVERWRITE grid`);
}

/**
 * Populate artist detail view with artist data
 */
export function populateArtistDetail(artist) {
  // Profile Picture
  const detailProfilePic = document.getElementById('detail-profile-pic');
  if (detailProfilePic) {
    detailProfilePic.src = artist.profilePicUrl || "https://placehold.co/400x400/e0e7ff/6366f1?text=No+Photo";
  }

  // Basic Info
  document.getElementById('detail-artist-name').textContent = `${artist.firstName || ''} ${artist.lastName || ''}`.trim();
  document.getElementById('detail-stage-name').textContent = artist.stageName || 'N/A';
  document.getElementById('detail-location').textContent = artist.location || 'Not specified';

  // Gender
  const genderMap = { 'f': 'Female', 'm': 'Male', 'x': 'Other' };
  document.getElementById('detail-gender').textContent = genderMap[artist.gender] || 'Not specified';

  // Age
  if (artist.dob) {
    document.getElementById('detail-age').textContent = `${calculateAge(artist.dob)} years old`;
  } else {
    document.getElementById('detail-age').textContent = 'Age not specified';
  }

  // Genres
  const detailGenres = document.getElementById('detail-genres');
  detailGenres.innerHTML = '';
  if (artist.genres && artist.genres.length > 0) {
    artist.genres.forEach(genre => {
      const badge = document.createElement('span');
      badge.className = 'inline-block bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full text-sm font-medium';
      badge.textContent = genre;
      detailGenres.appendChild(badge);
    });
  } else {
    detailGenres.textContent = 'No genres specified';
  }

  // Languages
  const detailLanguages = document.getElementById('detail-languages');
  detailLanguages.innerHTML = '';
  if (artist.languages && artist.languages.length > 0) {
    artist.languages.forEach(lang => {
      const badge = document.createElement('span');
      badge.className = 'inline-block bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium';
      badge.textContent = lang.toUpperCase();
      detailLanguages.appendChild(badge);
    });
  } else {
    detailLanguages.textContent = 'No languages specified';
  }

  // Bio & Pitch
  document.getElementById('detail-bio').textContent = artist.bio || 'No bio available.';
  document.getElementById('detail-pitch').textContent = artist.pitch || 'No pitch available.';

  // Video Material
  if (artist.videoUrl && artist.videoUrl.trim()) {
    document.getElementById('detail-video-section').style.display = 'block';
    const embedUrl = getEmbedUrl(artist.videoUrl, 'video');
    if (embedUrl) {
      document.getElementById('detail-video-container').innerHTML = `
        <iframe class="w-full h-full" src="${embedUrl}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
      `;
    } else {
      document.getElementById('detail-video-container').innerHTML = `
        <div class="flex items-center justify-center h-full">
          <a href="${artist.videoUrl}" target="_blank" class="text-indigo-600 hover:text-indigo-800 font-medium">View Video (External Link)</a>
        </div>
      `;
    }
  } else {
    document.getElementById('detail-video-section').style.display = 'none';
  }

  // Audio Material
  if (artist.audioUrl && artist.audioUrl.trim()) {
    document.getElementById('detail-audio-section').style.display = 'block';
    const embedUrl = getEmbedUrl(artist.audioUrl, 'audio');
    if (embedUrl) {
      document.getElementById('detail-audio-container').innerHTML = `
        <iframe class="w-full" height="166" scrolling="no" frameborder="no" allow="autoplay" src="${embedUrl}"></iframe>
      `;
    } else {
      document.getElementById('detail-audio-container').innerHTML = `
        <a href="${artist.audioUrl}" target="_blank" class="text-indigo-600 hover:text-indigo-800 font-medium">Listen to Audio (External Link)</a>
      `;
    }
  } else {
    document.getElementById('detail-audio-section').style.display = 'none';
  }

  // Text Material
  if (artist.textContent && artist.textContent.trim()) {
    document.getElementById('detail-text-section').style.display = 'block';
    document.getElementById('detail-text-content').textContent = artist.textContent;
  } else {
    document.getElementById('detail-text-section').style.display = 'none';
  }

  // Document Material
  const documentSection = document.getElementById('detail-document-section');
  const documentLink = document.getElementById('detail-document-link');

  if (artist.documentUrl && artist.documentUrl.trim()) {
    documentSection.style.display = 'block';
    documentLink.href = artist.documentUrl;
    documentLink.textContent = artist.documentName || 'Download/View Document';
  } else {
    documentSection.style.display = 'none';
  }

  // Contact Information - Access Control
  const currentUserData = getStore('currentUserData');
  const isPro = currentUserData && currentUserData.status === 'pro';

  if (isPro) {
    // Show contact info for Pro users
    document.getElementById('detail-trial-message').style.display = 'none';
    document.getElementById('detail-contact-info').style.display = 'block';

    document.getElementById('detail-email').textContent = artist.email || 'Not available';
    document.getElementById('detail-email').href = `mailto:${artist.email || ''}`;

    document.getElementById('detail-phone').textContent = artist.phone || 'Not available';
    document.getElementById('detail-phone').href = `tel:${artist.phone || ''}`;

    // Setup Send Message button
    const sendMessageBtn = document.getElementById('send-message-btn');
    if (sendMessageBtn) {
      // Remove any existing listeners
      const newBtn = sendMessageBtn.cloneNode(true);
      sendMessageBtn.parentNode.replaceChild(newBtn, sendMessageBtn);

      // Add new listener
      newBtn.addEventListener('click', () => {
        openMessageModal(artist);
      });
    }
  } else {
    // Show upgrade message for Trial users
    document.getElementById('detail-trial-message').style.display = 'block';
    document.getElementById('detail-contact-info').style.display = 'none';
  }
}

/**
 * Convert video/audio URL to embed URL
 */
function getEmbedUrl(url, type) {
  if (!url) return null;

  if (type === 'video') {
    // YouTube
    const youtubeMatch = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\s]+)/);
    if (youtubeMatch) {
      return `https://www.youtube.com/embed/${youtubeMatch[1]}`;
    }

    // Vimeo
    const vimeoMatch = url.match(/vimeo\.com\/(\d+)/);
    if (vimeoMatch) {
      return `https://player.vimeo.com/video/${vimeoMatch[1]}`;
    }
  }

  if (type === 'audio') {
    // SoundCloud
    if (url.includes('soundcloud.com')) {
      return `https://w.soundcloud.com/player/?url=${encodeURIComponent(url)}&color=%23ff5500&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true`;
    }

    // Spotify
    const spotifyMatch = url.match(/spotify\.com\/(track|album|playlist)\/([^?]+)/);
    if (spotifyMatch) {
      return `https://open.spotify.com/embed/${spotifyMatch[1]}/${spotifyMatch[2]}`;
    }
  }

  return null;
}
</file>

<file path="src/modules/search/search-visibility-fix.js">
/**
 * search-visibility-fix.js
 * üî• NUCLEAR VISIBILITY FIX
 * Forces ALL parent containers to be visible when showing artist search results
 */

/**
 * Force visibility on an element with ALL CSS properties
 * @param {HTMLElement} element - The element to show
 * @param {string} displayType - The display type to use (default: 'block')
 */
function forceVisible(element, displayType = 'block') {
  if (!element) return false;

  element.style.display = displayType;
  element.style.opacity = '1';
  element.style.visibility = 'visible';
  element.style.zIndex = '1';
  element.classList.remove('hidden');

  return true;
}

/**
 * Debug: Log the visibility status of an element
 * @param {string} elementId - The ID of the element to check
 */
function debugElementVisibility(elementId) {
  const element = document.getElementById(elementId);
  if (!element) {
    console.log(`[DEBUG] ‚ùå Element #${elementId} NOT FOUND`);
    return;
  }

  const computed = window.getComputedStyle(element);
  console.log(`[DEBUG] üëÄ #${elementId}:`);
  console.log(`  - exists: YES`);
  console.log(`  - display: ${computed.display}`);
  console.log(`  - opacity: ${computed.opacity}`);
  console.log(`  - visibility: ${computed.visibility}`);
  console.log(`  - classes: ${element.className}`);
}

/**
 * üîç Debug: Check entire parent hierarchy for visibility blockers
 * @param {string} elementId - The ID of the element to start from
 */
function debugParentHierarchy(elementId) {
  console.log(`[DEBUG HIERARCHY] üîç Checking parent chain for #${elementId}:`);

  let element = document.getElementById(elementId);
  if (!element) {
    console.log(`[DEBUG HIERARCHY] ‚ùå Element #${elementId} NOT FOUND`);
    return;
  }

  let level = 0;
  while (element && level < 10) {
    const computed = window.getComputedStyle(element);
    const tag = element.tagName.toLowerCase();
    const id = element.id ? `#${element.id}` : '';
    const classes = element.className ? `.${element.className.split(' ').join('.')}` : '';

    console.log(`[DEBUG HIERARCHY] Level ${level}: <${tag}${id}${classes}>`);
    console.log(`  - display: ${computed.display}`);
    console.log(`  - opacity: ${computed.opacity}`);
    console.log(`  - visibility: ${computed.visibility}`);

    // Check for visibility blockers
    if (computed.display === 'none') {
      console.log(`  ‚ö†Ô∏è  BLOCKER: display: none`);
    }
    if (computed.opacity === '0') {
      console.log(`  ‚ö†Ô∏è  BLOCKER: opacity: 0`);
    }
    if (computed.visibility === 'hidden') {
      console.log(`  ‚ö†Ô∏è  BLOCKER: visibility: hidden`);
    }

    element = element.parentElement;
    level++;
  }

  console.log(`[DEBUG HIERARCHY] ‚úÖ Checked ${level} levels`);
}

/**
 * üî• NUCLEAR OPTION: Force visibility on ALL parent containers
 * Call this after rendering artists to ensure everything is visible
 */
export function forceSearchResultsVisible() {
  console.log('[VISIBILITY FIX] üî• FORCING VISIBILITY ON ALL CONTAINERS');

  // 1. Force visibility on the results container (grid)
  const resultsContainer = document.getElementById('artist-list-container');
  if (forceVisible(resultsContainer, 'grid')) {
    console.log('[VISIBILITY FIX] ‚úÖ artist-list-container forced visible (grid)');
  } else {
    console.error('[VISIBILITY FIX] ‚ùå artist-list-container NOT FOUND!');
  }

  // 1.5. Force visibility on the PARENT <main> element (CRITICAL!)
  const resultsMain = document.getElementById('artist-results-main');
  if (forceVisible(resultsMain, 'block')) {
    console.log('[VISIBILITY FIX] ‚úÖ artist-results-main forced visible');
  } else {
    console.error('[VISIBILITY FIX] ‚ùå artist-results-main NOT FOUND!');
  }

  // 2. Force visibility on artist search section
  const artistSearchSection = document.getElementById('artist-search-section');
  if (forceVisible(artistSearchSection, 'block')) {
    console.log('[VISIBILITY FIX] ‚úÖ artist-search-section forced visible');
  } else {
    console.error('[VISIBILITY FIX] ‚ùå artist-search-section NOT FOUND!');
  }

  // 3. Force visibility on programmer dashboard
  const programmerDashboard = document.getElementById('programmer-dashboard');
  if (forceVisible(programmerDashboard, 'block')) {
    console.log('[VISIBILITY FIX] ‚úÖ programmer-dashboard forced visible');
  } else {
    console.error('[VISIBILITY FIX] ‚ùå programmer-dashboard NOT FOUND!');
  }

  // 4. Force visibility on dashboard view
  const dashboardView = document.getElementById('dashboard-view');
  if (forceVisible(dashboardView, 'block')) {
    console.log('[VISIBILITY FIX] ‚úÖ dashboard-view forced visible');
  } else {
    console.error('[VISIBILITY FIX] ‚ùå dashboard-view NOT FOUND!');
  }

  // 5. Force visibility on app-content (root container)
  const appContent = document.getElementById('app-content');
  if (forceVisible(appContent, 'block')) {
    console.log('[VISIBILITY FIX] ‚úÖ app-content forced visible');
  } else {
    console.error('[VISIBILITY FIX] ‚ùå app-content NOT FOUND!');
  }

  // 6. Debug: Log computed styles after forcing
  console.log('[VISIBILITY FIX] üîç DEBUG: Checking computed styles...');
  debugElementVisibility('artist-list-container');
  debugElementVisibility('artist-results-main');
  debugElementVisibility('artist-search-section');
  debugElementVisibility('programmer-dashboard');
  debugElementVisibility('dashboard-view');

  // 7. üîç DEBUG HIERARCHY: Check entire parent chain for hidden blockers
  console.log('[VISIBILITY FIX] üîç DEBUG: Checking parent hierarchy...');
  debugParentHierarchy('artist-list-container');

  console.log('[VISIBILITY FIX] ‚úÖ ALL CONTAINERS FORCED VISIBLE');
}

/**
 * üî• NUCLEAR OPTION 2: Hide profile sections when showing search
 * Call this to ensure profile sections don't overlap with search results
 */
export function hideProfileSectionsForSearch() {
  console.log('[VISIBILITY FIX] üßπ Hiding profile sections for search view');

  const profileOverview = document.getElementById('programmer-profile-overview');
  const publicPreview = document.getElementById('programmer-public-preview');
  const profileEditor = document.getElementById('programmer-profile-editor');

  [profileOverview, publicPreview, profileEditor].forEach(element => {
    if (element) {
      element.style.display = 'none';
      element.classList.add('hidden');
    }
  });

  console.log('[VISIBILITY FIX] ‚úÖ Profile sections hidden');
}
</file>

<file path="src/modules/settings/user-settings.js">
/**
 * user-settings.js
 * Handles user account settings: language, email, and password changes
 */

import { auth, db } from '../../services/firebase.js';
import {
  updateEmail,
  updatePassword,
  EmailAuthProvider,
  reauthenticateWithCredential
} from 'firebase/auth';
import { doc, updateDoc } from 'firebase/firestore';
import { getStore } from '../../utils/store.js';
import { getCurrentLanguage, setLanguage, t, applyTranslations } from '../../utils/translations.js';

/**
 * Setup user settings functionality
 */
export function setupUserSettings() {
  const modal = document.getElementById('user-settings-modal');
  const closeBtn = document.getElementById('close-settings-modal');
  const userEmail = document.getElementById('user-email');
  const languageSelect = document.getElementById('settings-language-select');
  const updateEmailBtn = document.getElementById('settings-update-email-btn');
  const updatePasswordBtn = document.getElementById('settings-update-password-btn');

  if (!modal || !closeBtn || !userEmail) {
    console.warn("User settings elements not found");
    return;
  }

  // Make user email clickable
  userEmail.style.cursor = 'pointer';
  userEmail.classList.add('hover:text-indigo-600', 'hover:underline');

  userEmail.addEventListener('click', () => {
    openSettingsModal();
  });

  // Close modal handlers
  closeBtn.addEventListener('click', closeSettingsModal);

  modal.addEventListener('click', (e) => {
    if (e.target === modal) {
      closeSettingsModal();
    }
  });

  // Language change handler
  if (languageSelect) {
    languageSelect.addEventListener('change', handleLanguageChange);
  }

  // Email update handler
  if (updateEmailBtn) {
    updateEmailBtn.addEventListener('click', handleEmailUpdate);
  }

  // Password update handler
  if (updatePasswordBtn) {
    updatePasswordBtn.addEventListener('click', handlePasswordUpdate);
  }

  console.log("User settings setup complete");
}

/**
 * Open settings modal
 */
function openSettingsModal() {
  const modal = document.getElementById('user-settings-modal');
  const languageSelect = document.getElementById('settings-language-select');

  if (!modal) return;

  // Set current language in dropdown
  if (languageSelect) {
    languageSelect.value = getCurrentLanguage();
  }

  // Clear all fields
  clearAllFields();

  // Show modal
  modal.classList.remove('hidden');
  modal.classList.add('flex');
}

/**
 * Close settings modal
 */
function closeSettingsModal() {
  const modal = document.getElementById('user-settings-modal');

  if (!modal) return;

  modal.classList.add('hidden');
  modal.classList.remove('flex');

  // Clear all fields
  clearAllFields();
}

/**
 * Clear all input fields and messages
 */
function clearAllFields() {
  // Clear email change fields
  document.getElementById('settings-current-password-email').value = '';
  document.getElementById('settings-new-email').value = '';
  document.getElementById('settings-email-error').classList.add('hidden');
  document.getElementById('settings-email-success').classList.add('hidden');

  // Clear password change fields
  document.getElementById('settings-current-password-pw').value = '';
  document.getElementById('settings-new-password').value = '';
  document.getElementById('settings-confirm-password').value = '';
  document.getElementById('settings-password-error').classList.add('hidden');
  document.getElementById('settings-password-success').classList.add('hidden');
}

/**
 * Handle language change
 */
async function handleLanguageChange(e) {
  const newLanguage = e.target.value;

  // Update UI immediately
  setLanguage(newLanguage);

  console.log(`Language changed to: ${newLanguage}`);

  // Save language preference to database
  try {
    const user = auth.currentUser;
    if (!user) {
      console.warn('No user logged in, language preference not saved to database');
      return;
    }

    // Update language in Firestore users collection
    const userDocRef = doc(db, 'users', user.uid);
    await updateDoc(userDocRef, {
      language: newLanguage
    });

    // Update language in role-specific collection (artists or programmers)
    const currentUserData = getStore('currentUserData');
    if (currentUserData && currentUserData.role) {
      const roleCollection = currentUserData.role === 'artist' ? 'artists' : 'programmers';
      const roleDocRef = doc(db, roleCollection, user.uid);
      await updateDoc(roleDocRef, {
        language: newLanguage
      });
    }

    console.log('Language preference saved to database');
  } catch (error) {
    console.error('Error saving language preference:', error);
    // Don't show error to user as the UI already changed
  }
}

/**
 * Handle email update
 */
async function handleEmailUpdate() {
  const currentPasswordInput = document.getElementById('settings-current-password-email');
  const newEmailInput = document.getElementById('settings-new-email');
  const errorMsg = document.getElementById('settings-email-error');
  const successMsg = document.getElementById('settings-email-success');
  const updateBtn = document.getElementById('settings-update-email-btn');

  // Reset messages
  errorMsg.classList.add('hidden');
  successMsg.classList.add('hidden');
  errorMsg.textContent = '';
  successMsg.textContent = '';

  const currentPassword = currentPasswordInput.value.trim();
  const newEmail = newEmailInput.value.trim();

  // Validation
  if (!currentPassword) {
    errorMsg.textContent = t('settings_reauth_required');
    errorMsg.classList.remove('hidden');
    return;
  }

  if (!newEmail) {
    errorMsg.textContent = t('settings_invalid_email');
    errorMsg.classList.remove('hidden');
    return;
  }

  // Validate email format
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailRegex.test(newEmail)) {
    errorMsg.textContent = t('settings_invalid_email');
    errorMsg.classList.remove('hidden');
    return;
  }

  // Disable button during update
  updateBtn.disabled = true;
  updateBtn.textContent = t('loading');

  try {
    const user = auth.currentUser;

    if (!user) {
      throw new Error('No user logged in');
    }

    // Re-authenticate user
    const credential = EmailAuthProvider.credential(user.email, currentPassword);
    await reauthenticateWithCredential(user, credential);

    // Update email in Firebase Auth
    await updateEmail(user, newEmail);

    // Update email in Firestore users collection
    const userDocRef = doc(db, 'users', user.uid);
    await updateDoc(userDocRef, {
      email: newEmail
    });

    // Update email in role-specific collection (artists or programmers)
    const currentUserData = getStore('currentUserData');
    if (currentUserData && currentUserData.role) {
      const roleCollection = currentUserData.role === 'artist' ? 'artists' : 'programmers';
      const roleDocRef = doc(db, roleCollection, user.uid);
      await updateDoc(roleDocRef, {
        email: newEmail
      });
    }

    // Show success message
    successMsg.textContent = t('settings_email_updated');
    successMsg.classList.remove('hidden');

    // Update displayed email in UI
    const userEmailSpan = document.getElementById('user-email');
    if (userEmailSpan) {
      userEmailSpan.textContent = newEmail;
    }

    // Clear fields
    currentPasswordInput.value = '';
    newEmailInput.value = '';

    console.log('Email updated successfully');

  } catch (error) {
    console.error('Error updating email:', error);

    let errorMessage = error.message;

    // Handle specific Firebase errors
    if (error.code === 'auth/wrong-password') {
      errorMessage = 'Incorrect password';
    } else if (error.code === 'auth/email-already-in-use') {
      errorMessage = 'This email address is already in use';
    } else if (error.code === 'auth/invalid-email') {
      errorMessage = t('settings_invalid_email');
    } else if (error.code === 'auth/requires-recent-login') {
      errorMessage = 'Please log out and log back in before changing your email';
    }

    errorMsg.textContent = errorMessage;
    errorMsg.classList.remove('hidden');
  } finally {
    updateBtn.disabled = false;
    updateBtn.textContent = t('settings_update_email');
  }
}

/**
 * Handle password update
 */
async function handlePasswordUpdate() {
  const currentPasswordInput = document.getElementById('settings-current-password-pw');
  const newPasswordInput = document.getElementById('settings-new-password');
  const confirmPasswordInput = document.getElementById('settings-confirm-password');
  const errorMsg = document.getElementById('settings-password-error');
  const successMsg = document.getElementById('settings-password-success');
  const updateBtn = document.getElementById('settings-update-password-btn');

  // Reset messages
  errorMsg.classList.add('hidden');
  successMsg.classList.add('hidden');
  errorMsg.textContent = '';
  successMsg.textContent = '';

  const currentPassword = currentPasswordInput.value.trim();
  const newPassword = newPasswordInput.value.trim();
  const confirmPassword = confirmPasswordInput.value.trim();

  // Validation
  if (!currentPassword) {
    errorMsg.textContent = t('settings_reauth_required');
    errorMsg.classList.remove('hidden');
    return;
  }

  if (!newPassword) {
    errorMsg.textContent = t('settings_password_too_short');
    errorMsg.classList.remove('hidden');
    return;
  }

  if (newPassword.length < 6) {
    errorMsg.textContent = t('settings_password_too_short');
    errorMsg.classList.remove('hidden');
    return;
  }

  if (newPassword !== confirmPassword) {
    errorMsg.textContent = t('settings_password_mismatch');
    errorMsg.classList.remove('hidden');
    return;
  }

  // Disable button during update
  updateBtn.disabled = true;
  updateBtn.textContent = t('loading');

  try {
    const user = auth.currentUser;

    if (!user) {
      throw new Error('No user logged in');
    }

    // Re-authenticate user
    const credential = EmailAuthProvider.credential(user.email, currentPassword);
    await reauthenticateWithCredential(user, credential);

    // Update password in Firebase Auth
    await updatePassword(user, newPassword);

    // Show success message
    successMsg.textContent = t('settings_password_updated');
    successMsg.classList.remove('hidden');

    // Clear fields
    currentPasswordInput.value = '';
    newPasswordInput.value = '';
    confirmPasswordInput.value = '';

    console.log('Password updated successfully');

  } catch (error) {
    console.error('Error updating password:', error);

    let errorMessage = error.message;

    // Handle specific Firebase errors
    if (error.code === 'auth/wrong-password') {
      errorMessage = 'Incorrect current password';
    } else if (error.code === 'auth/weak-password') {
      errorMessage = t('settings_password_too_short');
    } else if (error.code === 'auth/requires-recent-login') {
      errorMessage = 'Please log out and log back in before changing your password';
    }

    errorMsg.textContent = errorMessage;
    errorMsg.classList.remove('hidden');
  } finally {
    updateBtn.disabled = false;
    updateBtn.textContent = t('settings_update_password');
  }
}
</file>

<file path="src/services/auth.js">
/**
 * auth.js
 * Beheert alle authenticatie-logica: inloggen, registreren,
 * uitloggen, en het controleren van de auth-status.
 */

// Importeer de Firebase-services die we nodig hebben
import {
  getAuth,
  onAuthStateChanged,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  signOut,
  updateEmail,
  updatePassword,
  EmailAuthProvider,
  reauthenticateWithCredential
} from "firebase/auth";
import { doc, setDoc, updateDoc } from "firebase/firestore";
import { auth, db } from './firebase.js'; // Haal de ge√Ønitialiseerde 'auth' en 'db' op

// Importeer de UI-functies en de "store" (globale state)
import { showPage, updateNav, showDashboard } from '../ui/ui.js';
import { setStore, getStore } from '../utils/store.js';
import { fetchUserData } from './data.js';
import { setupBadgeListener, stopBadgeListener } from '../modules/messaging/messaging-controller.js';
import { getCheckboxValues } from '../utils/checkbox-helpers.js';

// --- HULPFUNCTIES ---

/**
 * Toont een foutmelding op een specifiek formulier.
 * @param {string} formId - De ID van het formulier (bv. 'login-form').
 * @param {string} message - De foutmelding die getoond moet worden.
 */
function showAuthError(formId, message) {
  const errorEl = document.getElementById(`${formId}-error`);
  if (errorEl) {
    errorEl.textContent = message;
  } else {
    console.error(`Fout-element niet gevonden voor formulier: ${formId}`, message);
  }
}

// ‚≠ê REMOVED: getSelectValues() is no longer needed, we use getCheckboxValues() from checkbox-helpers.js

// --- FORMULIER-HANDLERS ---

/**
 * Verwerkt de inlog-poging.
 */
export async function handleLogin(e) {
  e.preventDefault();

  const email = document.getElementById('login-email').value;
  const password = document.getElementById('login-password').value;
  const errorEl = document.getElementById('login-error');
  errorEl.textContent = '';

  console.log("[LOGIN] Attempting login for:", email);

  try {
    await signInWithEmailAndPassword(auth, email, password);
    // De onAuthStateChanged-listener (in monitorAuthState)
    // zal de rest afhandelen (data ophalen, dashboard tonen).
  } catch (error) {
    console.error("Login mislukt:", error);
    errorEl.textContent = error.message;
  }
}

/**
 * Verwerkt de registratie van een nieuwe artiest.
 */
export async function handleArtistSignup(e) {
  e.preventDefault();
  const errorEl = document.getElementById('artist-signup-error');
  errorEl.textContent = '';
  
  // Haal formulierwaarden op
  const email = document.getElementById('artist-email').value;
  const password = document.getElementById('artist-password').value;

  try {
    // 1. Maak de gebruiker aan in Firebase Authentication
    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
    const user = userCredential.user;
    
    // 2. Maak het profiel aan in Firestore
    // (a) Maak het 'users' document (voor snelle rol-check)
    const userDocRef = doc(db, `users/${user.uid}`);
    await setDoc(userDocRef, {
        role: 'artist',
        email: email,
        status: 'active' // Artiesten zijn direct actief
    });

    // (b) Maak het 'artists' document (het volledige profiel)
    const artistDocRef = doc(db, `artists/${user.uid}`);
    const artistData = {
        uid: user.uid,
        email: email,
        firstName: document.getElementById('artist-firstname').value,
        lastName: document.getElementById('artist-lastname').value,
        stageName: document.getElementById('artist-stagename').value,
        phone: document.getElementById('artist-phone').value,
        dob: document.getElementById('artist-dob').value,
        gender: document.getElementById('artist-gender').value,
        location: document.getElementById('artist-location').value,
        genres: getCheckboxValues('artist-genres'),
        languages: getCheckboxValues('artist-languages'),
        paymentMethods: getCheckboxValues('artist-payment'),
        bio: document.getElementById('artist-bio').value,
        pitch: document.getElementById('artist-pitch').value,
        notifyEmail: document.getElementById('artist-notify-email').checked,
        notifySms: document.getElementById('artist-notify-sms').checked,
        createdAt: new Date().toISOString(),
        profilePicUrl: '', // Wordt later toegevoegd
        videoUrl: '',
        audioUrl: '',
        textContent: '',
        published: true // Artiesten zijn standaard gepubliceerd
    };
    await setDoc(artistDocRef, artistData);
    
    // De onAuthStateChanged-listener zal de rest afhandelen.

  } catch (error) {
    console.error("Registratie artiest mislukt:", error);
    errorEl.textContent = error.message;
  }
}

/**
 * Verwerkt de registratie van een nieuwe programmeur.
 */
export async function handleProgrammerSignup(e) {
  e.preventDefault();
  const errorEl = document.getElementById('programmer-signup-error');
  errorEl.textContent = '';
  
  const email = document.getElementById('prog-email').value;
  const password = document.getElementById('prog-password').value;

  try {
    // 1. Maak de gebruiker aan in Firebase Authentication
    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
    const user = userCredential.user;
    
    // 2. Maak de profielen aan in Firestore
    // (a) Maak het 'users' document (voor snelle rol-check)
    const userDocRef = doc(db, `users/${user.uid}`);
    await setDoc(userDocRef, {
        role: 'programmer',
        email: email,
        status: 'pending' // Programmeurs moeten worden goedgekeurd
    });
    
    // (b) Maak het 'programmers' document (het volledige profiel)
    const programmerDocRef = doc(db, `programmers/${user.uid}`);
    const programmerData = {
        uid: user.uid,
        email: email,
        firstName: document.getElementById('prog-firstname').value,
        lastName: document.getElementById('prog-lastname').value,
        phone: document.getElementById('prog-phone').value,
        organizationName: document.getElementById('prog-org-name').value,
        organizationAbout: document.getElementById('prog-org-about').value,
        website: document.getElementById('prog-website').value,
        notifyEmail: document.getElementById('prog-notify-email').checked,
        createdAt: new Date().toISOString(),
        status: 'pending', // Needs admin approval per MVP doc
        trialStartedAt: new Date().toISOString()
    };
    await setDoc(programmerDocRef, programmerData);

    // De onAuthStateChanged-listener zal de rest afhandelen.

  } catch (error) {
    console.error("Registratie programmeur mislukt:", error);
    errorEl.textContent = error.message;
  }
}

/**
 * Verwerkt het uitloggen.
 * DIT IS DE FIX: 'export' toegevoegd
 */
export function handleLogout() {
  // Stop badge listener
  stopBadgeListener();
  // Logout
  signOut(auth).catch(error => console.error("Logout mislukt:", error));
}


// --- HOOFDFUNCTIES (te importeren in main.js) ---

/**
 * Luistert naar de algemene inlogstatus van Firebase.
 * Dit is de "hoofdschakelaar" van de app.
 */
export function monitorAuthState() {
  const loadingView = document.getElementById('loading-view');

  console.log('[AUTH] Setting up onAuthStateChanged listener...');

  // Add a timeout to prevent infinite loading
  const loadingTimeout = setTimeout(() => {
    console.error('[AUTH] ‚ö†Ô∏è Auth state listener did not fire within 10 seconds!');
    console.error('[AUTH] This usually means Firebase is not initialized correctly.');
    if (loadingView) {
      loadingView.innerHTML = `
        <div class="text-center p-8 max-w-lg mx-auto bg-white shadow-lg rounded-lg">
          <h1 class="text-2xl font-bold mb-4 text-red-600">Initialization Error</h1>
          <p class="mb-4">Firebase authentication failed to initialize.</p>
          <p class="text-sm text-gray-600">Please check the browser console for details.</p>
          <button onclick="location.reload()" class="mt-4 bg-indigo-600 text-white px-4 py-2 rounded">
            Retry
          </button>
        </div>
      `;
    }
  }, 10000); // 10 second timeout

  onAuthStateChanged(auth, async (user) => {
    // Clear the timeout since auth state changed
    clearTimeout(loadingTimeout);
    if (user) {
      // Gebruiker is ingelogd
      console.log("Auth state change: User logged in:", user.uid);
      // Sla het Firebase user object op in de store
      setStore('currentUser', user);
      // Haal de profielgegevens van de gebruiker op (uit 'users' en 'artists'/'programmers')
      try {
        await fetchUserData(user.uid);
        // Werk de navigatiebalk bij
        updateNav(user);
        // Setup real-time badge listener (Fase 2.5)
        setupBadgeListener();
        // Toon het juiste dashboard (artiest of programmeur)
        showDashboard();
      } catch (error) {
        console.error("Fout bij ophalen van gebruikersdata na inloggen:", error);
        // Als het ophalen van data mislukt, log de gebruiker uit voor de veiligheid
        handleLogout();
        showPage('login-view');
        showAuthError('login-form', `Kon profiel niet laden: ${error.message}`);
      }
      
    } else {
      // Gebruiker is uitgelogd
      console.log("Auth state change: User logged out");
      // Stop badge listener
      stopBadgeListener();
      setStore('currentUser', null);
      updateNav(null);
      // Toon de homepagina en verberg de lader
      showPage('home-view');
    }
    // Verberg de lader (pas nadat alles klaar is)
    // FIX 3: Null-safe style guard
    if (loadingView) loadingView.style.display = 'none';
  });
}

/**
 * Updates user email address
 * @param {string} newEmail - New email address
 * @param {string} currentPassword - Current password for reauthentication
 * @returns {Promise<void>}
 */
export async function updateUserEmail(newEmail, currentPassword) {
  const user = auth.currentUser;

  if (!user) {
    throw new Error("No user logged in");
  }

  // Reauthenticate user before email change (Firebase requirement)
  const credential = EmailAuthProvider.credential(user.email, currentPassword);
  await reauthenticateWithCredential(user, credential);

  // Update email in Firebase Auth
  await updateEmail(user, newEmail);

  // Update email in Firestore users collection
  const userDocRef = doc(db, `users/${user.uid}`);
  await updateDoc(userDocRef, { email: newEmail });

  // Update email in role-specific collection (artists or programmers)
  const currentUserData = getStore('currentUserData');
  if (currentUserData?.role === 'artist') {
    const artistDocRef = doc(db, `artists/${user.uid}`);
    await updateDoc(artistDocRef, { email: newEmail });
  } else if (currentUserData?.role === 'programmer') {
    const programmerDocRef = doc(db, `programmers/${user.uid}`);
    await updateDoc(programmerDocRef, { email: newEmail });
  }

  console.log('[AUTH] Email updated successfully');
}

/**
 * Updates user password
 * @param {string} currentPassword - Current password for reauthentication
 * @param {string} newPassword - New password
 * @returns {Promise<void>}
 */
export async function updateUserPassword(currentPassword, newPassword) {
  const user = auth.currentUser;

  if (!user) {
    throw new Error("No user logged in");
  }

  // Reauthenticate user before password change (Firebase requirement)
  const credential = EmailAuthProvider.credential(user.email, currentPassword);
  await reauthenticateWithCredential(user, credential);

  // Update password in Firebase Auth
  await updatePassword(user, newPassword);

  console.log('[AUTH] Password updated successfully');
}

// ‚≠ê REMOVED: initAuth() - all form handling is now done via global event delegation in ui.js
</file>

<file path="src/services/data.js">
// BELANGRIJKE FIX: 'getDoc' hier ge√Ømporteerd
import { doc, getDoc } from "firebase/firestore";
import { db } from './firebase.js';
import { setStore } from '../utils/store.js';
import { setLanguage } from '../utils/translations.js';

/**
 * Haalt de profielgegevens van de gebruiker op uit Firestore
 * en slaat deze op in de global store.
 * 
 * FIX: Deze functie voegt nu de 'role', 'uid' en 'email' velden toe
 * aan het currentUserData object zodat messaging.js toegang heeft tot senderRole.
 */
export async function fetchUserData(uid) {
  if (!uid) return null;

  try {
    // 1. Haal eerst de 'role' op uit de 'users' collectie
    const userRoleRef = doc(db, 'users', uid);
    const userRoleSnap = await getDoc(userRoleRef);

    if (!userRoleSnap.exists()) {
      throw new Error("Gebruikersrol niet gevonden in /users/" + uid);
    }
    
    const userData = userRoleSnap.data();
    // FIX 1: Handle role as both string and object (data.role.name)
    const role = typeof userData.role === 'object' && userData.role?.name
      ? userData.role.name
      : userData.role;
    const email = userData.email;
    
    setStore('userRole', role); // Sla de rol op

    // 2. Haal het volledige profiel op uit de specifieke collectie (artists/programmers)
    let userProfile = null;
    let userProfileSnap = null;

    if (role === 'artist') {
      const artistRef = doc(db, 'artists', uid);
      userProfileSnap = await getDoc(artistRef);
      userProfile = userProfileSnap.data();
    } else if (role === 'programmer') {
      const programmerRef = doc(db, 'programmers', uid);
      userProfileSnap = await getDoc(programmerRef);
      userProfile = userProfileSnap.data();
    } else {
      throw new Error(`Onbekende rol: ${role}`);
    }

    if (!userProfile) {
      // Probeer de snapshot data te gebruiken als userProfile leeg is
      if (userProfileSnap && userProfileSnap.exists()) {
        userProfile = userProfileSnap.data();
      } else {
        throw new Error(`Profiel niet gevonden in /${role}s/` + uid);
      }
    }

    // ‚≠ê FIX: Voeg role, uid, en email toe aan userProfile
    // Dit zorgt ervoor dat messaging.js toegang heeft tot senderRole
    const completeUserData = {
      ...userProfile,
      role: role,      // ‚≠ê Voeg role toe
      uid: uid,        // ‚≠ê Voeg uid toe
      email: email     // ‚≠ê Voeg email toe (als backup)
    };

    // 3. Sla de volledige profielgegevens op in de store
    setStore('currentUserData', completeUserData);
    console.log("Gebruikersprofiel geladen met role:", { uid, email, role, status: completeUserData.status });

    // 4. Set user's language preference (defaults to 'nl' if not set)
    const userLanguage = userProfile.language || 'nl';
    setLanguage(userLanguage);

    return completeUserData;

  } catch (error) {
    console.error("Fout bij ophalen gebruikersgegevens:", error);
    setStore('currentUserData', null);
    setStore('userRole', null);
    throw error; // Gooi de fout door zodat auth.js het kan opvangen
  }
}
</file>

<file path="src/services/firebase.js">
// Import Firebase modules
import { initializeApp } from "firebase/app";
import { getAuth } from "firebase/auth";
import { getFirestore } from "firebase/firestore";
import { getStorage } from "firebase/storage";

// Firebase configuration via Vite environment variables
// Build command determines which .env file is loaded:
// - "vite build --mode staging" loads .env.staging (ddd-spark)
// - "vite build --mode production" loads .env.production (dans-dichter-db)
const firebaseConfig = {
  apiKey: import.meta.env.VITE_FIREBASE_API_KEY,
  authDomain: import.meta.env.VITE_FIREBASE_AUTH_DOMAIN,
  projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID,
  storageBucket: import.meta.env.VITE_FIREBASE_STORAGE_BUCKET,
  messagingSenderId: import.meta.env.VITE_FIREBASE_MESSAGING_SENDER_ID,
  appId: import.meta.env.VITE_FIREBASE_APP_ID
};

// Critical: Validate and log Firebase config
console.log('üî• Vite Mode:', import.meta.env.MODE);
console.log('üî• Firebase Project:', firebaseConfig.projectId);
console.log('üî• Firebase Config Check:', {
  apiKey: firebaseConfig.apiKey ? '‚úì Set' : '‚ùå MISSING',
  authDomain: firebaseConfig.authDomain ? '‚úì Set' : '‚ùå MISSING',
  projectId: firebaseConfig.projectId ? '‚úì Set' : '‚ùå MISSING'
});

// RUNTIME ENVIRONMENT GUARD: Comprehensive validation
const requiredKeys = ['apiKey', 'authDomain', 'projectId', 'storageBucket', 'messagingSenderId', 'appId'];
const missing = requiredKeys.filter(k => !firebaseConfig[k] || firebaseConfig[k] === '‚ùå MISSING' || firebaseConfig[k].length < 5);

if (missing.length > 0) {
  const errorMsg = `FATAL: Environment variables missing or invalid (${missing.join(', ')}).`;
  console.error('‚ùå', errorMsg);
  console.error('Current config:', firebaseConfig);
  console.error('Mode:', import.meta.env.MODE);

  // Show user-friendly error page
  document.body.innerHTML = `
    <div style="
      color: #dc2626;
      padding: 40px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      max-width: 600px;
      margin: 100px auto;
      background: #fef2f2;
      border: 2px solid #dc2626;
      border-radius: 8px;
    ">
      <h1 style="margin-top: 0;">‚ö†Ô∏è Configuration Error</h1>
      <p><strong>${errorMsg}</strong></p>
      <p style="font-size: 14px; color: #991b1b;">
        The application cannot start because required environment variables are not configured correctly.
      </p>
      <details style="margin-top: 20px; font-size: 12px; color: #7f1d1d;">
        <summary style="cursor: pointer; font-weight: bold;">Technical Details</summary>
        <pre style="background: white; padding: 10px; border-radius: 4px; margin-top: 10px; overflow-x: auto;">Mode: ${import.meta.env.MODE}
Missing: ${missing.join(', ')}
Project ID: ${firebaseConfig.projectId || 'NOT SET'}</pre>
      </details>
    </div>
  `;

  throw new Error(errorMsg);
}

// FIX 4: Environment guard - Staging warning for ddd-spark
// Show badge only when hostname contains 'ddd-spark'
if (window.location.hostname.includes('ddd-spark')) {
  console.warn(
    '%c‚ö†Ô∏è STAGING - DB: DDD-SPARK ‚ö†Ô∏è',
    'background: #ff9800; color: #000; font-size: 20px; font-weight: bold; padding: 10px;'
  );
  console.warn('This is NOT production. Project:', firebaseConfig.projectId);

  // Add visual badge to page
  window.addEventListener('DOMContentLoaded', () => {
    const badge = document.createElement('div');
    badge.id = 'staging-badge';
    badge.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      background: linear-gradient(135deg, #ff9800 0%, #ff5722 100%);
      color: white;
      padding: 8px 20px;
      font-weight: bold;
      font-size: 14px;
      z-index: 999999;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
      border-radius: 0 0 8px 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    `;
    badge.textContent = '‚ö†Ô∏è STAGING - DB: DDD-SPARK';
    document.body.appendChild(badge);
  });
}

// Initialize Firebase
console.log('üî• Initializing Firebase with projectId:', firebaseConfig.projectId);
const app = initializeApp(firebaseConfig);
console.log('‚úÖ Firebase initialized successfully');

// Initialize Firebase services
export const auth = getAuth(app);
export const db = getFirestore(app);
export const storage = getStorage(app);

// Export the app instance as well (if needed elsewhere)
export default app;
</file>

<file path="src/ui/toast.js">
/**
 * toast.js
 * Reusable Toast Notification System
 * Provides elegant, Apple-style notifications for errors, success, and info messages
 */

/**
 * Show a toast notification
 * @param {string} message - The message to display
 * @param {string} type - Type of toast: 'error', 'success', 'info', 'warning'
 * @param {number} duration - Duration in ms (default: 4000, set to 0 for permanent)
 */
export function showToast(message, type = 'info', duration = 4000) {
  // Get or create toast container
  let container = document.getElementById('toast-container');
  if (!container) {
    container = document.createElement('div');
    container.id = 'toast-container';
    container.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 10px;
      pointer-events: none;
    `;
    document.body.appendChild(container);
  }

  // Create toast element
  const toast = document.createElement('div');
  toast.className = 'toast-notification';

  // Define colors based on type
  const colors = {
    error: { bg: '#FEE2E2', border: '#EF4444', text: '#991B1B', icon: '‚ùå' },
    success: { bg: '#D1FAE5', border: '#10B981', text: '#065F46', icon: '‚úÖ' },
    warning: { bg: '#FEF3C7', border: '#F59E0B', text: '#92400E', icon: '‚ö†Ô∏è' },
    info: { bg: '#DBEAFE', border: '#3B82F6', text: '#1E40AF', icon: '‚ÑπÔ∏è' }
  };

  const color = colors[type] || colors.info;

  toast.style.cssText = `
    background: ${color.bg};
    border-left: 4px solid ${color.border};
    color: ${color.text};
    padding: 12px 16px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    font-size: 14px;
    font-weight: 500;
    max-width: 350px;
    pointer-events: auto;
    opacity: 0;
    transform: translateX(100%);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    gap: 10px;
  `;

  toast.innerHTML = `
    <span style="font-size: 18px;">${color.icon}</span>
    <span style="flex: 1;">${message}</span>
    <button onclick="this.parentElement.remove()" style="
      background: none;
      border: none;
      color: ${color.text};
      font-size: 18px;
      cursor: pointer;
      padding: 0;
      line-height: 1;
      opacity: 0.7;
    ">&times;</button>
  `;

  container.appendChild(toast);

  // Animate in
  setTimeout(() => {
    toast.style.opacity = '1';
    toast.style.transform = 'translateX(0)';
  }, 10);

  // Auto-remove after duration (if not permanent)
  if (duration > 0) {
    setTimeout(() => {
      toast.style.opacity = '0';
      toast.style.transform = 'translateX(100%)';
      setTimeout(() => toast.remove(), 300);
    }, duration);
  }
}

/**
 * Convenience methods for specific toast types
 */
export function showErrorToast(message, duration = 5000) {
  showToast(message, 'error', duration);
}

export function showSuccessToast(message, duration = 3000) {
  showToast(message, 'success', duration);
}

export function showInfoToast(message, duration = 3000) {
  showToast(message, 'info', duration);
}

export function showWarningToast(message, duration = 4000) {
  showToast(message, 'warning', duration);
}
</file>

<file path="src/ui/ui.js">
/**
 * ui.js
 * Beheert alle UI-interacties: pagina's tonen/verbergen,
 * navigatieknoppen en de status van de UI bijwerken.
 */

// Importeer de "store" (globale state) om de data van de ingelogde gebruiker te lezen
import { getStore } from '../utils/store.js';

// Importeer de functies die we nodig hebben van andere modules
import { handleLogout, handleLogin, handleArtistSignup, handleProgrammerSignup, updateUserEmail, updateUserPassword } from '../services/auth.js';
import { setupArtistDashboard, populateArtistEditor } from '../modules/dashboard/dashboard-controller.js';
import { renderProgrammerDashboard, setupProgrammerDashboard } from '../modules/programmer/programmer-dashboard.js';
import { loadArtists, setupArtistSearch } from '../modules/search/search-controller.js';
import { renderArtistSearch } from '../modules/search/search-ui.js';
import { loadConversations } from '../modules/messaging/messaging-controller.js';
import { populateProgrammerEditor, renderProgrammerProfileEditor, setupProfileFormHandlers } from '../modules/programmer/programmer-profile.js';
import { setNavigationVisibility, updateDesktopNav, updateMobileNavActive } from '../modules/navigation/navigation.js';

// Importeer de view renderers
import {
  renderHome,
  renderLogin,
  renderSignup,
  renderArtistSignup,
  renderProgrammerSignup,
  renderMessages as renderMessagesView,
  renderDashboard as renderDashboardView,
  renderAccountSettings
} from './view-renderers.js'; 

// --- DOM Elementen ---
// We slaan alle belangrijke UI-elementen √©√©n keer op voor snelle toegang
const elements = {
  // Pagina-secties
  pageSections: document.querySelectorAll('.page-section'),
  loadingView: document.getElementById('loading-view'),
  homeView: document.getElementById('home-view'),
  loginView: document.getElementById('login-view'),
  signupView: document.getElementById('signup-view'),
  artistSignupView: document.getElementById('artist-signup-view'),
  programmerSignupView: document.getElementById('programmer-signup-view'),
  dashboardView: document.getElementById('dashboard-view'),

  // Navigatie & Gebruikersmenu
  navButtons: document.querySelectorAll('.nav-button'),
  navHome: document.getElementById('nav-home'),
  navLogin: document.getElementById('nav-login'),
  navSignup: document.getElementById('nav-signup'),
  navDashboard: document.getElementById('nav-dashboard'),
  navMessages: document.getElementById('nav-messages'),
  navSettings: document.getElementById('nav-settings'),
  navLogout: document.getElementById('nav-logout'),
  authLinks: document.getElementById('auth-links'),
  userMenu: document.getElementById('user-menu'),
  userEmailSpan: document.getElementById('user-email'),

  // Knoppen op de Homepagina
  homeCtaArtist: document.getElementById('home-cta-artist'),
  homeCtaProgrammer: document.getElementById('home-cta-programmer'),

  // Knoppen op de Aanmeld-keuzepagina
  signupChoiceArtist: document.getElementById('signup-choice-artist'),
  signupChoiceProgrammer: document.getElementById('signup-choice-programmer'),

  // Dashboard Specifieke Views
  artistDashboard: document.getElementById('artist-dashboard'),
  programmerDashboard: document.getElementById('programmer-dashboard'),
  programmerPendingView: document.getElementById('programmer-pending-view'),
  programmerProfileEditor: document.getElementById('programmer-profile-editor'),
  artistSearchSection: document.getElementById('artist-search-section'),
};

/**
 * Toont √©√©n specifieke pagina-sectie en verbergt alle andere.
 * NIEUWE ARCHITECTUUR: Alle content wordt dynamisch gerenderd in #app-content
 * @param {string} pageId - De ID van de pagina-sectie die getoond moet worden.
 * @param {boolean} updateHistory - Whether to update browser history (default: true)
 */
export function showPage(pageId, updateHistory = true) {
  const appContent = document.getElementById('app-content');

  // KRITIEK: Maak de container ALTIJD leeg voordat we nieuwe content renderen
  // Dit voorkomt dat oude views zichtbaar blijven
  if (appContent) {
    appContent.innerHTML = '';
  }

  // Update browser history with hash
  if (updateHistory) {
    const hash = pageId.replace('-view', '');
    if (window.location.hash !== `#${hash}`) {
      window.history.pushState({ pageId }, '', `#${hash}`);
    }
  }

  // Render de juiste view op basis van pageId
  switch(pageId) {
    case 'home-view':
      renderHome();
      break;
    case 'login-view':
      renderLogin();
      break;
    case 'signup-view':
      renderSignup();
      break;
    case 'artist-signup-view':
      renderArtistSignup();
      break;
    case 'programmer-signup-view':
      renderProgrammerSignup();
      break;
    case 'messages-view':
      renderMessagesView();
      break;
    case 'dashboard-view':
      renderDashboardView();
      break;
    case 'account-settings-view':
      renderAccountSettings();
      // Setup account settings form handlers after rendering
      setupAccountSettingsHandlers();
      break;
    default:
      console.warn(`Unknown page: ${pageId}`);
      renderHome();
  }

  // Re-initialize Lucide icons after rendering new content
  if (window.lucide) {
    setTimeout(() => lucide.createIcons(), 100);
  }
}

/**
 * Setup global form handlers with event delegation
 * Handles all auth forms (login, signup) regardless of when they're rendered
 * Uses capture phase to intercept events before any other handlers
 */
let globalFormHandlersInitialized = false;

export function setupGlobalFormHandlers() {
  if (globalFormHandlersInitialized) {
    console.log('[UI] Global form handlers already initialized, skipping');
    return;
  }

  console.log('[UI] Setting up global form handlers with capture phase');

  // PRIMARY: Use event delegation on document (highest level) with capture phase
  document.addEventListener('submit', async (e) => {
    console.log('‚ö°Ô∏è Global SUBMIT caught:', e.target.tagName, 'id:', e.target.id);

    const form = e.target;

    // Login form
    if (form.id === 'login-form') {
      console.log('[UI] ‚úÖ Login form submit intercepted - calling handleLogin');
      await handleLogin(e);
      return;
    }

    // Artist signup form
    if (form.id === 'artist-signup-form') {
      console.log('[UI] ‚úÖ Artist signup form submit intercepted');
      await handleArtistSignup(e);
      return;
    }

    // Programmer signup form
    if (form.id === 'programmer-signup-form') {
      console.log('[UI] ‚úÖ Programmer signup form submit intercepted');
      await handleProgrammerSignup(e);
      return;
    }

    // ‚úÖ FIX: Message form (inline chat messages)
    if (form.id === 'message-form') {
      console.log('[UI] ‚úÖ Message form submit intercepted');
      await handleInlineMessageSubmit(e);
      return;
    }
  }, { capture: true }); // CRITICAL: Capture phase ensures we intercept FIRST

  globalFormHandlersInitialized = true;
  console.log('[UI] ‚úÖ Global form handlers initialized successfully');
}

/**
 * ‚ú® OPTIMISTIC UI: Handle inline message form submission (chat replies)
 * Messages are added to UI immediately without re-rendering the entire chat
 */
async function handleInlineMessageSubmit(e) {
  e.preventDefault();

  const messageInput = document.getElementById('message-input');
  const messageText = messageInput?.value.trim();

  if (!messageText) return;

  const chatContainer = document.getElementById('chat-container');
  const conversationId = chatContainer?.dataset.conversationId;

  if (!conversationId) {
    console.error('[UI] No conversation ID found');
    return;
  }

  try {
    const currentUser = getStore('currentUser');
    const currentUserData = getStore('currentUserData');

    if (!currentUser || !currentUserData) {
      throw new Error('User not logged in');
    }

    console.log('[UI] Sending message to conversation:', conversationId);

    // ‚ú® OPTIMISTIC UI: Create message object for immediate display
    const optimisticMessage = {
      senderId: currentUser.uid,
      senderName: `${currentUserData.firstName} ${currentUserData.lastName}`,
      senderRole: currentUserData.role,
      senderProfilePic: currentUserData.profilePicUrl || '',
      text: messageText,
      createdAt: null, // Will show "Just now"
      read: false
    };

    // Clear input immediately (better UX)
    messageInput.value = '';

    // Import messaging functions dynamically
    const { addMessage, appendMessageToUI } = await import('../modules/messaging/messaging-controller.js');

    // ‚ú® OPTIMISTIC UI: Add message to UI immediately (no re-render!)
    appendMessageToUI(optimisticMessage);

    // Send message to Firestore in background
    await addMessage(conversationId, currentUser.uid, currentUserData, messageText);

    console.log('[UI] ‚úÖ Message sent successfully with optimistic UI');

  } catch (error) {
    console.error('[UI] Error sending message:', error);
    alert('Failed to send message. Please try again.');
  }
}


/**
 * Werkt de navigatiebalk bij op basis van de inlogstatus.
 * @param {object | null} user - Het Firebase user-object (of null als uitgelogd).
 */
export function updateNav(user) {
  const appHeader = document.getElementById('app-header');
  const navLogoutMobile = document.getElementById('nav-logout-mobile');
  const userEmailMobile = document.getElementById('user-email-mobile');

  if (user) {
    // Ingelogd - Show navigation using centralized function
    setNavigationVisibility(true);

    // Update desktop nav with current user data
    updateDesktopNav();

    // Show app header
    if (appHeader) {
      appHeader.classList.remove('hidden');
    }

    // Show mobile logout button
    if (navLogoutMobile) {
      navLogoutMobile.classList.remove('hidden');
    }

    // Update mobile email
    if (userEmailMobile) {
      userEmailMobile.textContent = user.email;
      userEmailMobile.classList.remove('hidden');
    }

    // Re-initialize icons
    if (window.lucide) {
      setTimeout(() => lucide.createIcons(), 100);
    }
  } else {
    // Uitgelogd - Hide navigation using centralized function
    setNavigationVisibility(false);

    // Hide app header
    if (appHeader) {
      appHeader.classList.add('hidden');
    }

    // Hide mobile elements
    if (navLogoutMobile) {
      navLogoutMobile.classList.add('hidden');
    }

    if (userEmailMobile) {
      userEmailMobile.textContent = '';
      userEmailMobile.classList.add('hidden');
    }
  }
}

/**
 * Helper: Show/hide artist search section consistently
 * @param {boolean} show - Whether to show (true) or hide (false) the search section
 * Note: Full visibility forcing happens in loadArtists() via forceSearchResultsVisible()
 */
function toggleArtistSearchSection(show) {
  const artistSearchSection = document.getElementById('artist-search-section');
  if (!artistSearchSection) return;

  if (show) {
    // üî• NUCLEAR VISIBILITY FORCING
    artistSearchSection.style.display = 'block';
    artistSearchSection.style.opacity = '1';
    artistSearchSection.style.visibility = 'visible';
    artistSearchSection.style.zIndex = '1';
    artistSearchSection.classList.remove('hidden');
    console.log('[UI] üî• Artist search section FORCED VISIBLE');
  } else {
    artistSearchSection.style.display = 'none';
    artistSearchSection.classList.add('hidden');
    console.log('[UI] Artist search section hidden');
  }
}

/**
 * Helper: Show/hide profile sections (overview, preview, editor)
 * @param {boolean} show - Whether to show (true) or hide (false)
 */
function toggleProfileSections(show) {
  const profileOverview = document.getElementById('programmer-profile-overview');
  const publicPreview = document.getElementById('programmer-public-preview');

  if (profileOverview) {
    if (show) {
      profileOverview.style.display = 'block';
      profileOverview.classList.remove('hidden');
    } else {
      profileOverview.style.display = 'none';
      profileOverview.classList.add('hidden');
    }
  }

  if (publicPreview) {
    if (show) {
      publicPreview.style.display = 'block';
      publicPreview.classList.remove('hidden');
    } else {
      publicPreview.style.display = 'none';
      publicPreview.classList.add('hidden');
    }
  }
}

/**
 * Toont het juiste dashboard (Artiest of Programmeur) op basis van de rol.
 */
export function showDashboard() {
  const currentUserData = getStore('currentUserData');

  if (!currentUserData) {
    console.warn("Geen gebruikersdata gevonden, kan dashboard niet tonen. Terug naar home.");
    showPage('home-view');
    return;
  }

  // STAP 1: Render de dashboard container structuur
  showPage('dashboard-view');

  // STAP 2: Render de specifieke dashboard content op basis van rol
  const { role, status } = currentUserData;

  if (role === 'artist') {
    // Get the dynamically rendered containers
    const artistDashboard = document.getElementById('artist-dashboard');
    const programmerDashboard = document.getElementById('programmer-dashboard');

    if (artistDashboard) {
      artistDashboard.style.display = 'block';
      artistDashboard.classList.remove('hidden');
    }
    if (programmerDashboard) {
      programmerDashboard.style.display = 'none';
      programmerDashboard.classList.add('hidden');
    }

    // Setup dashboard (handles rendering + initialization internally)
    setupArtistDashboard();
  } else if (role === 'programmer') {
    // Get the dynamically rendered containers
    const artistDashboard = document.getElementById('artist-dashboard');
    const programmerDashboard = document.getElementById('programmer-dashboard');

    if (artistDashboard) {
      artistDashboard.style.display = 'none';
      artistDashboard.classList.add('hidden');
    }
    if (programmerDashboard) {
      // üî• FORCE VISIBILITY on programmer dashboard
      programmerDashboard.style.display = 'block';
      programmerDashboard.style.opacity = '1';
      programmerDashboard.style.visibility = 'visible';
      programmerDashboard.style.zIndex = '1';
      programmerDashboard.classList.remove('hidden');
      console.log('[UI] üëÄ Programmer dashboard FORCED VISIBLE');
    }

    // Render the programmer dashboard HTML
    renderProgrammerDashboard();
    // Setup dashboard AFTER rendering HTML (so elements exist)
    setupProgrammerDashboard();

    // Get pending view dynamically
    const pendingView = document.getElementById('programmer-pending-view');

    // Get profile editor dynamically
    const programmerProfileEditor = document.getElementById('programmer-profile-editor');
    if (programmerProfileEditor) {
      programmerProfileEditor.classList.add('hidden');
      programmerProfileEditor.style.display = 'none';
    }

    // ‚úÖ FIX: Show profile sections in dashboard view
    toggleProfileSections(true);

    if (status === 'pending') {
      // Verberg de zoekfilters, toon "pending" bericht
      if (pendingView) pendingView.style.display = 'block';
      // ‚úÖ FIX: Hide artist search in pending state
      toggleArtistSearchSection(false);
    } else {
      // Toon de zoekfilters en verberg "pending"
      if (pendingView) pendingView.style.display = 'none';

      // ‚úÖ FIX: Show artist search section
      toggleArtistSearchSection(true);

      // Render the artist search view dynamically
      renderArtistSearch();

      // ‚úÖ FIX: Setup search after rendering HTML (so event listeners can attach)
      setupArtistSearch();

      // Auto-load all artists when dashboard loads
      loadArtists();
    }
  }

  // Re-initialize Lucide icons
  if (window.lucide) {
    setTimeout(() => lucide.createIcons(), 100);
  }
}

/**
 * Shows programmer settings (profile editor)
 */
export function showProgrammerSettings() {
  const currentUserData = getStore('currentUserData');

  if (!currentUserData || currentUserData.role !== 'programmer') {
    console.warn("Only programmers can access settings");
    return;
  }

  console.log('[UI] Showing programmer settings view');

  // STAP 1: Render de dashboard container structuur
  showPage('dashboard-view');

  // STAP 2: Get the dynamically rendered containers
  const artistDashboard = document.getElementById('artist-dashboard');
  const programmerDashboard = document.getElementById('programmer-dashboard');

  // Show programmer dashboard
  if (artistDashboard) {
    artistDashboard.style.display = 'none';
    artistDashboard.classList.add('hidden');
  }
  if (programmerDashboard) {
    programmerDashboard.style.display = 'block';
    programmerDashboard.classList.remove('hidden');
  }

  // Render the programmer dashboard HTML first
  renderProgrammerDashboard();
  // Setup dashboard AFTER rendering HTML
  setupProgrammerDashboard();

  // Get dynamically rendered elements
  const pendingView = document.getElementById('programmer-pending-view');

  // Hide the pending view
  if (pendingView) pendingView.style.display = 'none';

  // ‚úÖ FIX: Hide artist search section in Settings view
  toggleArtistSearchSection(false);

  // ‚úÖ FIX: Show profile sections in Settings view
  toggleProfileSections(true);

  // Get the profile editor dynamically
  const programmerProfileEditor = document.getElementById('programmer-profile-editor');

  // Show the profile editor
  if (programmerProfileEditor) {
    // Render the editor HTML first
    renderProgrammerProfileEditor();

    programmerProfileEditor.classList.remove('hidden');
    programmerProfileEditor.style.display = 'block';

    // Setup form handlers after rendering
    setupProfileFormHandlers();

    // Populate the editor with current data
    populateProgrammerEditor();

    // Scroll to the profile editor
    setTimeout(() => {
      programmerProfileEditor.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }, 100);
  }

  // Re-initialize Lucide icons
  if (window.lucide) {
    setTimeout(() => lucide.createIcons(), 100);
  }
}

/**
 * Toont de messages/conversations pagina
 */
export function showMessages() {
  console.log("Showing messages view");

  // Render the messages view
  showPage('messages-view');

  // Laad conversaties AFTER rendering the view
  loadConversations();
}

/**
 * Voegt alle event listeners toe voor de navigatieknoppen.
 * Wordt √©√©n keer uitgevoerd bij het laden van de app.
 * ‚úÖ Uses event delegation for all dynamically rendered elements
 */
export function initNavigation() {
  // ‚úÖ Global click handler with event delegation
  document.body.addEventListener('click', (e) => {
    // Mobile logout button
    if (e.target.closest('#nav-logout-mobile')) {
      console.log('[UI] Mobile logout clicked');
      handleLogout();
      return;
    }

    // Home CTA buttons
    if (e.target.closest('#home-cta-artist')) {
      showPage('artist-signup-view');
      return;
    }

    if (e.target.closest('#home-cta-programmer')) {
      showPage('programmer-signup-view');
      return;
    }

    // Home login button
    if (e.target.closest('#home-login-btn')) {
      showPage('login-view');
      return;
    }

    // Signup choice buttons
    if (e.target.closest('#signup-choice-artist')) {
      showPage('artist-signup-view');
      return;
    }

    if (e.target.closest('#signup-choice-programmer')) {
      showPage('programmer-signup-view');
      return;
    }

    // Back buttons
    if (e.target.closest('#back-to-home-from-login')) {
      showPage('home-view');
      return;
    }

    if (e.target.closest('#back-to-home-from-signup')) {
      showPage('home-view');
      return;
    }

    if (e.target.closest('#back-from-artist-signup')) {
      showPage('signup-view');
      return;
    }

    if (e.target.closest('#back-from-programmer-signup')) {
      showPage('signup-view');
      return;
    }
  });

  // Bottom Navigation
  setupBottomNavigation();

  // Desktop Navigation
  setupDesktopNavigation();

  console.log('[UI] Navigation initialization complete with event delegation');
}

/**
 * Setup bottom navigation with event delegation
 */
function setupBottomNavigation() {
  const bottomNav = document.getElementById('bottom-nav');
  if (!bottomNav) return;

  // Use event delegation on the bottom nav container
  bottomNav.addEventListener('click', (e) => {
    const navItem = e.target.closest('.bottom-nav-item');
    if (!navItem) return;

    const navAction = navItem.dataset.nav;

    // Update active state
    updateBottomNavActive(navAction);

    // Handle navigation (showPage/showDashboard/etc. handle hash updates now)
    switch(navAction) {
      case 'search':
        showDashboard(); // Show search/dashboard (updates hash internally)
        break;
      case 'profile':
        showDashboard(); // Show profile/dashboard (updates hash internally)
        break;
      case 'messages':
        showMessages(); // Updates hash internally
        break;
      case 'settings':
        showAccountSettings(); // Updates hash internally
        break;
    }

    // Re-initialize icons after navigation
    if (window.lucide) {
      setTimeout(() => lucide.createIcons(), 100);
    }
  });
}

/**
 * Update active state of bottom navigation items
 * (Wrapper function - delegates to navigation.js)
 */
function updateBottomNavActive(activeNav) {
  updateMobileNavActive(activeNav);
}

/**
 * Setup desktop navigation with dropdown and search
 * ‚úÖ FIX: Uses event delegation to handle dynamically rendered navigation
 */
function setupDesktopNavigation() {
  // ‚úÖ Use event delegation on document body to catch clicks from dynamically rendered nav
  document.body.addEventListener('click', (e) => {
    // Desktop Profile
    if (e.target.closest('#desktop-nav-profile')) {
      showDashboard(); // Updates hash internally
      return;
    }

    // Desktop Messages
    if (e.target.closest('#desktop-nav-messages')) {
      showMessages(); // Updates hash internally
      return;
    }

    // Desktop Profile Settings (Programmer: edit profile, Artist: edit profile)
    if (e.target.closest('#desktop-profile-settings')) {
      const dropdown = document.getElementById('desktop-profile-dropdown');
      if (dropdown) dropdown.classList.add('hidden');
      showProgrammerSettings(); // Updates hash internally
      return;
    }

    // Desktop Account Settings (Email/Password)
    if (e.target.closest('#desktop-account-settings')) {
      const dropdown = document.getElementById('desktop-profile-dropdown');
      if (dropdown) dropdown.classList.add('hidden');
      showAccountSettings(); // Updates hash internally
      return;
    }

    // ‚úÖ FIX: Desktop Logout with event delegation
    if (e.target.closest('#desktop-logout')) {
      console.log('[UI] Desktop logout clicked');
      const dropdown = document.getElementById('desktop-profile-dropdown');
      if (dropdown) dropdown.classList.add('hidden');
      handleLogout();
      return;
    }

    // Desktop Profile Button (toggle dropdown)
    const profileBtn = e.target.closest('#desktop-profile-btn');
    if (profileBtn) {
      e.stopPropagation();
      const dropdown = document.getElementById('desktop-profile-dropdown');
      if (dropdown) {
        dropdown.classList.toggle('hidden');
      }
      return;
    }

    // Close dropdown when clicking outside
    const dropdown = document.getElementById('desktop-profile-dropdown');
    const profileBtnElement = document.getElementById('desktop-profile-btn');
    if (dropdown && profileBtnElement) {
      if (!dropdown.classList.contains('hidden') &&
          !profileBtnElement.contains(e.target) &&
          !dropdown.contains(e.target)) {
        dropdown.classList.add('hidden');
      }
    }
  });

  console.log('[UI] Desktop navigation event delegation setup complete');
}

/**
 * Setup Account Settings form handlers
 * Called after rendering the Account Settings view
 */
function setupAccountSettingsHandlers() {
  const changeEmailForm = document.getElementById('change-email-form');
  const changePasswordForm = document.getElementById('change-password-form');

  if (!changeEmailForm || !changePasswordForm) {
    console.warn('[UI] Account settings forms not found');
    return;
  }

  // Handle email change
  changeEmailForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    const newEmail = document.getElementById('new-email').value;
    const currentPassword = document.getElementById('confirm-email-password').value;
    const successMsg = document.getElementById('email-success');
    const errorMsg = document.getElementById('email-error');
    const submitBtn = e.submitter || e.target.querySelector('button[type="submit"]');

    // Reset messages
    successMsg.textContent = '';
    errorMsg.textContent = '';

    // Disable button
    submitBtn.disabled = true;
    submitBtn.textContent = 'Updating...';

    try {
      await updateUserEmail(newEmail, currentPassword);
      successMsg.textContent = '‚úì Email updated successfully! Please log in again with your new email.';

      // Clear form
      changeEmailForm.reset();

      // Log out user after email change (Firebase requirement)
      setTimeout(() => {
        handleLogout();
      }, 2000);
    } catch (error) {
      console.error('[UI] Error updating email:', error);
      errorMsg.textContent = `Error: ${error.message}`;
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = 'Update Email';
    }
  });

  // Handle password change
  changePasswordForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    const currentPassword = document.getElementById('current-password').value;
    const newPassword = document.getElementById('new-password').value;
    const confirmPassword = document.getElementById('confirm-password').value;
    const successMsg = document.getElementById('password-success');
    const errorMsg = document.getElementById('password-error');
    const submitBtn = e.submitter || e.target.querySelector('button[type="submit"]');

    // Reset messages
    successMsg.textContent = '';
    errorMsg.textContent = '';

    // Validate passwords match
    if (newPassword !== confirmPassword) {
      errorMsg.textContent = 'New passwords do not match';
      return;
    }

    // Disable button
    submitBtn.disabled = true;
    submitBtn.textContent = 'Updating...';

    try {
      await updateUserPassword(currentPassword, newPassword);
      successMsg.textContent = '‚úì Password updated successfully!';

      // Clear form
      changePasswordForm.reset();
    } catch (error) {
      console.error('[UI] Error updating password:', error);
      errorMsg.textContent = `Error: ${error.message}`;
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = 'Update Password';
    }
  });

  console.log('[UI] Account settings handlers setup complete');
}

/**
 * Shows the Account Settings page
 */
export function showAccountSettings() {
  console.log('[UI] Showing account settings view');

  // Hide artist search section
  toggleArtistSearchSection(false);

  showPage('account-settings-view');
}
</file>

<file path="src/ui/view-renderers.js">
/**
 * view-renderers.js
 * Centralized view rendering functions
 * All views are rendered dynamically into #app-content
 */

/**
 * Renders the Home/Welcome view
 */
export function renderHome() {
  const appContent = document.getElementById('app-content');
  appContent.innerHTML = `
    <div id="home-view" class="min-h-screen flex flex-col">
      <!-- Hero Section -->
      <div class="flex-1 flex flex-col justify-center px-6 py-12 bg-gradient-to-br from-indigo-50 to-white">
        <div class="text-center mb-8">
          <div class="mb-6">
            <svg class="h-16 w-16 mx-auto text-indigo-600" xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/>
              <path d="M12 5 9 8h6l-3-3Z"/>
            </svg>
          </div>
          <h1 class="text-4xl font-bold text-gray-900 mb-3 tracking-tight">
            SPOKEN WORD<br/>PLATFORM
          </h1>
          <p class="text-lg text-gray-600 mb-2">Find Your Voice.</p>
          <p class="text-lg text-indigo-600 font-semibold">Book Your Artist.</p>
        </div>

        <div class="space-y-3 max-w-sm mx-auto w-full px-6">
          <button id="home-cta-artist" class="btn-press w-full bg-indigo-600 text-white px-6 py-4 rounded-xl text-base font-semibold shadow-lg hover:bg-indigo-700 transition duration-200">
            Ik ben een Artiest
          </button>
          <button id="home-cta-programmer" class="btn-press w-full bg-gray-900 text-white px-6 py-4 rounded-xl text-base font-semibold shadow-lg hover:bg-gray-800 transition duration-200">
            Ik ben een Programmator
          </button>
          <button id="home-login-btn" class="btn-press w-full bg-white text-gray-900 px-6 py-4 rounded-xl text-base font-semibold border border-gray-300 hover:bg-gray-50 transition duration-200">
            Inloggen
          </button>
        </div>
      </div>

      <!-- Featured Artists Preview -->
      <div class="px-6 py-8 bg-white">
        <h3 class="text-xl font-bold text-gray-900 mb-4">Featured Artists</h3>
        <div class="space-y-4">
          <div class="flex items-center space-x-4 p-4 bg-gray-50 rounded-xl">
            <div class="w-16 h-16 bg-indigo-100 rounded-full flex-shrink-0"></div>
            <div class="flex-1">
              <h4 class="font-semibold text-gray-900">Artist Name</h4>
              <p class="text-sm text-indigo-600">Performance Poetry</p>
              <p class="text-xs text-gray-500 mt-1">Amsterdam</p>
            </div>
          </div>
          <div class="flex items-center space-x-4 p-4 bg-gray-50 rounded-xl">
            <div class="w-16 h-16 bg-purple-100 rounded-full flex-shrink-0"></div>
            <div class="flex-1">
              <h4 class="font-semibold text-gray-900">Stage Name</h4>
              <p class="text-sm text-indigo-600">Poetry Slam</p>
              <p class="text-xs text-gray-500 mt-1">Brussels</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Version Badge -->
      <div class="text-center py-6 text-xs text-gray-400">
        Release v2.5 [Final Build] - 23-12-2025
      </div>
    </div>
  `;
}

/**
 * Renders the Login view
 * Clean, standard implementation with proper form submission
 * Uses global event delegation via setupGlobalFormHandlers()
 */
export function renderLogin() {
  const appContent = document.getElementById('app-content');
  appContent.innerHTML = `
    <div id="login-view" class="min-h-screen flex items-center justify-center px-6 py-12">
      <div class="w-full max-w-sm">
        <div class="text-center mb-8">
          <h2 class="text-3xl font-bold text-gray-900 mb-2">Welkom terug</h2>
          <p class="text-gray-600">Log in op je account</p>
        </div>

        <form id="login-form" class="space-y-4">
          <div>
            <label for="login-email" class="block text-sm font-semibold text-gray-700 mb-2">Email</label>
            <input id="login-email" name="email" type="email" autocomplete="email" required
              class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500">
          </div>
          <div>
            <label for="login-password" class="block text-sm font-semibold text-gray-700 mb-2">Wachtwoord</label>
            <input id="login-password" name="password" type="password" autocomplete="current-password" required
              class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500">
          </div>
          <button type="submit" id="login-submit-btn"
            class="w-full py-3 px-4 rounded-xl text-base font-semibold text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors mt-6">
            Inloggen
          </button>
          <p id="login-error" class="text-red-500 text-sm mt-2 text-center"></p>
        </form>

        <div class="mt-6 text-center">
          <button id="back-to-home-from-login" class="text-indigo-600 text-sm font-medium hover:text-indigo-800 transition-colors">
            ‚Üê Terug naar home
          </button>
        </div>
      </div>
    </div>
  `;
}

/**
 * Renders the Signup Choice view
 */
export function renderSignup() {
  const appContent = document.getElementById('app-content');
  appContent.innerHTML = `
    <div id="signup-view" class="min-h-screen flex items-center justify-center px-6 py-12">
      <div class="w-full max-w-sm">
        <h2 class="text-3xl font-bold text-center text-gray-900 mb-8">Meld je aan als...</h2>
        <div class="space-y-4">
          <button id="signup-choice-artist" class="btn-press w-full py-4 px-4 rounded-xl text-base font-semibold text-white bg-indigo-600 hover:bg-indigo-700">
            Artiest / Spoken Word Member
          </button>
          <button id="signup-choice-programmer" class="btn-press w-full py-4 px-4 rounded-xl text-base font-semibold text-white bg-gray-900 hover:bg-gray-800">
            Programmator / Organisatie
          </button>
        </div>
        <div class="mt-6 text-center">
          <button id="back-to-home-from-signup" class="text-indigo-600 text-sm font-medium">
            ‚Üê Terug naar home
          </button>
        </div>
      </div>
    </div>
  `;
}

/**
 * Renders the Artist Signup Form view
 */
export function renderArtistSignup() {
  const appContent = document.getElementById('app-content');
  appContent.innerHTML = `
    <div id="artist-signup-view">
      <div class="px-6 py-8">
        <div class="mb-6">
          <button id="back-from-artist-signup" class="text-indigo-600 text-sm font-medium mb-4">
            ‚Üê Terug
          </button>
          <h2 class="text-3xl font-bold text-gray-900 mb-2">Maak je Artiest Profiel</h2>
          <p class="text-gray-600 text-sm">Vul zoveel mogelijk in. Je kunt later meer toevoegen.</p>
        </div>

        <form id="artist-signup-form" class="space-y-6">
          <!-- Account Credentials -->
          <div class="bg-white p-6 rounded-xl shadow-sm">
            <h3 class="text-lg font-bold mb-4 text-gray-900">Account Details</h3>
            <div class="space-y-4">
              <div>
                <label for="artist-email" class="block text-sm font-semibold text-gray-700 mb-2">Email *</label>
                <input id="artist-email" type="email" required class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500">
              </div>
              <div>
                <label for="artist-password" class="block text-sm font-semibold text-gray-700 mb-2">Wachtwoord (min. 6 tekens) *</label>
                <input id="artist-password" type="password" required class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500">
              </div>
            </div>
          </div>

          <!-- Personal Details -->
          <div class="bg-white p-6 rounded-xl shadow-sm">
            <h3 class="text-lg font-bold mb-4 text-gray-900">Persoonlijke Gegevens</h3>
            <div class="space-y-4">
              <div class="grid grid-cols-2 gap-3">
                <div>
                  <label for="artist-firstname" class="block text-sm font-semibold text-gray-700 mb-2">Voornaam *</label>
                  <input id="artist-firstname" type="text" required class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <div>
                  <label for="artist-lastname" class="block text-sm font-semibold text-gray-700 mb-2">Achternaam *</label>
                  <input id="artist-lastname" type="text" required class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
              </div>
              <div>
                <label for="artist-stagename" class="block text-sm font-semibold text-gray-700 mb-2">Artiestennaam</label>
                <input id="artist-stagename" type="text" class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500">
              </div>
              <div>
                <label for="artist-phone" class="block text-sm font-semibold text-gray-700 mb-2">Telefoon *</label>
                <input id="artist-phone" type="tel" required class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500">
              </div>
              <div>
                <label for="artist-dob" class="block text-sm font-semibold text-gray-700 mb-2">Geboortedatum *</label>
                <input id="artist-dob" type="date" required class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500">
              </div>
              <div>
                <label for="artist-gender" class="block text-sm font-semibold text-gray-700 mb-2">Geslacht *</label>
                <select id="artist-gender" required class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500">
                  <option value="">Selecteer...</option>
                  <option value="f">Vrouw</option>
                  <option value="m">Man</option>
                  <option value="x">Anders / Wil niet zeggen</option>
                </select>
              </div>
              <div>
                <label for="artist-location" class="block text-sm font-semibold text-gray-700 mb-2">Locatie *</label>
                <input id="artist-location" type="text" required placeholder="bijv. Amsterdam, Nederland" class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500">
              </div>
            </div>
          </div>

          <!-- Professional Details -->
          <div class="bg-white p-6 rounded-xl shadow-sm">
            <h3 class="text-lg font-bold mb-4 text-gray-900">Professionele Details</h3>

            <!-- Genres -->
            <div class="mb-4">
              <label class="block text-sm font-semibold text-gray-700 mb-3">Genres (selecteer meerdere) *</label>
              <div class="space-y-2">
                <label class="flex items-center space-x-3 p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition">
                  <input type="checkbox" name="artist-genres" value="performance-poetry" class="h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500">
                  <span class="text-sm font-medium">Performance Poetry</span>
                </label>
                <label class="flex items-center space-x-3 p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition">
                  <input type="checkbox" name="artist-genres" value="poetry-slam" class="h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500">
                  <span class="text-sm font-medium">Poetry Slam</span>
                </label>
                <label class="flex items-center space-x-3 p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition">
                  <input type="checkbox" name="artist-genres" value="jazz-poetry" class="h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500">
                  <span class="text-sm font-medium">Jazz Poetry</span>
                </label>
                <label class="flex items-center space-x-3 p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition">
                  <input type="checkbox" name="artist-genres" value="rap" class="h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500">
                  <span class="text-sm font-medium">Rap</span>
                </label>
                <label class="flex items-center space-x-3 p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition">
                  <input type="checkbox" name="artist-genres" value="storytelling" class="h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500">
                  <span class="text-sm font-medium">Storytelling</span>
                </label>
                <label class="flex items-center space-x-3 p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition">
                  <input type="checkbox" name="artist-genres" value="comedy" class="h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500">
                  <span class="text-sm font-medium">Comedy</span>
                </label>
                <label class="flex items-center space-x-3 p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition">
                  <input type="checkbox" name="artist-genres" value="1-on-1" class="h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500">
                  <span class="text-sm font-medium">1-op-1 Sessies</span>
                </label>
              </div>
            </div>

            <!-- Languages -->
            <div class="mb-4">
              <label class="block text-sm font-semibold text-gray-700 mb-3">Talen (selecteer meerdere) *</label>
              <div class="grid grid-cols-2 gap-2">
                <label class="flex items-center space-x-3 p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition">
                  <input type="checkbox" name="artist-languages" value="nl" class="h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500">
                  <span class="text-sm font-medium">Nederlands</span>
                </label>
                <label class="flex items-center space-x-3 p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition">
                  <input type="checkbox" name="artist-languages" value="en" class="h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500">
                  <span class="text-sm font-medium">Engels</span>
                </label>
                <label class="flex items-center space-x-3 p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition">
                  <input type="checkbox" name="artist-languages" value="fr" class="h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500">
                  <span class="text-sm font-medium">Frans</span>
                </label>
              </div>
            </div>

            <!-- Payment Methods -->
            <div class="mb-4">
              <label class="block text-sm font-semibold text-gray-700 mb-3">Betaalmethoden *</label>
              <div class="space-y-2">
                <label class="flex items-center space-x-3 p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition">
                  <input type="checkbox" name="artist-payment" value="invoice" class="h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500">
                  <span class="text-sm font-medium">Factuur</span>
                </label>
                <label class="flex items-center space-x-3 p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition">
                  <input type="checkbox" name="artist-payment" value="payrolling" class="h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500">
                  <span class="text-sm font-medium">Payrolling</span>
                </label>
                <label class="flex items-center space-x-3 p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition">
                  <input type="checkbox" name="artist-payment" value="sbk" class="h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500">
                  <span class="text-sm font-medium">Anders (SBK)</span>
                </label>
                <label class="flex items-center space-x-3 p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition">
                  <input type="checkbox" name="artist-payment" value="volunteer-fee" class="h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500">
                  <span class="text-sm font-medium">Vrijwilligersvergoeding</span>
                </label>
                <label class="flex items-center space-x-3 p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition">
                  <input type="checkbox" name="artist-payment" value="other" class="h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500">
                  <span class="text-sm font-medium">Anders</span>
                </label>
              </div>
            </div>

            <!-- Bio & Pitch -->
            <div class="space-y-4">
              <div>
                <label for="artist-bio" class="block text-sm font-semibold text-gray-700 mb-2">Bio *</label>
                <textarea id="artist-bio" rows="4" required class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
              </div>
              <div>
                <label for="artist-pitch" class="block text-sm font-semibold text-gray-700 mb-2">Pitch *</label>
                <textarea id="artist-pitch" rows="2" required placeholder="Korte samenvatting voor programmatoren" class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
              </div>
            </div>
          </div>

          <!-- Terms -->
          <div class="bg-white p-6 rounded-xl shadow-sm">
            <div class="space-y-3">
              <label class="flex items-start space-x-3">
                <input id="artist-notify-email" type="checkbox" checked class="h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500 mt-0.5">
                <span class="text-sm text-gray-700">OK om email notificaties te ontvangen</span>
              </label>
              <label class="flex items-start space-x-3">
                <input id="artist-notify-sms" type="checkbox" class="h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500 mt-0.5">
                <span class="text-sm text-gray-700">OK om SMS notificaties te ontvangen</span>
              </label>
              <label class="flex items-start space-x-3">
                <input id="artist-terms" type="checkbox" required class="h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500 mt-0.5">
                <span class="text-sm text-gray-700">Ik ga akkoord met de <a href="#" class="font-semibold text-indigo-600">Algemene Voorwaarden</a> *</span>
              </label>
            </div>
          </div>

          <button type="submit"
            class="btn-press w-full py-4 px-4 rounded-xl text-base font-semibold text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none">
            Account Aanmaken
          </button>
          <p id="artist-signup-error" class="text-red-500 text-sm mt-2 text-center"></p>
        </form>
      </div>
    </div>
  `;
}

/**
 * Renders the Programmer Signup Form view
 */
export function renderProgrammerSignup() {
  const appContent = document.getElementById('app-content');
  appContent.innerHTML = `
    <div id="programmer-signup-view">
      <div class="px-6 py-8">
        <div class="mb-6">
          <button id="back-from-programmer-signup" class="text-indigo-600 text-sm font-medium mb-4">
            ‚Üê Terug
          </button>
          <h2 class="text-3xl font-bold text-gray-900 mb-2">Maak je Programmator Account</h2>
          <p class="text-gray-600 text-sm">Start je 7-daagse gratis proefperiode.</p>
        </div>

        <form id="programmer-signup-form" class="space-y-6">
          <!-- Account Details -->
          <div class="bg-white p-6 rounded-xl shadow-sm">
            <h3 class="text-lg font-bold mb-4 text-gray-900">Account Details</h3>
            <div class="space-y-4">
              <div>
                <label for="prog-email" class="block text-sm font-semibold text-gray-700 mb-2">Email *</label>
                <input id="prog-email" type="email" required class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500">
              </div>
              <div>
                <label for="prog-password" class="block text-sm font-semibold text-gray-700 mb-2">Wachtwoord (min. 6 tekens) *</label>
                <input id="prog-password" type="password" required class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500">
              </div>
            </div>
          </div>

          <!-- Organization Details -->
          <div class="bg-white p-6 rounded-xl shadow-sm">
            <h3 class="text-lg font-bold mb-4 text-gray-900">Organisatie Details</h3>
            <div class="space-y-4">
              <div class="grid grid-cols-2 gap-3">
                <div>
                  <label for="prog-firstname" class="block text-sm font-semibold text-gray-700 mb-2">Voornaam *</label>
                  <input id="prog-firstname" type="text" required class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <div>
                  <label for="prog-lastname" class="block text-sm font-semibold text-gray-700 mb-2">Achternaam *</label>
                  <input id="prog-lastname" type="text" required class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
              </div>
              <div>
                <label for="prog-org-name" class="block text-sm font-semibold text-gray-700 mb-2">Organisatie Naam *</label>
                <input id="prog-org-name" type="text" required class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500">
              </div>
              <div>
                <label for="prog-phone" class="block text-sm font-semibold text-gray-700 mb-2">Telefoon *</label>
                <input id="prog-phone" type="tel" required class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500">
              </div>
              <div>
                <label for="prog-website" class="block text-sm font-semibold text-gray-700 mb-2">Website</label>
                <input id="prog-website" type="url" placeholder="https://..." class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500">
              </div>
              <div>
                <label for="prog-org-about" class="block text-sm font-semibold text-gray-700 mb-2">Over Organisatie</label>
                <textarea id="prog-org-about" rows="3" class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
              </div>
            </div>
          </div>

          <!-- Terms -->
          <div class="bg-white p-6 rounded-xl shadow-sm">
            <div class="space-y-3">
              <label class="flex items-start space-x-3">
                <input id="prog-notify-email" type="checkbox" checked class="h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500 mt-0.5">
                <span class="text-sm text-gray-700">OK om email notificaties te ontvangen</span>
              </label>
              <label class="flex items-start space-x-3">
                <input id="prog-terms" type="checkbox" required class="h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500 mt-0.5">
                <span class="text-sm text-gray-700">Ik ga akkoord met de <a href="#" class="font-semibold text-indigo-600">Algemene Voorwaarden</a> *</span>
              </label>
            </div>
          </div>

          <button type="submit"
            class="btn-press w-full py-4 px-4 rounded-xl text-base font-semibold text-white bg-gray-900 hover:bg-gray-800 focus:outline-none">
            Start Gratis Proefperiode
          </button>
          <p id="programmer-signup-error" class="text-red-500 text-sm mt-2 text-center"></p>
        </form>
      </div>
    </div>
  `;
}

/**
 * Renders the Messages view
 */
export function renderMessages() {
  const appContent = document.getElementById('app-content');
  appContent.innerHTML = `
    <div id="messages-view">
      <div class="h-screen flex flex-col">
        <div class="px-6 py-4 bg-white border-b border-gray-200">
          <h2 class="text-2xl font-bold text-gray-900">Berichten</h2>
        </div>

        <div class="flex flex-1 min-h-0">
          <!-- Conversation List -->
          <div class="w-full md:w-1/3 border-r border-gray-200 overflow-y-auto bg-white">
            <div id="conversations-loading" class="p-4 text-gray-500 text-center">
              <!-- Loading skeleton inserted by JS -->
            </div>
            <div id="conversations-empty" class="p-8 text-center hidden">
              <div class="flex flex-col items-center justify-center py-12">
                <svg class="h-16 w-16 text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
                </svg>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">Geen berichten</h3>
                <p class="text-sm text-gray-500 max-w-xs">Je hebt nog geen gesprekken. Stuur een bericht naar een artiest om te beginnen!</p>
              </div>
            </div>
            <div id="conversations-list" class="divide-y divide-gray-200 hidden">
              <!-- Conversations will be loaded here -->
            </div>
          </div>

          <!-- Chat Area (hidden on mobile, shown when conversation selected) -->
          <div class="hidden md:flex w-2/3 flex-col min-h-0">
            <div id="chat-placeholder" class="flex-1 flex items-center justify-center text-gray-500 bg-gray-50">
              <p>Selecteer een gesprek</p>
            </div>

            <div id="chat-container" class="hidden flex-1 flex flex-col min-h-0">
              <!-- Chat Header -->
              <div id="chat-header" class="p-4 border-b border-gray-200 bg-white">
                <h3 class="text-lg font-semibold text-gray-900">Gesprek</h3>
              </div>

              <!-- Messages -->
              <div id="messages-container" class="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50">
                <!-- Messages will be inserted here -->
              </div>

              <!-- Message Input -->
              <div class="p-4 border-t border-gray-200 bg-white">
                <form id="message-form" class="flex space-x-2">
                  <input id="message-input" type="text" placeholder="Type je bericht..."
                    class="flex-1 px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                  <button type="submit" class="btn-press bg-indigo-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-indigo-700">
                    Verstuur
                  </button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  `;
}

/**
 * Renders the Account Settings view
 */
export function renderAccountSettings() {
  const appContent = document.getElementById('app-content');
  appContent.innerHTML = `
    <div id="account-settings-view" class="min-h-screen bg-gray-50 py-8 px-6">
      <div class="max-w-3xl mx-auto">
        <!-- Header -->
        <div class="mb-8">
          <h1 class="text-4xl font-bold text-gray-900 tracking-tight mb-2">Account Settings</h1>
          <p class="text-gray-600">Manage your email and password</p>
        </div>

        <!-- Change Email Section -->
        <div class="bg-white p-10 rounded-3xl shadow-sm border border-gray-100 mb-6">
          <div class="mb-6 pb-6 border-b border-gray-100">
            <h2 class="text-2xl font-bold text-gray-900 tracking-tight">Change Email</h2>
            <p class="text-sm text-gray-500 mt-1">Update your account email address</p>
          </div>

          <form id="change-email-form" class="space-y-4">
            <div>
              <label for="new-email" class="block text-sm font-semibold text-gray-700 mb-2">New Email Address</label>
              <input id="new-email" type="email" required
                     class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all"
                     placeholder="your.new.email@example.com">
            </div>
            <div>
              <label for="confirm-email-password" class="block text-sm font-semibold text-gray-700 mb-2">Current Password (for verification)</label>
              <input id="confirm-email-password" type="password" required
                     class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all"
                     placeholder="Enter your current password">
            </div>
            <button type="submit"
                    class="w-full bg-indigo-600 text-white px-6 py-4 rounded-2xl font-bold hover:bg-indigo-700 transition-all shadow-sm hover:shadow">
              Update Email
            </button>
            <p id="email-success" class="text-green-600 text-sm text-center"></p>
            <p id="email-error" class="text-red-600 text-sm text-center"></p>
          </form>
        </div>

        <!-- Change Password Section -->
        <div class="bg-white p-10 rounded-3xl shadow-sm border border-gray-100 mb-6">
          <div class="mb-6 pb-6 border-b border-gray-100">
            <h2 class="text-2xl font-bold text-gray-900 tracking-tight">Change Password</h2>
            <p class="text-sm text-gray-500 mt-1">Update your account password</p>
          </div>

          <form id="change-password-form" class="space-y-4">
            <div>
              <label for="current-password" class="block text-sm font-semibold text-gray-700 mb-2">Current Password</label>
              <input id="current-password" type="password" required
                     class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all"
                     placeholder="Enter your current password">
            </div>
            <div>
              <label for="new-password" class="block text-sm font-semibold text-gray-700 mb-2">New Password</label>
              <input id="new-password" type="password" required minlength="6"
                     class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all"
                     placeholder="Enter new password (min. 6 characters)">
            </div>
            <div>
              <label for="confirm-password" class="block text-sm font-semibold text-gray-700 mb-2">Confirm New Password</label>
              <input id="confirm-password" type="password" required minlength="6"
                     class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all"
                     placeholder="Confirm new password">
            </div>
            <button type="submit"
                    class="w-full bg-indigo-600 text-white px-6 py-4 rounded-2xl font-bold hover:bg-indigo-700 transition-all shadow-sm hover:shadow">
              Update Password
            </button>
            <p id="password-success" class="text-green-600 text-sm text-center"></p>
            <p id="password-error" class="text-red-600 text-sm text-center"></p>
          </form>
        </div>
      </div>
    </div>
  `;
}

/**
 * Renders the Dashboard view (wrapper for artist/programmer dashboards)
 */
export function renderDashboard() {
  const appContent = document.getElementById('app-content');
  appContent.innerHTML = `
    <div id="dashboard-view">
      <!-- Artist Dashboard -->
      <div id="artist-dashboard" class="hidden">
        <!-- Content rendered by renderArtistDashboard() in artist-dashboard.js -->
      </div>

      <!-- Programmer Dashboard -->
      <div id="programmer-dashboard">
        <!-- Content rendered by renderProgrammerDashboard() in programmer-dashboard.js -->
      </div>

      <!-- Artist Detail View -->
      <div id="artist-detail-view" class="hidden">
        <!-- ‚úÖ FIX: Complete Artist Detail View HTML Structure -->
        <div class="bg-white min-h-screen">
          <!-- Back Button -->
          <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 z-10">
            <button id="back-to-search-btn" class="flex items-center text-indigo-600 hover:text-indigo-800 font-medium">
              <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
              </svg>
              Back to Search
            </button>
          </div>

          <!-- Artist Profile Content -->
          <div class="px-6 py-8 max-w-4xl mx-auto">
            <!-- Profile Header -->
            <div class="bg-white rounded-xl shadow-lg p-8 mb-6">
              <div class="flex flex-col md:flex-row items-start md:items-center gap-6 mb-6">
                <img id="detail-profile-pic" src="" alt="Artist" class="h-32 w-32 md:h-48 md:w-48 rounded-full object-cover border-4 border-indigo-100">
                <div class="flex-1">
                  <h1 id="detail-artist-name" class="text-3xl md:text-4xl font-bold text-gray-900 mb-2">Artist Name</h1>
                  <h2 id="detail-stage-name" class="text-xl md:text-2xl text-indigo-600 font-semibold mb-4">Stage Name</h2>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-gray-700">
                    <div class="flex items-center">
                      <i data-lucide="map-pin" class="h-5 w-5 mr-2 text-indigo-600"></i>
                      <span id="detail-location">Location</span>
                    </div>
                    <div class="flex items-center">
                      <i data-lucide="calendar" class="h-5 w-5 mr-2 text-indigo-600"></i>
                      <span id="detail-age">Age</span>
                    </div>
                    <div class="flex items-center">
                      <i data-lucide="user" class="h-5 w-5 mr-2 text-indigo-600"></i>
                      <span id="detail-gender">Gender</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Genres & Languages -->
              <div class="space-y-4">
                <div>
                  <h3 class="text-sm font-semibold text-gray-700 mb-2">Genres</h3>
                  <div id="detail-genres" class="flex flex-wrap gap-2"></div>
                </div>
                <div>
                  <h3 class="text-sm font-semibold text-gray-700 mb-2">Languages</h3>
                  <div id="detail-languages" class="flex flex-wrap gap-2"></div>
                </div>
              </div>
            </div>

            <!-- Bio & Pitch -->
            <div class="bg-white rounded-xl shadow-lg p-8 mb-6">
              <h3 class="text-xl font-bold text-gray-900 mb-4">Biography</h3>
              <p id="detail-bio" class="text-gray-700 whitespace-pre-wrap mb-6">Bio content</p>

              <h3 class="text-xl font-bold text-gray-900 mb-4">Pitch</h3>
              <p id="detail-pitch" class="text-gray-700 whitespace-pre-wrap">Pitch content</p>
            </div>

            <!-- Media Section -->
            <!-- Video -->
            <div id="detail-video-section" class="bg-white rounded-xl shadow-lg p-8 mb-6" style="display: none;">
              <h3 class="text-xl font-bold text-gray-900 mb-4">Video</h3>
              <div id="detail-video-container" class="aspect-video bg-gray-100 rounded-lg overflow-hidden"></div>
            </div>

            <!-- Audio -->
            <div id="detail-audio-section" class="bg-white rounded-xl shadow-lg p-8 mb-6" style="display: none;">
              <h3 class="text-xl font-bold text-gray-900 mb-4">Audio</h3>
              <div id="detail-audio-container" class="bg-gray-100 rounded-lg p-4"></div>
            </div>

            <!-- Text Material -->
            <div id="detail-text-section" class="bg-white rounded-xl shadow-lg p-8 mb-6" style="display: none;">
              <h3 class="text-xl font-bold text-gray-900 mb-4">Text Material</h3>
              <div id="detail-text-content" class="prose max-w-none text-gray-700 whitespace-pre-wrap"></div>
            </div>

            <!-- Document -->
            <div id="detail-document-section" class="bg-white rounded-xl shadow-lg p-8 mb-6" style="display: none;">
              <h3 class="text-xl font-bold text-gray-900 mb-4">Document</h3>
              <a id="detail-document-link" href="#" target="_blank" class="inline-flex items-center text-indigo-600 hover:text-indigo-800 font-medium">
                <i data-lucide="file-text" class="h-5 w-5 mr-2"></i>
                <span>View Document</span>
              </a>
            </div>

            <!-- Contact Section (Pro Only) -->
            <div id="detail-trial-message" class="bg-yellow-50 border border-yellow-200 rounded-xl p-6 mb-6" style="display: none;">
              <div class="flex items-start">
                <i data-lucide="lock" class="h-6 w-6 text-yellow-600 mr-3 flex-shrink-0 mt-1"></i>
                <div>
                  <h3 class="text-lg font-bold text-yellow-900 mb-2">Upgrade to Pro to Contact Artists</h3>
                  <p class="text-yellow-800">Contact information and messaging are available for Pro members only. Upgrade your account to unlock direct contact with artists.</p>
                </div>
              </div>
            </div>

            <div id="detail-contact-info" class="bg-white rounded-xl shadow-lg p-8 mb-6" style="display: none;">
              <h3 class="text-xl font-bold text-gray-900 mb-4">Contact Information</h3>
              <div class="space-y-3">
                <div class="flex items-center">
                  <i data-lucide="mail" class="h-5 w-5 mr-3 text-indigo-600"></i>
                  <a id="detail-email" href="mailto:" class="text-indigo-600 hover:text-indigo-800">Email</a>
                </div>
                <div class="flex items-center">
                  <i data-lucide="phone" class="h-5 w-5 mr-3 text-indigo-600"></i>
                  <a id="detail-phone" href="tel:" class="text-indigo-600 hover:text-indigo-800">Phone</a>
                </div>
              </div>
              <button id="send-message-btn" class="mt-6 w-full bg-indigo-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-indigo-700 transition-colors">
                <i data-lucide="send" class="h-5 w-5 inline mr-2"></i>
                Send Message
              </button>
            </div>

            <!-- Recommendations Section -->
            <div class="bg-white rounded-xl shadow-lg p-8 mb-6">
              <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-900">Recommendations</h3>
                <button id="write-recommendation-btn" class="hidden bg-indigo-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-indigo-700">
                  <i data-lucide="star" class="h-4 w-4 inline mr-2"></i>
                  Write Recommendation
                </button>
              </div>

              <!-- Loading State -->
              <div id="recommendations-loading" class="text-center py-8" style="display: none;">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div>
                <p class="text-gray-600 mt-4">Loading recommendations...</p>
              </div>

              <!-- Error State -->
              <div id="recommendations-error" class="text-center py-8 text-red-600" style="display: none;">
                Error loading recommendations
              </div>

              <!-- Empty State -->
              <div id="recommendations-empty" class="text-center py-8 bg-gray-50 rounded-lg" style="display: none;">
                <p class="text-gray-600">No recommendations yet.</p>
              </div>

              <!-- Recommendations List -->
              <div id="recommendations-list" class="space-y-4" style="display: none;"></div>
            </div>

          </div>
        </div>
      </div>
    </div>
  `;
}
</file>

<file path="src/utils/checkbox-helpers.js">
/**
 * checkbox-helpers.js
 * Helper functies voor het werken met checkbox groepen in plaats van multi-select
 */

/**
 * Haalt geselecteerde waarden op uit een checkbox groep
 * @param {string} name - De name attribute van de checkboxes
 * @returns {Array<string>} Array met geselecteerde waarden
 */
export function getCheckboxValues(name) {
  const checkboxes = document.querySelectorAll(`input[name="${name}"]:checked`);
  return Array.from(checkboxes).map(cb => cb.value);
}

/**
 * Zet checkboxes op basis van een array van waarden
 * @param {string} name - De name attribute van de checkboxes
 * @param {Array<string>} values - Array met te selecteren waarden
 */
export function setCheckboxValues(name, values = []) {
  const checkboxes = document.querySelectorAll(`input[name="${name}"]`);
  checkboxes.forEach(checkbox => {
    checkbox.checked = values.includes(checkbox.value);
  });
}

/**
 * Valideert of er minimaal √©√©n checkbox geselecteerd is
 * @param {string} name - De name attribute van de checkboxes
 * @returns {boolean} True als er minimaal √©√©n checkbox geselecteerd is
 */
export function validateCheckboxGroup(name) {
  const checked = document.querySelectorAll(`input[name="${name}"]:checked`);
  return checked.length > 0;
}

/**
 * Voegt validatie toe aan een checkbox groep
 * @param {string} name - De name attribute van de checkboxes
 * @param {string} errorMessage - Foutmelding die getoond moet worden
 */
export function addCheckboxValidation(name, errorMessage = "Please select at least one option") {
  const checkboxes = document.querySelectorAll(`input[name="${name}"]`);
  
  checkboxes.forEach(checkbox => {
    checkbox.addEventListener('change', () => {
      const isValid = validateCheckboxGroup(name);
      
      // Vind of maak error message element
      const container = checkbox.closest('.mb-4') || checkbox.closest('div');
      let errorElement = container.querySelector('.checkbox-error');
      
      if (!isValid && !errorElement) {
        errorElement = document.createElement('p');
        errorElement.className = 'checkbox-error text-red-500 text-sm mt-1';
        errorElement.textContent = errorMessage;
        container.appendChild(errorElement);
      } else if (isValid && errorElement) {
        errorElement.remove();
      }
    });
  });
}
</file>

<file path="src/utils/store.js">
// Dit is een simpele "global store" om data tussen modules te delen
// (bijv. de ingelogde gebruiker, hun rol, en hun profiel)

// Sla de data op in een privaat object
const state = {
  currentUser: null,     // Het 'auth' object van Firebase
  userRole: null,        // 'artist' of 'programmer'
  currentUserData: null, // Het volledige profiel-object uit Firestore
};

/**
 * Haalt een waarde op uit de global state.
 * @param {string} key - De sleutel (currentUser, userRole, currentUserData)
 * @returns {*} De opgeslagen waarde
 */
export function getStore(key) {
  return state[key];
}

/**
 * Slaat een waarde op in de global state.
 * @param {string} key - De sleutel (currentUser, userRole, currentUserData)
 * @param {*} value - De waarde om op te slaan
 */
export function setStore(key, value) {
  state[key] = value;
}
</file>

<file path="src/utils/translations.js">
/**
 * translations.js
 * Multi-language support for the SpokenWord platform
 */

import { getStore, setStore } from './store.js';

export const translations = {
  nl: {
    // Navigation
    nav_home: 'Home',
    nav_search: 'Zoeken',
    nav_messages: 'Berichten',
    nav_profile: 'Profiel',
    nav_logout: 'Uitloggen',
    nav_login: 'Inloggen',
    nav_signup: 'Aanmelden',
    nav_dashboard: 'Dashboard',

    // Dashboard
    dashboard_welcome: 'Welkom op je Dashboard',
    programmer_dashboard: 'Programmeur Dashboard',
    search_for_artists: 'Zoek naar Artiesten',
    loading_artists: 'Artiesten laden...',
    no_artists_found: 'Geen artiesten gevonden. Klik op \'Zoeken\' om alle artiesten te laden of verfijn je filters.',

    // Filters
    filter_name: 'Naam...',
    filter_location: 'Locatie...',
    filter_all_genders: 'Alle Geslachten',
    filter_female: 'Vrouw',
    filter_male: 'Man',
    filter_other: 'Anders',
    filter_age_range: 'Leeftijdsbereik:',
    filter_age_min: 'Min',
    filter_age_max: 'Max',
    filter_genres: 'Genres:',
    filter_languages: 'Talen:',
    filter_payment_methods: 'Betaalmethoden:',
    search_artists_btn: 'Zoek Artiesten',

    // Genres
    genre_performance_poetry: 'Performance Poetry',
    genre_poetry_slam: 'Poetry Slam',
    genre_jazz_poetry: 'Jazz Poetry',
    genre_rap: 'Rap',
    genre_storytelling: 'Storytelling',
    genre_comedy: 'Comedy',
    genre_one_on_one: '1-op-1 Sessies',

    // Languages
    lang_dutch: 'Nederlands (NL)',
    lang_english: 'Engels (EN)',
    lang_french: 'Frans (FR)',

    // Payment Methods
    payment_invoice: 'Factuur',
    payment_payrolling: 'Payrolling',
    payment_sbk: 'Anders (SBK)',
    payment_volunteer_fee: 'Vrijwilligersvergoeding',
    payment_other: 'Anders',

    // Profile/Settings
    settings_title: 'Bewerk je Profiel',
    settings_subtitle: 'Update je profielinformatie en profielfoto hieronder. Vergeet niet je wijzigingen op te slaan.',
    profile_picture: 'Profielfoto',
    upload_new_photo: 'Upload Nieuwe Foto',
    photo_requirements: 'JPG, PNG of GIF. Max 5MB.',
    first_name: 'Voornaam',
    last_name: 'Achternaam',
    phone: 'Telefoon',
    organization_name: 'Organisatienaam',
    about_organization: 'Over je Organisatie',
    about_organization_placeholder: 'Vertel artiesten over je organisatie en welke evenementen je organiseert...',
    website: 'Website',
    language_preference: 'Taalvoorkeur',
    language_preference_help: 'Kies je voorkeurstaal voor de website-interface',
    save_profile_changes: 'Profiel Wijzigingen Opslaan',

    // Messages
    messages_title: 'Berichten',
    loading_conversations: 'Gesprekken laden...',
    no_conversations: 'Nog geen gesprekken. Stuur een bericht naar een artiest om een gesprek te starten!',
    select_conversation: 'Selecteer een gesprek om te beginnen met berichten',
    send: 'Verzenden',
    send_message: 'Verstuur Bericht',
    type_message: 'Typ je bericht...',
    no_messages_yet: 'Nog geen berichten.',
    message_subject: 'Onderwerp',
    message_text: 'Bericht',

    // Artist Cards
    view_profile: 'Bekijk Profiel',
    location_not_specified: 'Locatie niet opgegeven',
    age_not_specified: 'Leeftijd niet opgegeven',
    years_old: 'jaar oud',
    no_genres: 'Geen genres',

    // Status Messages
    pending_approval: 'Je account wacht op goedkeuring van de beheerder. Je ontvangt een e-mail zodra het is gepubliceerd.',
    trial_account: 'Je hebt momenteel een <strong>7-daagse Gratis Proefperiode</strong>.',
    pro_account: 'Je hebt een <strong>PRO Account</strong>. Geniet van volledige toegang tot de database.',
    upgrade_to_pro: 'Upgrade naar PRO (Binnenkort beschikbaar)',

    // Errors
    error_loading: 'Fout bij laden. Probeer het later opnieuw.',
    auth_required: 'Je moet ingelogd zijn als een programmeur om deze pagina te bekijken.',

    // Recommendations
    recommendations: 'Aanbevelingen',
    write_recommendation: 'Schrijf Aanbeveling',
    write_recommendation_for: 'Schrijf Aanbeveling voor',
    your_recommendation: 'Jouw Aanbeveling',
    recommendation_placeholder: 'Deel je positieve ervaring met deze artiest...',
    recommendation_help: 'Minimaal 10 karakters. Wees specifiek en positief!',
    submit_recommendation: 'Verstuur Aanbeveling',
    submitting: 'Versturen...',
    recommendation_success: '‚úì Aanbeveling succesvol verstuurd!',
    no_recommendations_yet: 'Nog geen aanbevelingen. Wees de eerste om deze artiest aan te bevelen!',
    confirm_delete_recommendation: 'Weet je zeker dat je deze aanbeveling wilt verwijderen?',
    error_only_programmers_recommend: 'Alleen programmeurs kunnen aanbevelingen schrijven.',
    error_recommendation_required: 'Vul alsjeblieft een aanbeveling in.',
    error_recommendation_too_short: 'Aanbeveling moet minimaal 10 karakters bevatten.',
    error_must_be_logged_in: 'Je moet ingelogd zijn om deze actie uit te voeren.',
    cancel: 'Annuleren',

    // User Settings
    user_settings_title: 'Account Instellingen',
    settings_language: 'Taal',
    settings_language_help: 'Kies je voorkeurstaal voor de interface',
    settings_change_email: 'Email Adres Wijzigen',
    settings_change_password: 'Wachtwoord Wijzigen',
    settings_current_password: 'Huidig Wachtwoord',
    settings_new_email: 'Nieuw Email Adres',
    settings_new_password: 'Nieuw Wachtwoord',
    settings_confirm_password: 'Bevestig Nieuw Wachtwoord',
    settings_update_email: 'Email Bijwerken',
    settings_update_password: 'Wachtwoord Bijwerken',
    settings_email_updated: 'Email adres succesvol bijgewerkt! Check je nieuwe inbox voor een verificatie email.',
    settings_password_updated: 'Wachtwoord succesvol bijgewerkt!',
    settings_password_mismatch: 'Wachtwoorden komen niet overeen',
    settings_password_too_short: 'Nieuw wachtwoord moet minimaal 6 karakters bevatten',
    settings_invalid_email: 'Voer een geldig email adres in',
    settings_reauth_required: 'Voor deze wijziging moet je je huidige wachtwoord invoeren',

    // Common
    required: '*',
    loading: 'Laden...',
    error: 'Fout',
    success: 'Succes',
    login_title: 'Inloggen',
    profile: 'Profiel',
    edit_profile: 'Bewerk Profiel',
    upload_document: 'Upload Document (PDF, DOC, DOCX)',
    current_document: 'Huidig document:',
    view: 'Bekijken',
    welcome_dashboard: 'Welkom op je Dashboard',
    edit_your_profile: 'Bewerk je Profiel',
    update_info_below: 'Update je informatie hieronder. Velden gemarkeerd met * zijn verplicht.'
  },
  en: {
    // Navigation
    nav_home: 'Home',
    nav_search: 'Search',
    nav_messages: 'Messages',
    nav_profile: 'Profile',
    nav_logout: 'Logout',
    nav_login: 'Login',
    nav_signup: 'Sign Up',
    nav_dashboard: 'Dashboard',

    // Dashboard
    dashboard_welcome: 'Welcome to your Dashboard',
    programmer_dashboard: 'Programmer Dashboard',
    search_for_artists: 'Search for Artists',
    loading_artists: 'Loading artists...',
    no_artists_found: 'No artists found. Click \'Search\' to load all artists or refine your filters.',

    // Filters
    filter_name: 'Name...',
    filter_location: 'Location...',
    filter_all_genders: 'All Genders',
    filter_female: 'Female',
    filter_male: 'Male',
    filter_other: 'Other',
    filter_age_range: 'Age Range:',
    filter_age_min: 'Min',
    filter_age_max: 'Max',
    filter_genres: 'Genres:',
    filter_languages: 'Languages:',
    filter_payment_methods: 'Payment Methods:',
    search_artists_btn: 'Search Artists',

    // Genres
    genre_performance_poetry: 'Performance Poetry',
    genre_poetry_slam: 'Poetry Slam',
    genre_jazz_poetry: 'Jazz Poetry',
    genre_rap: 'Rap',
    genre_storytelling: 'Storytelling',
    genre_comedy: 'Comedy',
    genre_one_on_one: '1-on-1 Sessions',

    // Languages
    lang_dutch: 'Dutch (NL)',
    lang_english: 'English (EN)',
    lang_french: 'French (FR)',

    // Payment Methods
    payment_invoice: 'Invoice',
    payment_payrolling: 'Payrolling',
    payment_sbk: 'Other (SBK)',
    payment_volunteer_fee: 'Volunteer Fee',
    payment_other: 'Other',

    // Profile/Settings
    settings_title: 'Edit Your Profile',
    settings_subtitle: 'Update your profile information and profile picture below. Remember to save your changes.',
    profile_picture: 'Profile Picture',
    upload_new_photo: 'Upload New Photo',
    photo_requirements: 'JPG, PNG or GIF. Max 5MB.',
    first_name: 'First Name',
    last_name: 'Last Name',
    phone: 'Phone',
    organization_name: 'Organization Name',
    about_organization: 'About Your Organization',
    about_organization_placeholder: 'Tell artists about your organization and what events you organize...',
    website: 'Website',
    language_preference: 'Language Preference',
    language_preference_help: 'Choose your preferred language for the website interface',
    save_profile_changes: 'Save Profile Changes',

    // Messages
    messages_title: 'Messages',
    loading_conversations: 'Loading conversations...',
    no_conversations: 'No conversations yet. Send a message to an artist to start a conversation!',
    select_conversation: 'Select a conversation to start messaging',
    send: 'Send',
    send_message: 'Send Message',
    type_message: 'Type your message...',
    no_messages_yet: 'No messages yet.',
    message_subject: 'Subject',
    message_text: 'Message',

    // Artist Cards
    view_profile: 'View Profile',
    location_not_specified: 'Location not specified',
    age_not_specified: 'Age not specified',
    years_old: 'years old',
    no_genres: 'No genres',

    // Status Messages
    pending_approval: 'Your account is <strong>pending admin approval</strong>. You will be notified by email once it\'s published.',
    trial_account: 'You are currently on your <strong>7-Day Free Trial</strong>.',
    pro_account: 'You have a <strong>PRO Account</strong>. Enjoy full access to the database.',
    upgrade_to_pro: 'Upgrade to PRO (Coming Soon)',

    // Errors
    error_loading: 'Error loading. Please try again later.',
    auth_required: 'You must be logged in as a programmer to access this page.',

    // Recommendations
    recommendations: 'Recommendations',
    write_recommendation: 'Write Recommendation',
    write_recommendation_for: 'Write Recommendation for',
    your_recommendation: 'Your Recommendation',
    recommendation_placeholder: 'Share your positive experience working with this artist...',
    recommendation_help: 'Minimum 10 characters. Be specific and positive!',
    submit_recommendation: 'Submit Recommendation',
    submitting: 'Submitting...',
    recommendation_success: '‚úì Recommendation submitted successfully!',
    no_recommendations_yet: 'No recommendations yet. Be the first to recommend this artist!',
    confirm_delete_recommendation: 'Are you sure you want to delete this recommendation?',
    error_only_programmers_recommend: 'Only programmers can write recommendations.',
    error_recommendation_required: 'Please provide a recommendation.',
    error_recommendation_too_short: 'Recommendation must be at least 10 characters long.',
    error_must_be_logged_in: 'You must be logged in to perform this action.',
    cancel: 'Cancel',

    // User Settings
    user_settings_title: 'Account Settings',
    settings_language: 'Language',
    settings_language_help: 'Choose your preferred language for the interface',
    settings_change_email: 'Change Email Address',
    settings_change_password: 'Change Password',
    settings_current_password: 'Current Password',
    settings_new_email: 'New Email Address',
    settings_new_password: 'New Password',
    settings_confirm_password: 'Confirm New Password',
    settings_update_email: 'Update Email',
    settings_update_password: 'Update Password',
    settings_email_updated: 'Email address successfully updated! Check your new inbox for a verification email.',
    settings_password_updated: 'Password successfully updated!',
    settings_password_mismatch: 'Passwords do not match',
    settings_password_too_short: 'New password must be at least 6 characters',
    settings_invalid_email: 'Please enter a valid email address',
    settings_reauth_required: 'You must enter your current password to make this change',

    // Common
    required: '*',
    loading: 'Loading...',
    error: 'Error',
    success: 'Success',
    login_title: 'Login',
    profile: 'Profile',
    edit_profile: 'Edit Profile',
    upload_document: 'Upload Document (PDF, DOC, DOCX)',
    current_document: 'Current document:',
    view: 'View',
    welcome_dashboard: 'Welcome to your Dashboard',
    edit_your_profile: 'Edit Your Profile',
    update_info_below: 'Update your information below. Fields marked with * are required.'
  }
};

/**
 * Get current language preference
 */
export function getCurrentLanguage() {
  return getStore('language') || 'nl'; // Default to Dutch
}

/**
 * Set language preference
 */
export function setLanguage(lang) {
  if (!translations[lang]) {
    console.warn(`Language '${lang}' not supported, falling back to 'nl'`);
    lang = 'nl';
  }
  setStore('language', lang);
  applyTranslations();
}

/**
 * Get translated string
 */
export function t(key) {
  const lang = getCurrentLanguage();
  return translations[lang][key] || translations['nl'][key] || key;
}

/**
 * Apply translations to all elements with data-i18n attribute
 */
export function applyTranslations() {
  const lang = getCurrentLanguage();
  const elements = document.querySelectorAll('[data-i18n]');

  elements.forEach(element => {
    const key = element.getAttribute('data-i18n');
    const translation = t(key);

    if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
      if (element.hasAttribute('placeholder')) {
        element.setAttribute('placeholder', translation);
      } else {
        element.value = translation;
      }
    } else {
      element.innerHTML = translation;
    }
  });

  console.log(`Translations applied for language: ${lang}`);
}

/**
 * Initialize translations on page load
 */
export function initTranslations() {
  // Set default language if not set
  if (!getStore('language')) {
    setStore('language', 'nl'); // Default to Dutch
  }

  // Apply translations
  applyTranslations();
}
</file>

<file path="firestore.rules">
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // 1. Gebruikersprofielen (basisbeveiliging)
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // 2. Programmeurs (Data voor dashboards)
    match /programmers/{userId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // 3. Artiesten (Profielen voor de zoekfunctie)
    match /artists/{userId} {
      // FIXED: Alleen ingelogde users kunnen artists zien
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // 4. Conversations (Chat-functionaliteit)
    match /conversations/{conversationId} {
      // Lezen: alleen als je een participant bent
      allow read: if request.auth != null && 
                     request.auth.uid in resource.data.participants;
      
      // Aanmaken: alleen als je jezelf toevoegt als participant
      allow create: if request.auth != null && 
                       request.auth.uid in request.resource.data.participants;
      
      // Bijwerken: alleen participants (voor lastMessage updates)
      allow update: if request.auth != null && 
                       request.auth.uid in resource.data.participants;
      
      // Messages subcollectie
      match /messages/{messageId} {
        // Lezen: alleen als je participant bent van de parent conversation
        allow read: if request.auth != null && 
                       request.auth.uid in get(/databases/$(database)/documents/conversations/$(conversationId)).data.participants;
        
        // Aanmaken: alleen als je participant bent EN de sender
        allow create: if request.auth != null && 
                         request.auth.uid in get(/databases/$(database)/documents/conversations/$(conversationId)).data.participants &&
                         request.auth.uid == request.resource.data.senderId;
      }
    }

    // 5. Aanbevelingen (Recommendations)
    match /recommendations/{recommendationId} {
      // Iedereen die ingelogd is mag aanbevelingen lezen
      allow read: if request.auth != null;

      // Alleen programmers mogen aanbevelingen aanmaken
      allow create: if request.auth != null
                    && get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'programmer'
                    && request.resource.data.programmerId == request.auth.uid
                    && request.resource.data.isApproved == true;

      // Alleen de auteur mag zijn aanbeveling verwijderen
      allow delete: if request.auth != null
                    && resource.data.programmerId == request.auth.uid;

      // Bewerken is niet toegestaan
      allow update: if false;
    }

    // 6. Mail collectie (voor email triggers) - blokkeren
    match /mail/{docId} {
      allow read, write: if false;
    }
    
    // 7. Templates collectie - blokkeren
    match /templates/{docId} {
      allow read, write: if false;
    }

    // Blokkeer alle andere toegang
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}
</file>

<file path="postcss.config.js">
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
</file>

<file path="REFACTOR_SUMMARY.md">
# Dashboard Modularization & Apple Styling - Refactor Summary

## üìÖ Date: 2025-12-23
## üéØ Objective: Dashboard Modularisatie & Apple Styling

---

## ‚úÖ COMPLETED TASKS

### 1. **Dashboard Refactor (src/modules/dashboard/)**
The Artist Dashboard has been successfully refactored into a clean, modular architecture:

#### **New Modular Structure:**
```
src/modules/dashboard/
‚îú‚îÄ‚îÄ dashboard-service.js   - Data operations (Firestore queries, profile updates)
‚îú‚îÄ‚îÄ dashboard-ui.js        - Apple-style UI rendering (clean, minimal widgets)
‚îî‚îÄ‚îÄ dashboard-controller.js - Event handling & initialization
```

#### **Key Features:**
- ‚úÖ **Apple-esque Design**: White cards, rounded-2xl corners, subtle shadows
- ‚úÖ **Clean Separation**: Service layer, UI layer, Controller layer
- ‚úÖ **Event Delegation**: Robust event handling that works with dynamic content
- ‚úÖ **Premium Styling**: `bg-white`, `p-6`, `rounded-2xl`, `border border-gray-100`

#### **Old Files Removed:**
- ‚ùå `artist-dashboard.js` (deleted - refactored into modular structure)

---

### 2. **Programmer Dashboard - Apple Styling Update**
The Programmer Dashboard received a complete visual overhaul:

#### **Before ‚Üí After:**
- ‚ùå `rounded-lg shadow-xl` ‚Üí ‚úÖ `rounded-2xl shadow-sm border border-gray-100`
- ‚ùå Standard borders ‚Üí ‚úÖ Subtle `border-gray-100` accents
- ‚ùå Heavy shadows ‚Üí ‚úÖ Light `shadow-sm` for depth
- ‚ùå Sharp corners ‚Üí ‚úÖ `rounded-2xl` for premium feel

#### **Updated Components:**
- ‚úÖ Profile Overview Card - Apple styling
- ‚úÖ Public Profile Preview - Refined borders & rounded corners
- ‚úÖ Pending Account View - Yellow accent card with icon
- ‚úÖ Version badge updated to "v2.1 (Modular Dashboard)"

---

### 3. **Programmer Profile Editor - Apple Styling**
Complete redesign of the profile editing form:

#### **Visual Improvements:**
- ‚úÖ **Form Inputs**: `bg-gray-50`, `border-0`, `rounded-xl`, `focus:ring-2`
- ‚úÖ **Section Headers**: Bold, tracking-tight typography
- ‚úÖ **Upload Buttons**: Premium `bg-gray-900` with `rounded-xl`
- ‚úÖ **Submit Button**: Full-width, bold, `rounded-xl` with shadow
- ‚úÖ **Cancel Button**: Subtle gray with hover effect

#### **UX Enhancements:**
- ‚úÖ Cancel button functionality added
- ‚úÖ Better spacing with `space-y-8`
- ‚úÖ Subtle borders with `border-gray-100`
- ‚úÖ Consistent with Artist Dashboard styling

---

### 4. **Trial/Proefperiode Messages - Cleanup**
All "Trial" and "Proefperiode" messages have been removed from dashboard code:

#### **Scanned Files:**
- ‚úÖ `src/modules/dashboard/*` - No trial messages found
- ‚úÖ `programmer-dashboard.js` - No trial messages found
- ‚úÖ `ui.js` - No trial messages found

#### **Preserved (Intentional):**
- ‚ö†Ô∏è Search UI trial message (for access control - user wants to keep)
- ‚ö†Ô∏è Messaging badges (status indicators - functional requirement)
- ‚ö†Ô∏è Backend trial logic (Firebase functions - not dashboard code)

---

## üìÅ MODULAR ARCHITECTURE

### **Complete Module Structure:**
```
src/modules/
‚îú‚îÄ‚îÄ dashboard/
‚îÇ   ‚îú‚îÄ‚îÄ dashboard-controller.js  - Event handling
‚îÇ   ‚îú‚îÄ‚îÄ dashboard-service.js     - Data operations
‚îÇ   ‚îî‚îÄ‚îÄ dashboard-ui.js          - Apple-style rendering
‚îú‚îÄ‚îÄ messaging/
‚îÇ   ‚îú‚îÄ‚îÄ messaging-controller.js  - Event handling
‚îÇ   ‚îú‚îÄ‚îÄ messaging-service.js     - Data operations
‚îÇ   ‚îî‚îÄ‚îÄ messaging-ui.js          - UI rendering
‚îî‚îÄ‚îÄ search/
    ‚îú‚îÄ‚îÄ search-controller.js     - Event handling
    ‚îú‚îÄ‚îÄ search-data.js           - Data operations
    ‚îî‚îÄ‚îÄ search-ui.js             - Apple-style rendering
```

---

## üé® VISUAL CONSISTENCY

### **Apple Design Language Applied:**
1. **Cards**: `bg-white p-8 rounded-2xl shadow-sm border border-gray-100`
2. **Inputs**: `bg-gray-50 border-0 rounded-xl focus:ring-2 focus:ring-indigo-500`
3. **Buttons**: `rounded-xl font-semibold hover:bg-indigo-700 transition-colors shadow-sm`
4. **Typography**: Bold headings with `tracking-tight`, subtle labels with `text-xs font-semibold text-gray-500`
5. **Spacing**: Generous whitespace with `space-y-8`, `gap-6`, `p-8`

---

## üîß TECHNICAL IMPROVEMENTS

### **Event Delegation:**
- ‚úÖ Global event delegation on `document.body` for dynamically rendered elements
- ‚úÖ Robust click handlers that work across view changes
- ‚úÖ No more "broken" buttons after re-renders

### **Code Organization:**
- ‚úÖ Separation of concerns (Service, UI, Controller)
- ‚úÖ Reusable helper functions
- ‚úÖ Clean imports and exports
- ‚úÖ Consistent naming conventions

### **Performance:**
- ‚úÖ Dynamic imports where appropriate
- ‚úÖ Efficient event delegation (fewer listeners)
- ‚úÖ Optimized re-renders

---

## üöÄ BUILD VERIFICATION

### **Build Status:**
```bash
‚úì Built successfully in 3.86s
‚úì No critical errors
‚úì All modules loaded correctly
‚ö†Ô∏è Minor warnings about dynamic imports (expected behavior)
```

---

## üì¶ FILES MODIFIED

### **Modified:**
- `ui.js` - Updated dashboard integration
- `main.js` - Updated imports for modular dashboard
- `programmer-dashboard.js` - Apple styling update
- `programmer-profile.js` - Apple styling & cancel button

### **Created:**
- `src/modules/dashboard/dashboard-service.js`
- `src/modules/dashboard/dashboard-ui.js`
- `src/modules/dashboard/dashboard-controller.js`

### **Deleted:**
- `artist-dashboard.js` (refactored into modules)
- `artist-search.js` (refactored into modules)
- `artist-dashboard.js.backup` (cleanup)

---

## üéØ NEXT STEPS (Future Considerations)

### **Potential Enhancements:**
1. **Programmer Dashboard Modularization**: Consider moving `programmer-dashboard.js` into `src/modules/dashboard/programmer/`
2. **Profile Module**: Extract profile editing into `src/modules/profile/`
3. **Shared UI Components**: Create `src/components/` for reusable UI elements
4. **TypeScript Migration**: Add type safety for better developer experience

---

## üìù NOTES

- All dashboard code now follows the Apple design language
- No "Trial" or "Proefperiode" messages in dashboard code
- Event delegation ensures robust UI interactions
- Modular architecture makes future maintenance easier
- Build passes with no critical errors

---

## ‚ú® SUMMARY

**The dashboard refactor is complete!** We've achieved:
1. ‚úÖ Clean modular architecture for Artist Dashboard
2. ‚úÖ Premium Apple-style UI across all dashboards
3. ‚úÖ Robust event handling with delegation
4. ‚úÖ Removed trial messages from dashboard code
5. ‚úÖ Consistent visual language across the app

**The codebase is now more maintainable, scalable, and visually cohesive.**

---

**Refactor completed by:** Claude Sonnet 4.5
**Date:** 2025-12-23
**Version:** Staging v2.1 (Modular Dashboard)
</file>

<file path="seed-test-data-local.js">
/**
 * seed-test-data-local.js
 * 
 * Script om test users en conversations aan te maken voor platform testing
 * 
 * GEBRUIK:
 * 1. Plaats dit bestand in je project root
 * 2. Run: node seed-test-data-local.js
 * 
 * BELANGRIJK: Dit script gebruikt Firebase Admin SDK
 * Je hebt je service account key nodig!
 */

import admin from 'firebase-admin';
import { readFileSync } from 'fs';

// Read service account key
const serviceAccount = JSON.parse(
  readFileSync('./serviceAccountKey-ddd-spark.json', 'utf8')
);

// Initialize Firebase Admin
admin.initializeApp({
  credential: admin.credential.cert(serviceAccount)
});

const db = admin.firestore();
const auth = admin.auth();

// Test data configuratie
const TEST_PASSWORD = 'TestPassword123!'; // Alle test users krijgen dit password

const TEST_PROGRAMMERS = [
  {
    email: 'programmer1@test.com',
    firstName: 'Jan',
    lastName: 'Janssen',
    organizationName: 'EventCo Amsterdam',
    status: 'pro', // Pro user - kan messages sturen
    phone: '+31612345671',
    website: 'https://eventco.nl',
    organizationAbout: 'Wij organiseren culturele evenementen in Amsterdam'
  },
  {
    email: 'programmer2@test.com',
    firstName: 'Marie',
    lastName: 'de Vries',
    organizationName: 'Festival Productions',
    status: 'trial', // Trial user - kan ook messages sturen
    phone: '+31612345672',
    website: 'https://festivalproductions.nl',
    organizationAbout: 'Muziekfestivals door heel Nederland'
  },
  {
    email: 'programmer3@test.com',
    firstName: 'Peter',
    lastName: 'Bakker',
    organizationName: 'Theater de Kleine Komedie',
    status: 'pending', // Pending - kan GEEN messages sturen
    phone: '+31612345673',
    website: 'https://kleinekomedie.nl',
    organizationAbout: 'Intiem theater in hartje Rotterdam'
  },
  {
    email: 'programmer4@test.com',
    firstName: 'Lisa',
    lastName: 'van Dijk',
    organizationName: 'Poetry Night Events',
    status: 'pro',
    phone: '+31612345674',
    website: 'https://poetrynight.nl',
    organizationAbout: 'Spoken word events in Utrecht'
  },
  {
    email: 'programmer5@test.com',
    firstName: 'Ahmed',
    lastName: 'Hassan',
    organizationName: 'Multicultureel Festival Den Haag',
    status: 'trial',
    phone: '+31612345675',
    website: 'https://mcfestival.nl',
    organizationAbout: 'Diverse cultural events in The Hague'
  }
];

const TEST_ARTISTS = [
  {
    email: 'artist1@test.com',
    firstName: 'Emma',
    lastName: 'Peters',
    stageName: 'Emma Speaks',
    phone: '+31687654321',
    dob: '1995-03-15',
    gender: 'f',
    location: 'Amsterdam',
    genres: ['Performance Poetry', 'Slam Poetry'],
    languages: ['nl', 'en'],
    paymentMethods: ['bank', 'cash'],
    bio: 'Performance poet uit Amsterdam met focus op maatschappelijke thema\'s',
    pitch: 'Krachtige spoken word over identiteit en sociale rechtvaardigheid. Perfect voor festivals en culturele evenementen.',
    videoUrl: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
    audioUrl: 'https://soundcloud.com/example',
    textContent: 'Sample poem text here...',
    published: true
  },
  {
    email: 'artist2@test.com',
    firstName: 'Jamal',
    lastName: 'Williams',
    stageName: 'J-Flow',
    phone: '+31687654322',
    dob: '1992-07-22',
    gender: 'm',
    location: 'Rotterdam',
    genres: ['Hip Hop Poetry', 'Rap'],
    languages: ['nl', 'en'],
    paymentMethods: ['bank', 'paypal'],
    bio: 'Hip hop poet combining rhythm and storytelling',
    pitch: 'Energieke shows met een mix van rap en poetry. Ideaal voor jongeren events.',
    published: true
  },
  {
    email: 'artist3@test.com',
    firstName: 'Fatima',
    lastName: 'El Amrani',
    stageName: 'Fatima Flames',
    phone: '+31687654323',
    dob: '1998-11-08',
    gender: 'f',
    location: 'Utrecht',
    genres: ['Slam Poetry', 'Performance Poetry'],
    languages: ['nl', 'ar', 'fr'],
    paymentMethods: ['bank'],
    bio: 'Meertalige spoken word artist met Marokkaanse roots',
    pitch: 'Krachtige performances in Nederlands, Arabisch en Frans over identiteit en cultuur.',
    published: true
  },
  {
    email: 'artist4@test.com',
    firstName: 'Sophie',
    lastName: 'van Bergen',
    stageName: 'Sophie Softly',
    phone: '+31687654324',
    dob: '1990-05-30',
    gender: 'f',
    location: 'Den Haag',
    genres: ['Lyrical Poetry', 'Storytelling'],
    languages: ['nl', 'en'],
    paymentMethods: ['bank', 'cash'],
    bio: 'Intieme verhalen verteller met focus op persoonlijke groei',
    pitch: 'Zachte, emotionele poetry voor intieme settings en workshops.',
    published: true
  },
  {
    email: 'artist5@test.com',
    firstName: 'Marcus',
    lastName: 'Johnson',
    stageName: 'MC Truth',
    phone: '+31687654325',
    dob: '1988-01-12',
    gender: 'm',
    location: 'Amsterdam',
    genres: ['Hip Hop Poetry', 'Political Poetry'],
    languages: ['en', 'nl'],
    paymentMethods: ['bank', 'paypal'],
    bio: 'Political spoken word artist addressing social issues',
    pitch: 'Thought-provoking performances about equality and justice.',
    published: true
  },
  {
    email: 'artist6@test.com',
    firstName: 'Yuki',
    lastName: 'Tanaka',
    stageName: 'Yuki Words',
    phone: '+31687654326',
    dob: '1996-09-25',
    gender: 'x',
    location: 'Rotterdam',
    genres: ['Experimental Poetry', 'Performance Poetry'],
    languages: ['nl', 'en', 'ja'],
    paymentMethods: ['bank'],
    bio: 'Experimental artist blending Japanese and Dutch poetry traditions',
    pitch: 'Unique multicultural performances exploring identity and belonging.',
    published: true
  },
  {
    email: 'artist7@test.com',
    firstName: 'David',
    lastName: 'Cohen',
    stageName: 'David Verse',
    phone: '+31687654327',
    dob: '1985-12-03',
    gender: 'm',
    location: 'Utrecht',
    genres: ['Lyrical Poetry', 'Slam Poetry'],
    languages: ['nl', 'en', 'he'],
    paymentMethods: ['bank', 'cash'],
    bio: 'Veteran spoken word artist with 10+ years experience',
    pitch: 'Experienced performer for any occasion. Workshop facilitator.',
    published: true
  },
  {
    email: 'artist8@test.com',
    firstName: 'Nina',
    lastName: 'Kowalski',
    stageName: 'Nina Rhythm',
    phone: '+31687654328',
    dob: '1993-04-18',
    gender: 'f',
    location: 'Den Haag',
    genres: ['Performance Poetry', 'Musical Poetry'],
    languages: ['nl', 'pl', 'en'],
    paymentMethods: ['bank'],
    bio: 'Poetry with live music and beatbox elements',
    pitch: 'Dynamic shows combining spoken word with music and rhythm.',
    published: true
  },
  {
    email: 'artist9@test.com',
    firstName: 'Lucas',
    lastName: 'Silva',
    stageName: 'Lucas Flow',
    phone: '+31687654329',
    dob: '1991-08-07',
    gender: 'm',
    location: 'Amsterdam',
    genres: ['Hip Hop Poetry', 'Rap'],
    languages: ['nl', 'pt', 'es'],
    paymentMethods: ['bank', 'paypal'],
    bio: 'Brazilian-Dutch artist blending cultures through rap poetry',
    pitch: 'Energetic multilingual performances celebrating diversity.',
    published: true
  },
  {
    email: 'artist10@test.com',
    firstName: 'Amira',
    lastName: 'Hassan',
    stageName: 'Amira Voice',
    phone: '+31687654330',
    dob: '1997-02-14',
    gender: 'f',
    location: 'Rotterdam',
    genres: ['Political Poetry', 'Slam Poetry'],
    languages: ['nl', 'ar', 'en'],
    paymentMethods: ['bank'],
    bio: 'Activist poet focusing on refugee stories and integration',
    pitch: 'Powerful narratives about migration, belonging and hope.',
    published: true
  }
];

// Helper functions
async function createAuthUser(email, password) {
  try {
    const userRecord = await auth.createUser({
      email: email,
      password: password,
      emailVerified: true // Skip email verification for test accounts
    });
    console.log(`‚úÖ Auth user created: ${email}`);
    return userRecord.uid;
  } catch (error) {
    if (error.code === 'auth/email-already-exists') {
      console.log(`‚ö†Ô∏è  User already exists: ${email}, fetching UID...`);
      const userRecord = await auth.getUserByEmail(email);
      return userRecord.uid;
    }
    throw error;
  }
}

async function createProgrammer(programmerData) {
  try {
    const uid = await createAuthUser(programmerData.email, TEST_PASSWORD);
    
    // Create user role document
    await db.collection('users').doc(uid).set({
      role: 'programmer',
      email: programmerData.email,
      status: programmerData.status
    });
    
    // Create programmer profile
    await db.collection('programmers').doc(uid).set({
      uid: uid,
      email: programmerData.email,
      firstName: programmerData.firstName,
      lastName: programmerData.lastName,
      phone: programmerData.phone,
      organizationName: programmerData.organizationName,
      organizationAbout: programmerData.organizationAbout,
      website: programmerData.website,
      notifyEmail: true,
      createdAt: new Date().toISOString(),
      status: programmerData.status,
      trialStartedAt: new Date().toISOString()
    });
    
    console.log(`‚úÖ Programmer created: ${programmerData.email} (${programmerData.status})`);
    return uid;
  } catch (error) {
    console.error(`‚ùå Error creating programmer ${programmerData.email}:`, error.message);
    return null;
  }
}

async function createArtist(artistData) {
  try {
    const uid = await createAuthUser(artistData.email, TEST_PASSWORD);
    
    // Create user role document
    await db.collection('users').doc(uid).set({
      role: 'artist',
      email: artistData.email,
      status: 'active'
    });
    
    // Create artist profile
    await db.collection('artists').doc(uid).set({
      uid: uid,
      email: artistData.email,
      firstName: artistData.firstName,
      lastName: artistData.lastName,
      stageName: artistData.stageName,
      phone: artistData.phone,
      dob: artistData.dob,
      gender: artistData.gender,
      location: artistData.location,
      genres: artistData.genres,
      languages: artistData.languages,
      paymentMethods: artistData.paymentMethods,
      bio: artistData.bio,
      pitch: artistData.pitch,
      videoUrl: artistData.videoUrl || '',
      audioUrl: artistData.audioUrl || '',
      textContent: artistData.textContent || '',
      notifyEmail: true,
      notifySms: false,
      createdAt: new Date().toISOString(),
      profilePicUrl: '',
      published: artistData.published
    });
    
    console.log(`‚úÖ Artist created: ${artistData.stageName} (${artistData.email})`);
    return uid;
  } catch (error) {
    console.error(`‚ùå Error creating artist ${artistData.email}:`, error.message);
    return null;
  }
}

async function createTestConversation(programmerUid, programmerData, artistUid, artistData, messageCount = 3) {
  try {
    const conversationData = {
      participants: [programmerUid, artistUid],
      participantNames: {
        [programmerUid]: `${programmerData.firstName} ${programmerData.lastName}`,
        [artistUid]: artistData.stageName || `${artistData.firstName} ${artistData.lastName}`
      },
      participantRoles: {
        [programmerUid]: 'programmer',
        [artistUid]: 'artist'
      },
      participantEmails: {
        [programmerUid]: programmerData.email,
        [artistUid]: artistData.email
      },
      subject: `Booking inquiry for ${artistData.stageName}`,
      lastMessage: '',
      lastMessageAt: admin.firestore.FieldValue.serverTimestamp(),
      unreadBy: [artistUid], // Artist has not read yet
      createdAt: admin.firestore.FieldValue.serverTimestamp()
    };
    
    const conversationRef = await db.collection('conversations').add(conversationData);
    console.log(`‚úÖ Conversation created between ${programmerData.firstName} and ${artistData.stageName}`);
    
    // Add test messages
    const messages = [
      {
        senderId: programmerUid,
        senderName: `${programmerData.firstName} ${programmerData.lastName}`,
        senderRole: 'programmer',
        text: `Hi ${artistData.firstName}! I'm organizing an event and would love to have you perform. Are you available in December?`,
        createdAt: admin.firestore.Timestamp.fromDate(new Date(Date.now() - 3600000 * 24 * 2)), // 2 days ago
        read: false
      },
      {
        senderId: artistUid,
        senderName: artistData.stageName,
        senderRole: 'artist',
        text: `Hi ${programmerData.firstName}! Thanks for reaching out. Yes, I have some availability in December. What dates were you thinking?`,
        createdAt: admin.firestore.Timestamp.fromDate(new Date(Date.now() - 3600000 * 24 * 1)), // 1 day ago
        read: false
      },
      {
        senderId: programmerUid,
        senderName: `${programmerData.firstName} ${programmerData.lastName}`,
        senderRole: 'programmer',
        text: `Great! We're looking at December 15th. It's an evening event with about 200 attendees. Would that work for you?`,
        createdAt: admin.firestore.Timestamp.fromDate(new Date(Date.now() - 3600000 * 12)), // 12 hours ago
        read: false
      }
    ];
    
    for (let i = 0; i < Math.min(messageCount, messages.length); i++) {
      await db.collection(`conversations/${conversationRef.id}/messages`).add(messages[i]);
    }
    
    // Update conversation with last message
    await conversationRef.update({
      lastMessage: messages[Math.min(messageCount, messages.length) - 1].text.substring(0, 100),
      lastMessageAt: messages[Math.min(messageCount, messages.length) - 1].createdAt
    });
    
    console.log(`‚úÖ Added ${messageCount} messages to conversation`);
    
    return conversationRef.id;
  } catch (error) {
    console.error(`‚ùå Error creating conversation:`, error.message);
    return null;
  }
}

// Main seeding function
async function seedDatabase() {
  console.log('\nüå± Starting database seeding...\n');
  
  try {
    // Create programmers
    console.log('üë®‚Äçüíª Creating programmers...');
    const programmerUids = [];
    for (const programmer of TEST_PROGRAMMERS) {
      const uid = await createProgrammer(programmer);
      if (uid) {
        programmerUids.push({ uid, data: programmer });
      }
    }
    console.log(`\n‚úÖ Created ${programmerUids.length} programmers\n`);
    
    // Create artists
    console.log('üé§ Creating artists...');
    const artistUids = [];
    for (const artist of TEST_ARTISTS) {
      const uid = await createArtist(artist);
      if (uid) {
        artistUids.push({ uid, data: artist });
      }
    }
    console.log(`\n‚úÖ Created ${artistUids.length} artists\n`);
    
    // Create test conversations
    console.log('üí¨ Creating test conversations...');
    let conversationCount = 0;
    
    // Create conversations between first 2 PRO programmers and various artists
    const proOrTrialProgrammers = programmerUids.filter(p => p.data.status === 'pro' || p.data.status === 'trial');
    
    for (let i = 0; i < Math.min(2, proOrTrialProgrammers.length); i++) {
      for (let j = 0; j < Math.min(3, artistUids.length); j++) {
        await createTestConversation(
          proOrTrialProgrammers[i].uid,
          proOrTrialProgrammers[i].data,
          artistUids[j].uid,
          artistUids[j].data,
          3
        );
        conversationCount++;
      }
    }
    
    console.log(`\n‚úÖ Created ${conversationCount} conversations with messages\n`);
    
    // Summary
    console.log('\nüìä SEEDING COMPLETE!\n');
    console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
    console.log(`‚úÖ ${programmerUids.length} Programmers created`);
    console.log(`‚úÖ ${artistUids.length} Artists created`);
    console.log(`‚úÖ ${conversationCount} Conversations created`);
    console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n');
    
    console.log('üîë TEST LOGIN CREDENTIALS:\n');
    console.log('All users have password: ' + TEST_PASSWORD + '\n');
    
    console.log('üë®‚Äçüíª PROGRAMMERS:');
    programmerUids.forEach(p => {
      console.log(`  - ${p.data.email} (${p.data.status}) - ${p.data.organizationName}`);
    });
    
    console.log('\nüé§ ARTISTS:');
    artistUids.forEach(a => {
      console.log(`  - ${a.data.email} - ${a.data.stageName}`);
    });
    
    console.log('\n‚ú® Ready to test! Log in with any email above.\n');
    
  } catch (error) {
    console.error('‚ùå Fatal error during seeding:', error);
  }
  
  process.exit(0);
}

// Run the seeding
seedDatabase();
</file>

<file path="seed-test-data.js">
/**
 * seed-test-data.js
 * 
 * Script om test users en conversations aan te maken voor platform testing
 * 
 * GEBRUIK:
 * 1. Plaats dit bestand in je project root
 * 2. Run: node seed-test-data.js
 * 
 * BELANGRIJK: Dit script gebruikt Firebase Admin SDK
 * Je hebt je service account key nodig!
 */

import admin from 'firebase-admin';
import { readFileSync } from 'fs';

// Read service account key
const serviceAccount = JSON.parse(
  readFileSync('./serviceAccountKey.json', 'utf8')
);

// Initialize Firebase Admin
admin.initializeApp({
  credential: admin.credential.cert(serviceAccount)
});

const db = admin.firestore();
const auth = admin.auth();

// Test data configuratie
const TEST_PASSWORD = 'TestPassword123!'; // Alle test users krijgen dit password

const TEST_PROGRAMMERS = [
  {
    email: 'programmer1@test.com',
    firstName: 'Jan',
    lastName: 'Janssen',
    organizationName: 'EventCo Amsterdam',
    status: 'pro', // Pro user - kan messages sturen
    phone: '+31612345671',
    website: 'https://eventco.nl',
    organizationAbout: 'Wij organiseren culturele evenementen in Amsterdam'
  },
  {
    email: 'programmer2@test.com',
    firstName: 'Marie',
    lastName: 'de Vries',
    organizationName: 'Festival Productions',
    status: 'trial', // Trial user - kan ook messages sturen
    phone: '+31612345672',
    website: 'https://festivalproductions.nl',
    organizationAbout: 'Muziekfestivals door heel Nederland'
  },
  {
    email: 'programmer3@test.com',
    firstName: 'Peter',
    lastName: 'Bakker',
    organizationName: 'Theater de Kleine Komedie',
    status: 'pending', // Pending - kan GEEN messages sturen
    phone: '+31612345673',
    website: 'https://kleinekomedie.nl',
    organizationAbout: 'Intiem theater in hartje Rotterdam'
  },
  {
    email: 'programmer4@test.com',
    firstName: 'Lisa',
    lastName: 'van Dijk',
    organizationName: 'Poetry Night Events',
    status: 'pro',
    phone: '+31612345674',
    website: 'https://poetrynight.nl',
    organizationAbout: 'Spoken word events in Utrecht'
  },
  {
    email: 'programmer5@test.com',
    firstName: 'Ahmed',
    lastName: 'Hassan',
    organizationName: 'Multicultureel Festival Den Haag',
    status: 'trial',
    phone: '+31612345675',
    website: 'https://mcfestival.nl',
    organizationAbout: 'Diverse cultural events in The Hague'
  }
];

const TEST_ARTISTS = [
  {
    email: 'artist1@test.com',
    firstName: 'Emma',
    lastName: 'Peters',
    stageName: 'Emma Speaks',
    phone: '+31687654321',
    dob: '1995-03-15',
    gender: 'f',
    location: 'Amsterdam',
    genres: ['Performance Poetry', 'Slam Poetry'],
    languages: ['nl', 'en'],
    paymentMethods: ['bank', 'cash'],
    bio: 'Performance poet uit Amsterdam met focus op maatschappelijke thema\'s',
    pitch: 'Krachtige spoken word over identiteit en sociale rechtvaardigheid. Perfect voor festivals en culturele evenementen.',
    videoUrl: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
    audioUrl: 'https://soundcloud.com/example',
    textContent: 'Sample poem text here...',
    published: true
  },
  {
    email: 'artist2@test.com',
    firstName: 'Jamal',
    lastName: 'Williams',
    stageName: 'J-Flow',
    phone: '+31687654322',
    dob: '1992-07-22',
    gender: 'm',
    location: 'Rotterdam',
    genres: ['Hip Hop Poetry', 'Rap'],
    languages: ['nl', 'en'],
    paymentMethods: ['bank', 'paypal'],
    bio: 'Hip hop poet combining rhythm and storytelling',
    pitch: 'Energieke shows met een mix van rap en poetry. Ideaal voor jongeren events.',
    published: true
  },
  {
    email: 'artist3@test.com',
    firstName: 'Fatima',
    lastName: 'El Amrani',
    stageName: 'Fatima Flames',
    phone: '+31687654323',
    dob: '1998-11-08',
    gender: 'f',
    location: 'Utrecht',
    genres: ['Slam Poetry', 'Performance Poetry'],
    languages: ['nl', 'ar', 'fr'],
    paymentMethods: ['bank'],
    bio: 'Meertalige spoken word artist met Marokkaanse roots',
    pitch: 'Krachtige performances in Nederlands, Arabisch en Frans over identiteit en cultuur.',
    published: true
  },
  {
    email: 'artist4@test.com',
    firstName: 'Sophie',
    lastName: 'van Bergen',
    stageName: 'Sophie Softly',
    phone: '+31687654324',
    dob: '1990-05-30',
    gender: 'f',
    location: 'Den Haag',
    genres: ['Lyrical Poetry', 'Storytelling'],
    languages: ['nl', 'en'],
    paymentMethods: ['bank', 'cash'],
    bio: 'Intieme verhalen verteller met focus op persoonlijke groei',
    pitch: 'Zachte, emotionele poetry voor intieme settings en workshops.',
    published: true
  },
  {
    email: 'artist5@test.com',
    firstName: 'Marcus',
    lastName: 'Johnson',
    stageName: 'MC Truth',
    phone: '+31687654325',
    dob: '1988-01-12',
    gender: 'm',
    location: 'Amsterdam',
    genres: ['Hip Hop Poetry', 'Political Poetry'],
    languages: ['en', 'nl'],
    paymentMethods: ['bank', 'paypal'],
    bio: 'Political spoken word artist addressing social issues',
    pitch: 'Thought-provoking performances about equality and justice.',
    published: true
  },
  {
    email: 'artist6@test.com',
    firstName: 'Yuki',
    lastName: 'Tanaka',
    stageName: 'Yuki Words',
    phone: '+31687654326',
    dob: '1996-09-25',
    gender: 'x',
    location: 'Rotterdam',
    genres: ['Experimental Poetry', 'Performance Poetry'],
    languages: ['nl', 'en', 'ja'],
    paymentMethods: ['bank'],
    bio: 'Experimental artist blending Japanese and Dutch poetry traditions',
    pitch: 'Unique multicultural performances exploring identity and belonging.',
    published: true
  },
  {
    email: 'artist7@test.com',
    firstName: 'David',
    lastName: 'Cohen',
    stageName: 'David Verse',
    phone: '+31687654327',
    dob: '1985-12-03',
    gender: 'm',
    location: 'Utrecht',
    genres: ['Lyrical Poetry', 'Slam Poetry'],
    languages: ['nl', 'en', 'he'],
    paymentMethods: ['bank', 'cash'],
    bio: 'Veteran spoken word artist with 10+ years experience',
    pitch: 'Experienced performer for any occasion. Workshop facilitator.',
    published: true
  },
  {
    email: 'artist8@test.com',
    firstName: 'Nina',
    lastName: 'Kowalski',
    stageName: 'Nina Rhythm',
    phone: '+31687654328',
    dob: '1993-04-18',
    gender: 'f',
    location: 'Den Haag',
    genres: ['Performance Poetry', 'Musical Poetry'],
    languages: ['nl', 'pl', 'en'],
    paymentMethods: ['bank'],
    bio: 'Poetry with live music and beatbox elements',
    pitch: 'Dynamic shows combining spoken word with music and rhythm.',
    published: true
  },
  {
    email: 'artist9@test.com',
    firstName: 'Lucas',
    lastName: 'Silva',
    stageName: 'Lucas Flow',
    phone: '+31687654329',
    dob: '1991-08-07',
    gender: 'm',
    location: 'Amsterdam',
    genres: ['Hip Hop Poetry', 'Rap'],
    languages: ['nl', 'pt', 'es'],
    paymentMethods: ['bank', 'paypal'],
    bio: 'Brazilian-Dutch artist blending cultures through rap poetry',
    pitch: 'Energetic multilingual performances celebrating diversity.',
    published: true
  },
  {
    email: 'artist10@test.com',
    firstName: 'Amira',
    lastName: 'Hassan',
    stageName: 'Amira Voice',
    phone: '+31687654330',
    dob: '1997-02-14',
    gender: 'f',
    location: 'Rotterdam',
    genres: ['Political Poetry', 'Slam Poetry'],
    languages: ['nl', 'ar', 'en'],
    paymentMethods: ['bank'],
    bio: 'Activist poet focusing on refugee stories and integration',
    pitch: 'Powerful narratives about migration, belonging and hope.',
    published: true
  }
];

// Helper functions
async function createAuthUser(email, password) {
  try {
    const userRecord = await auth.createUser({
      email: email,
      password: password,
      emailVerified: true // Skip email verification for test accounts
    });
    console.log(`‚úÖ Auth user created: ${email}`);
    return userRecord.uid;
  } catch (error) {
    if (error.code === 'auth/email-already-exists') {
      console.log(`‚ö†Ô∏è  User already exists: ${email}, fetching UID...`);
      const userRecord = await auth.getUserByEmail(email);
      return userRecord.uid;
    }
    throw error;
  }
}

async function createProgrammer(programmerData) {
  try {
    const uid = await createAuthUser(programmerData.email, TEST_PASSWORD);
    
    // Create user role document
    await db.collection('users').doc(uid).set({
      role: 'programmer',
      email: programmerData.email,
      status: programmerData.status
    });
    
    // Create programmer profile
    await db.collection('programmers').doc(uid).set({
      uid: uid,
      email: programmerData.email,
      firstName: programmerData.firstName,
      lastName: programmerData.lastName,
      phone: programmerData.phone,
      organizationName: programmerData.organizationName,
      organizationAbout: programmerData.organizationAbout,
      website: programmerData.website,
      notifyEmail: true,
      createdAt: new Date().toISOString(),
      status: programmerData.status,
      trialStartedAt: new Date().toISOString()
    });
    
    console.log(`‚úÖ Programmer created: ${programmerData.email} (${programmerData.status})`);
    return uid;
  } catch (error) {
    console.error(`‚ùå Error creating programmer ${programmerData.email}:`, error.message);
    return null;
  }
}

async function createArtist(artistData) {
  try {
    const uid = await createAuthUser(artistData.email, TEST_PASSWORD);
    
    // Create user role document
    await db.collection('users').doc(uid).set({
      role: 'artist',
      email: artistData.email,
      status: 'active'
    });
    
    // Create artist profile
    await db.collection('artists').doc(uid).set({
      uid: uid,
      email: artistData.email,
      firstName: artistData.firstName,
      lastName: artistData.lastName,
      stageName: artistData.stageName,
      phone: artistData.phone,
      dob: artistData.dob,
      gender: artistData.gender,
      location: artistData.location,
      genres: artistData.genres,
      languages: artistData.languages,
      paymentMethods: artistData.paymentMethods,
      bio: artistData.bio,
      pitch: artistData.pitch,
      videoUrl: artistData.videoUrl || '',
      audioUrl: artistData.audioUrl || '',
      textContent: artistData.textContent || '',
      notifyEmail: true,
      notifySms: false,
      createdAt: new Date().toISOString(),
      profilePicUrl: '',
      published: artistData.published
    });
    
    console.log(`‚úÖ Artist created: ${artistData.stageName} (${artistData.email})`);
    return uid;
  } catch (error) {
    console.error(`‚ùå Error creating artist ${artistData.email}:`, error.message);
    return null;
  }
}

async function createTestConversation(programmerUid, programmerData, artistUid, artistData, messageCount = 3) {
  try {
    const conversationData = {
      participants: [programmerUid, artistUid],
      participantNames: {
        [programmerUid]: `${programmerData.firstName} ${programmerData.lastName}`,
        [artistUid]: artistData.stageName || `${artistData.firstName} ${artistData.lastName}`
      },
      participantRoles: {
        [programmerUid]: 'programmer',
        [artistUid]: 'artist'
      },
      participantEmails: {
        [programmerUid]: programmerData.email,
        [artistUid]: artistData.email
      },
      subject: `Booking inquiry for ${artistData.stageName}`,
      lastMessage: '',
      lastMessageAt: admin.firestore.FieldValue.serverTimestamp(),
      unreadBy: [artistUid], // Artist has not read yet
      createdAt: admin.firestore.FieldValue.serverTimestamp()
    };
    
    const conversationRef = await db.collection('conversations').add(conversationData);
    console.log(`‚úÖ Conversation created between ${programmerData.firstName} and ${artistData.stageName}`);
    
    // Add test messages
    const messages = [
      {
        senderId: programmerUid,
        senderName: `${programmerData.firstName} ${programmerData.lastName}`,
        senderRole: 'programmer',
        text: `Hi ${artistData.firstName}! I'm organizing an event and would love to have you perform. Are you available in December?`,
        createdAt: admin.firestore.Timestamp.fromDate(new Date(Date.now() - 3600000 * 24 * 2)), // 2 days ago
        read: false
      },
      {
        senderId: artistUid,
        senderName: artistData.stageName,
        senderRole: 'artist',
        text: `Hi ${programmerData.firstName}! Thanks for reaching out. Yes, I have some availability in December. What dates were you thinking?`,
        createdAt: admin.firestore.Timestamp.fromDate(new Date(Date.now() - 3600000 * 24 * 1)), // 1 day ago
        read: false
      },
      {
        senderId: programmerUid,
        senderName: `${programmerData.firstName} ${programmerData.lastName}`,
        senderRole: 'programmer',
        text: `Great! We're looking at December 15th. It's an evening event with about 200 attendees. Would that work for you?`,
        createdAt: admin.firestore.Timestamp.fromDate(new Date(Date.now() - 3600000 * 12)), // 12 hours ago
        read: false
      }
    ];
    
    for (let i = 0; i < Math.min(messageCount, messages.length); i++) {
      await db.collection(`conversations/${conversationRef.id}/messages`).add(messages[i]);
    }
    
    // Update conversation with last message
    await conversationRef.update({
      lastMessage: messages[Math.min(messageCount, messages.length) - 1].text.substring(0, 100),
      lastMessageAt: messages[Math.min(messageCount, messages.length) - 1].createdAt
    });
    
    console.log(`‚úÖ Added ${messageCount} messages to conversation`);
    
    return conversationRef.id;
  } catch (error) {
    console.error(`‚ùå Error creating conversation:`, error.message);
    return null;
  }
}

// Main seeding function
async function seedDatabase() {
  console.log('\nüå± Starting database seeding...\n');
  
  try {
    // Create programmers
    console.log('üë®‚Äçüíª Creating programmers...');
    const programmerUids = [];
    for (const programmer of TEST_PROGRAMMERS) {
      const uid = await createProgrammer(programmer);
      if (uid) {
        programmerUids.push({ uid, data: programmer });
      }
    }
    console.log(`\n‚úÖ Created ${programmerUids.length} programmers\n`);
    
    // Create artists
    console.log('üé§ Creating artists...');
    const artistUids = [];
    for (const artist of TEST_ARTISTS) {
      const uid = await createArtist(artist);
      if (uid) {
        artistUids.push({ uid, data: artist });
      }
    }
    console.log(`\n‚úÖ Created ${artistUids.length} artists\n`);
    
    // Create test conversations
    console.log('üí¨ Creating test conversations...');
    let conversationCount = 0;
    
    // Create conversations between first 2 PRO programmers and various artists
    const proOrTrialProgrammers = programmerUids.filter(p => p.data.status === 'pro' || p.data.status === 'trial');
    
    for (let i = 0; i < Math.min(2, proOrTrialProgrammers.length); i++) {
      for (let j = 0; j < Math.min(3, artistUids.length); j++) {
        await createTestConversation(
          proOrTrialProgrammers[i].uid,
          proOrTrialProgrammers[i].data,
          artistUids[j].uid,
          artistUids[j].data,
          3
        );
        conversationCount++;
      }
    }
    
    console.log(`\n‚úÖ Created ${conversationCount} conversations with messages\n`);
    
    // Summary
    console.log('\nüìä SEEDING COMPLETE!\n');
    console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
    console.log(`‚úÖ ${programmerUids.length} Programmers created`);
    console.log(`‚úÖ ${artistUids.length} Artists created`);
    console.log(`‚úÖ ${conversationCount} Conversations created`);
    console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n');
    
    console.log('üîë TEST LOGIN CREDENTIALS:\n');
    console.log('All users have password: ' + TEST_PASSWORD + '\n');
    
    console.log('üë®‚Äçüíª PROGRAMMERS:');
    programmerUids.forEach(p => {
      console.log(`  - ${p.data.email} (${p.data.status}) - ${p.data.organizationName}`);
    });
    
    console.log('\nüé§ ARTISTS:');
    artistUids.forEach(a => {
      console.log(`  - ${a.data.email} - ${a.data.stageName}`);
    });
    
    console.log('\n‚ú® Ready to test! Log in with any email above.\n');
    
  } catch (error) {
    console.error('‚ùå Fatal error during seeding:', error);
  }
  
  process.exit(0);
}

// Run the seeding
seedDatabase();
</file>

<file path="storage.rules">
rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    
    // 1. Artiesten: Media en Portfolio (Publiek leesbaar)
    match /artists/{userId}/{allPaths=**} {
      allow read: if true; 
      allow write: if request.auth != null && request.auth.uid == userId
                   && request.resource.size < 10 * 1024 * 1024; // Limiet van 10MB
    }
    
    // 2. Programmeurs: Profielfoto's (Alleen voor ingelogde gebruikers)
    match /programmers/{userId}/{allPaths=**} {
      allow read: if request.auth != null; 
      allow write: if request.auth != null && request.auth.uid == userId
                   && request.resource.size < 5 * 1024 * 1024 // Limiet van 5MB
                   && request.resource.contentType.matches('image/.*');
    }
    
    // 3. Documenten (bijv. technische fiches)
    match /documents/{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
    }

    // Default: Alles blokkeren
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}
</file>

<file path="style.css">
/* DEZE 3 REGELS ZIJN NIEUW
  Zij importeren de Tailwind stijlen in uw project.
*/
@tailwind base;
@tailwind components;
@tailwind utilities;

/* Hieronder staan uw bestaande stijlen */

body {
    font-family: 'Inter', sans-serif;
}

/* Aangepaste stijlen voor multi-select in de formulieren */
select[multiple] {
    height: 120px;
}

/* Simpele laad-spinner */
.loader {
    border: 4px solid #f3f3f3; /* Light grey */
    border-top: 4px solid #3498db; /* Blue */
    border-radius: 50%;
    width: 40px;
    height: 40px;
    animation: spin 1s linear infinite;
    position: absolute;
    top: 50%;
    left: 50%;
    margin-left: -20px;
    margin-top: -20px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Verberg alle pagina-secties standaard */
.page-section { 
    display: none; 
}

/* Toon het laadscherm standaard */
#loading-view { 
    display: flex; 
}

/* Stijl voor de profielfoto preview */
#profile-pic-preview {
    display: none; /* Standaard verborgen, JS toont het */
    border: 2px solid #e2e8f0; /* Lichte rand */
}

/* GRID LAYOUT FORCING - Ensure 3-column grid works on desktop */
#app-content {
    width: 100%;
    max-width: none;
}

/* 
   REMOVED: #artist-search-section and .artist-card overrides 
   These were conflicting with the new Apple-style Search Module layout.
   The new module handles its own width and grid structure via Tailwind.
*/

/* Ensure main containers are wide enough */
#artist-results-main {
    width: 100%;
    max-width: none;
}

/* Gallery Column Switcher Active State */
.column-btn.active {
    background-color: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
}

.column-btn {
    transition: all 0.2s ease;
}
</file>

<file path="tailwind.config.js">
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./*.js"  // <-- DIT IS DE CORRECTIE
  ],
  theme: {
    extend: {},
  },
  plugins: [],
}
</file>

<file path="functions/index.js">
/**
 * Cloud Functions for Spoken Word Database
 *
 * This file contains three functions:
 * 1. onProgrammerSignup: Emails the admin when a new programmer signs up.
 * 2. approveProgrammer: An HTTPS function (a "webhook") that the admin clicks to approve a programmer.
 * 3. onProgrammerApproved: Emails the programmer *after* their account is approved.
 */

// Import all necessary modules
// We specificeren de regio "europe-west4" voor alle functies
const { onDocumentCreated, onDocumentUpdated } = require("firebase-functions/v2/firestore");
const { onRequest } = require("firebase-functions/v2/https");
const { getFirestore } = require("firebase-admin/firestore");
const { initializeApp } = require("firebase-admin/app");

// Initialize the Firebase Admin SDK
initializeApp();

// --- CONFIGURATION ---
// VERVANG DIT MET UW EIGEN E-MAILADRES
const ADMIN_EMAIL = "timthomaes@gmail.com";
// ---------------------


/**
 * ROBOT 1: NOTIFY ADMIN ON SIGNUP
 * Triggers when a new document is created in the 'programmers' collection.
 * Sends an email to the admin with an approval link.
 */
exports.onProgrammerSignup = onDocumentCreated({
  document: "programmers/{programmerId}",
  region: "europe-west4"
}, async (event) => {
  const data = event.data.data();
  const programmerId = event.params.programmerId;

  console.log(`New programmer signed up: ${data.email}. Sending admin notification.`);

  // Make sure all data is present
  if (!data.email || !data.firstName || !data.organizationName) {
    console.error("Missing data in new programmer document. Cannot send admin email.");
    return null;
  }

  // Create the email document in the 'mail' collection for the ADMIN
  try {
    await getFirestore().collection("mail").add({
      to: [ADMIN_EMAIL],
      template: {
        name: "admin-approval-request", // This MUST match your template ID
        data: {
          firstName: data.firstName,
          lastName: data.lastName,
          organizationName: data.organizationName,
          email: data.email,
          programmerId: programmerId, // We pass this so the template can build the link
        },
      },
    });
    console.log("Admin notification email created successfully.");
    return null;
  } catch (error) {
    console.error("Error creating admin mail document:", error);
    return null;
  }
});


/**
 * ROBOT 2: APPROVE PROGRAMMER VIA HTTPS LINK
 * Triggers when the admin clicks the "Approve" link in their email.
 * This is a public-facing URL.
 */
exports.approveProgrammer = onRequest({ region: "europe-west4" }, async (req, res) => {
  // 1. Get the programmer's ID from the URL (e.g., ?id=XXXXX)
  const programmerId = req.query.id;

  if (!programmerId) {
    console.error("No programmer ID provided in request.");
    res.status(400).send("Error: No ID provided. Please check the link.");
    return;
  }

  console.log(`Approval request received for programmer: ${programmerId}`);

  try {
    // 2. Create references to BOTH documents that need to be updated.
    const programmerRef = getFirestore().collection("programmers").doc(programmerId);
    const userRef = getFirestore().collection("users").doc(programmerId); // <-- DE BUGFIX

    const doc = await programmerRef.get();

    if (!doc.exists) {
      console.error("Programmer document not found.");
      res.status(404).send("Error: This programmer account was not found. It may have been deleted.");
      return;
    }
    
    // Check if already approved
    if (doc.data().status === "trial") {
        console.log("Programmer was already approved.");
        res.status(200).send("This programmer has already been approved. No action was taken.");
        return;
    }

    // 3. --- DE BUGFIX ---
    // Gebruik een "batch" om BEIDE documenten tegelijk bij te werken.
    const batch = getFirestore().batch();
    
    // Update de status in 'programmers'
    batch.update(programmerRef, { status: "trial" });
    
    // Update de status in 'users' (dit was de ontbrekende stap)
    batch.update(userRef, { status: "trial" });

    // Voer beide updates tegelijk uit
    await batch.commit();

    // 4. Send a "Success" message back to the admin's browser
    console.log(`Successfully approved programmer: ${programmerId}`);
    res.status(200).send(
      `<html>
        <head>
          <style>body { font-family: sans-serif; text-align: center; padding-top: 50px; background-color: #f0f9f0; color: #333; } h1 { color: #28a745; }</style>
        </head>
        <body>
          <h1>Success!</h1>
          <p>The programmer account has been approved and moved to 'trial' status.</p>
          <p>Both the 'programmers' and 'users' collections have been updated.</p>
          <p>They will now receive their welcome email automatically.</p>
        </body>
      </html>`
    );

  } catch (error) {
    console.error(`Failed to approve programmer ${programmerId}:`, error);
    res.status(500).send("An internal error occurred. Please check the function logs.");
  }
});


/**
 * ROBOT 3: NOTIFY PROGRAMMER ON APPROVAL (Your existing function)
 * Listens for updates on any document in the 'programmers' collection.
 * If a programmer's status is changed from 'pending' to 'trial',
 * it automatically creates a new email document in the 'mail' collection.
 */
exports.onProgrammerApproved = onDocumentUpdated({
  document: "programmers/{programmerId}",
  region: "europe-west4"
}, async (event) => {
  // Get the data from before and after the change
  const dataBefore = event.data.before.data();
  const dataAfter = event.data.after.data();

  // Check if the status was changed from 'pending' to 'trial'
  if (dataBefore.status === "pending" && dataAfter.status === "trial") {
    console.log(`Programmer ${event.params.programmerId} approved. Sending email to programmer...`);

    // Get the user's details from the updated document
    const email = dataAfter.email;
    const firstName = dataAfter.firstName;
    const organizationName = dataAfter.organizationName;

    // Make sure all data is present before sending
    if (!email || !firstName || !organizationName) {
      console.error("Missing user data (email, firstName, or organizationName). Cannot send email.");
      return null;
    }

    // Create the email document in the 'mail' collection
    try {
      await getFirestore().collection("mail").add({
        to: [email],
        template: {
          name: "programmer-approved", // This MUST match your programmer-facing template ID
          data: {
            firstName: firstName,
            organizationName: organizationName,
          },
        },
      });
      console.log("Programmer welcome email created successfully.");
      return null;
    } catch (error) {
      console.error("Error creating programmer mail document:", error);
      return null;
    }
  }

  // If the status wasn't changed from pending to trial, do nothing.
  return null;
});


/**
 * ROBOT 4: NOTIFY ARTIST ON NEW RECOMMENDATION
 * Triggers when a programmer writes a recommendation for an artist.
 * Sends an email notification to the artist.
 */
exports.onRecommendationCreated = onDocumentCreated({
  document: "recommendations/{recommendationId}",
  region: "europe-west4"
}, async (event) => {
  const recommendation = event.data.data();
  const recommendationId = event.params.recommendationId;

  console.log(`New recommendation created for artist ${recommendation.artistId}. Sending email notification.`);

  try {
    // Fetch artist data
    const artistRef = getFirestore().collection("artists").doc(recommendation.artistId);
    const artistSnap = await artistRef.get();

    if (!artistSnap.exists) {
      console.error("Artist document not found.");
      return null;
    }

    const artistData = artistSnap.data();
    const artistEmail = artistData.email;
    const artistName = artistData.stageName || `${artistData.firstName} ${artistData.lastName}`;

    if (!artistEmail) {
      console.error("Artist email not found. Cannot send notification.");
      return null;
    }

    // Build the inline HTML email template
    const emailHtml = `
<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nieuwe Aanbeveling Ontvangen</title>
</head>
<body style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; line-height: 1.6; color: #333; background-color: #f5f5f5; margin: 0; padding: 0;">
    <div style="max-width: 600px; margin: 40px auto; background-color: #ffffff; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">

        <!-- Header -->
        <div style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); color: #ffffff; padding: 30px; text-align: center;">
            <h1 style="margin: 0; font-size: 24px; font-weight: 600;">üåü Nieuwe Aanbeveling Ontvangen!</h1>
        </div>

        <!-- Content -->
        <div style="padding: 30px;">
            <p style="margin: 0 0 15px 0;">Hallo <strong>${artistName}</strong>,</p>

            <p style="margin: 0 0 20px 0;">Goed nieuws! Je hebt een nieuwe aanbeveling ontvangen van <strong>${recommendation.programmerName}</strong>${recommendation.programmerOrganization ? ` (${recommendation.programmerOrganization})` : ''}.</p>

            <div style="background-color: #ffffff; border: 2px solid #6366f1; padding: 20px; border-radius: 8px; margin: 20px 0;">
                <p style="margin: 0; font-style: italic; color: #555; font-size: 16px;">
                    "${recommendation.text}"
                </p>
            </div>

            <div style="text-align: center; margin: 25px 0;">
                <a href="https://community.dansdichterdans.be" style="display: inline-block; background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); color: #ffffff; text-decoration: none; padding: 14px 32px; border-radius: 6px; font-weight: 600;">
                    Bekijk Je Profiel ‚Üí
                </a>
            </div>

            <div style="height: 1px; background-color: #e9ecef; margin: 20px 0;"></div>

            <p style="color: #6c757d; font-size: 14px; margin: 15px 0 0 0;">
                <strong>Tip:</strong> Aanbevelingen zijn zichtbaar op je profiel voor alle programmeurs. Ze helpen je om meer boekingen te krijgen!
            </p>
        </div>

        <!-- Footer -->
        <div style="background-color: #f8f9fa; padding: 20px 30px; text-align: center; color: #6c757d; font-size: 14px;">
            <p style="margin: 0 0 10px 0;">Je ontvangt deze email omdat je een profiel hebt op SpokenWord DB.</p>
            <p style="margin: 0;">
                <a href="https://community.dansdichterdans.be" style="color: #6366f1; text-decoration: none;">Bezoek SpokenWord DB</a>
            </p>
            <p style="margin: 15px 0 0 0; font-size: 12px; color: #999;">
                ¬© 2024 SpokenWord Database. Alle rechten voorbehouden.
            </p>
        </div>
    </div>
</body>
</html>
    `;

    // Send email via Firebase Extension
    await getFirestore().collection("mail").add({
      to: [artistEmail],
      message: {
        subject: `üåü Nieuwe aanbeveling van ${recommendation.programmerName}`,
        html: emailHtml,
      },
    });

    console.log(`Email notification sent to ${artistEmail} for new recommendation`);
    return null;

  } catch (error) {
    console.error("Error sending recommendation notification:", error);
    return null;
  }
});


/**
 * ROBOT 5: NOTIFY USER ON NEW MESSAGE (FASE 4)
 * Triggers when a new message is created in any conversation.
 * Sends an email notification to the recipient.
 * SMTP VERSION: Uses inline HTML template (geen external template nodig)
 */
exports.onNewMessage = onDocumentCreated({
  document: "conversations/{conversationId}/messages/{messageId}",
  region: "europe-west4"
}, async (event) => {
  const messageData = event.data.data();
  const conversationId = event.params.conversationId;
  const messageId = event.params.messageId;

  console.log(`New message in conversation ${conversationId}. Preparing email notification.`);

  // Get the conversation document to find the recipient
  try {
    const conversationRef = getFirestore().collection("conversations").doc(conversationId);
    const conversationSnap = await conversationRef.get();

    if (!conversationSnap.exists) {
      console.error("Conversation document not found.");
      return null;
    }

    const conversationData = conversationSnap.data();

    // Determine who the recipient is (not the sender)
    const senderId = messageData.senderId;
    const recipientId = conversationData.participants.find(id => id !== senderId);

    if (!recipientId) {
      console.error("Could not determine recipient.");
      return null;
    }

    // Get recipient details
    const recipientEmail = conversationData.participantEmails[recipientId];
    const recipientName = conversationData.participantNames[recipientId];
    const senderName = messageData.senderName;
    const subject = conversationData.subject || "No subject";
    
    // Create message preview (first 100 characters)
    const messagePreview = messageData.text.length > 100 
      ? messageData.text.substring(0, 100) + "..." 
      : messageData.text;

    // Validate required data
    if (!recipientEmail || !recipientName || !senderName) {
      console.error("Missing required email data. Cannot send notification.");
      return null;
    }

    // Create conversation link
    const conversationLink = `https://community.dansdichterdans.be`;

    // Build the inline HTML email template
    const emailHtml = `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Message Notification</title>
</head>
<body style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; line-height: 1.6; color: #333; background-color: #f5f5f5; margin: 0; padding: 0;">
    <div style="max-width: 600px; margin: 40px auto; background-color: #ffffff; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        
        <!-- Header -->
        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #ffffff; padding: 30px; text-align: center;">
            <h1 style="margin: 0; font-size: 24px; font-weight: 600;">üí¨ New Message Received</h1>
        </div>

        <!-- Content -->
        <div style="padding: 30px;">
            <p style="margin: 0 0 15px 0;">Hello <strong>${recipientName}</strong>,</p>
            
            <p style="margin: 0 0 20px 0;">You have received a new message from <strong>${senderName}</strong>.</p>

            <div style="background-color: #f8f9fa; border-left: 4px solid #667eea; padding: 15px; margin: 20px 0; border-radius: 4px;">
                <h3 style="margin: 0 0 10px 0; color: #667eea; font-size: 16px;">üìã Subject</h3>
                <p style="margin: 0;">${subject}</p>
            </div>

            <div style="background-color: #ffffff; border: 1px solid #e9ecef; padding: 15px; border-radius: 4px; margin: 15px 0; font-style: italic; color: #555;">
                <strong>Message Preview:</strong><br>
                "${messagePreview}"
            </div>

            <div style="text-align: center; margin: 25px 0;">
                <a href="${conversationLink}" style="display: inline-block; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #ffffff; text-decoration: none; padding: 14px 32px; border-radius: 6px; font-weight: 600;">
                    View Full Conversation ‚Üí
                </a>
            </div>

            <div style="height: 1px; background-color: #e9ecef; margin: 20px 0;"></div>

            <p style="color: #6c757d; font-size: 14px; margin: 15px 0 0 0;">
                <strong>Quick tip:</strong> Reply directly from your messages dashboard to continue the conversation.
            </p>
        </div>

        <!-- Footer -->
        <div style="background-color: #f8f9fa; padding: 20px 30px; text-align: center; color: #6c757d; font-size: 14px;">
            <p style="margin: 0 0 10px 0;">You're receiving this email because you have an active conversation on SpokenWord DB.</p>
            <p style="margin: 0;">
                <a href="https://community.dansdichterdans.be" style="color: #667eea; text-decoration: none;">Visit SpokenWord DB</a>
            </p>
            <p style="margin: 15px 0 0 0; font-size: 12px; color: #999;">
                ¬© 2024 SpokenWord Database. All rights reserved.
            </p>
        </div>
    </div>
</body>
</html>
    `;

    // Create the email document in the 'mail' collection (SMTP version)
    await getFirestore().collection("mail").add({
      to: [recipientEmail],
      message: {
        subject: `New message from ${senderName} - ${subject}`,
        html: emailHtml,
      },
    });

    console.log(`Email notification sent to ${recipientEmail} for new message from ${senderName}`);
    return null;

  } catch (error) {
    console.error("Error sending message notification:", error);
    return null;
  }
});
</file>

<file path="src/modules/messaging/messaging-controller.js">
/**
 * messaging-controller.js
 * Controller/Event Handler Layer for Messaging
 * Handles all user interactions, event listeners, and orchestrates service + UI layers
 */

import {
  findExistingConversation,
  createConversation,
  addMessage,
  fetchConversations,
  fetchMessages,
  fetchConversation,
  fetchUserProfile,
  markConversationAsRead,
  setupConversationsListener
} from './messaging-service.js';

import {
  displayConversations,
  displayMessages,
  appendMessageToUI,
  updateUnreadBadge,
  scrollToBottom,
  showProgrammerProfileModal
} from './messaging-ui.js';

import { getStore } from '../../utils/store.js';
import { showErrorToast, showSuccessToast } from '../../ui/toast.js';

// Globale variabele om de huidige artiest bij te houden
let currentArtistForMessage = null;

// Global variable to store the unsubscribe function for badge listener
let badgeListenerUnsubscribe = null;

/**
 * Opent de message modal voor een specifieke artiest
 * @param {object} artist - Het artiest object
 */
export function openMessageModal(artist) {
  const modal = document.getElementById('message-modal');
  const artistNameSpan = document.getElementById('message-artist-name');
  const messageError = document.getElementById('message-error');
  const messageSuccess = document.getElementById('message-success');

  // Sla de artiest op voor later gebruik
  currentArtistForMessage = artist;

  // Update de modal
  artistNameSpan.textContent = artist.stageName || `${artist.firstName} ${artist.lastName}`;

  // Reset form en messages
  document.getElementById('send-message-form').reset();
  messageError.style.display = 'none';
  messageSuccess.style.display = 'none';

  // Toon modal
  modal.classList.remove('hidden');
  modal.classList.add('flex');

  // Activeer Lucide icons
  if (window.lucide) {
    window.lucide.createIcons();
  }
}

/**
 * Sluit de message modal
 */
function closeMessageModal() {
  const modal = document.getElementById('message-modal');
  modal.classList.add('hidden');
  modal.classList.remove('flex');
  currentArtistForMessage = null;
}

/**
 * Verwerkt het versturen van een bericht
 */
async function handleSendMessage(e) {
  e.preventDefault();

  const messageError = document.getElementById('message-error');
  const messageSuccess = document.getElementById('message-success');
  const submitBtn = e.submitter || e.target.querySelector('button[type="submit"]');

  // Reset messages
  messageError.style.display = 'none';
  messageSuccess.style.display = 'none';

  // Disable button
  submitBtn.disabled = true;
  submitBtn.innerHTML = '<i data-lucide="loader" class="h-4 w-4 mr-2 animate-spin"></i>Sending...';

  try {
    // Haal gegevens op
    const currentUser = getStore('currentUser');
    const currentUserData = getStore('currentUserData');

    if (!currentUser || !currentUserData) {
      throw new Error('User not logged in');
    }

    if (!currentArtistForMessage) {
      throw new Error('No artist selected');
    }

    const subject = document.getElementById('message-subject').value.trim();
    const messageText = document.getElementById('message-text').value.trim();

    if (!subject || !messageText) {
      throw new Error('Please fill in all fields');
    }

    // Check of er al een conversatie bestaat tussen deze twee users
    const existingConversation = await findExistingConversation(
      currentUser.uid,
      currentArtistForMessage.uid || currentArtistForMessage.id
    );

    let conversationId;

    if (existingConversation) {
      // Gebruik bestaande conversatie
      conversationId = existingConversation.id;
    } else {
      // Maak nieuwe conversatie aan
      conversationId = await createConversation(
        currentUser.uid,
        currentUserData,
        currentArtistForMessage,
        subject
      );
    }

    // Voeg bericht toe aan conversatie
    await addMessage(conversationId, currentUser.uid, currentUserData, messageText);

    // Toon success bericht
    messageSuccess.textContent = 'Message sent successfully!';
    messageSuccess.style.display = 'block';

    // Sluit modal na 2 seconden
    setTimeout(() => {
      closeMessageModal();
    }, 2000);

  } catch (error) {
    console.error("Error sending message:", error);
    const errorMessage = error.message || 'Failed to send message. Please try again.';
    messageError.textContent = errorMessage;
    messageError.style.display = 'block';

    // Show toast notification
    showErrorToast(errorMessage);

    // Re-enable button
    submitBtn.disabled = false;
    submitBtn.innerHTML = '<i data-lucide="send" class="h-4 w-4 mr-2"></i>Send Message';
    if (window.lucide) {
      window.lucide.createIcons();
    }
  }
}

/**
 * Laadt alle conversaties voor de ingelogde gebruiker
 */
export async function loadConversations() {
  const currentUser = getStore('currentUser');

  if (!currentUser) {
    console.error("No user logged in");
    return;
  }

  const loadingEl = document.getElementById('conversations-loading');
  const emptyEl = document.getElementById('conversations-empty');
  const listEl = document.getElementById('conversations-list');

  // Show loading skeleton
  if (loadingEl) {
    loadingEl.innerHTML = `
      <div class="space-y-3 p-4 animate-pulse">
        ${Array(4).fill(0).map(() => `
          <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
            <div class="h-12 w-12 bg-gray-200 rounded-full"></div>
            <div class="flex-1 space-y-2">
              <div class="h-3 bg-gray-200 rounded w-2/3"></div>
              <div class="h-2 bg-gray-200 rounded w-1/2"></div>
            </div>
          </div>
        `).join('')}
      </div>
    `;
    loadingEl.style.display = 'block';
  }
  if (emptyEl) emptyEl.style.display = 'none';
  if (listEl) {
    listEl.style.display = 'none';
    listEl.innerHTML = '';
  }

  try {
    const conversations = await fetchConversations(currentUser.uid);

    // Verberg loading
    if (loadingEl) loadingEl.style.display = 'none';

    if (conversations.length === 0) {
      // Toon empty state
      if (emptyEl) emptyEl.style.display = 'block';
    } else {
      // Toon conversaties
      await displayConversations(
        conversations,
        currentUser.uid,
        openConversation,
        viewUserProfile
      );
    }

    // Update unread badge
    updateUnreadBadge(conversations, currentUser.uid);

  } catch (error) {
    console.error("Error loading conversations:", error);
    const errorMessage = error.message || 'Error loading conversations. Please refresh the page.';

    if (loadingEl) {
      loadingEl.innerHTML = `
        <div class="text-center py-8">
          <p class="text-red-500">Error loading conversations. Please refresh the page.</p>
          <p class="text-sm text-gray-500 mt-2">${error.message}</p>
        </div>
      `;
    }

    // Show toast notification
    showErrorToast(errorMessage);
  }
}

/**
 * Opent de conversation detail view voor een specifieke conversatie
 * @param {string} conversationId - Conversation ID
 */
export async function openConversation(conversationId) {
  try {
    const currentUser = getStore('currentUser');

    if (!currentUser) {
      console.error("No user logged in");
      return;
    }

    // Haal conversatie data op
    const conversation = await fetchConversation(conversationId);

    if (!conversation) {
      console.error("Conversation not found:", conversationId);
      alert("Conversation not found.");
      return;
    }

    // Bepaal de andere participant
    const otherParticipantId = conversation.participants.find(id => id !== currentUser.uid);
    const otherParticipantName = conversation.participantNames[otherParticipantId] || 'Unknown';
    const otherParticipantRole = conversation.participantRoles[otherParticipantId] || '';

    // Show chat container and hide placeholder
    const chatPlaceholder = document.getElementById('chat-placeholder');
    const chatContainer = document.getElementById('chat-container');
    const chatHeader = document.getElementById('chat-header');

    // Get the chat area wrapper (parent of chatContainer)
    const chatAreaWrapper = chatContainer?.parentElement;

    // Hide conversation list on mobile when opening chat
    const conversationsList = document.querySelector('.md\\:w-1\\/3');
    if (conversationsList) {
      conversationsList.classList.add('hidden', 'md:block');
    }

    // Make chat area wrapper visible on mobile
    if (chatAreaWrapper) {
      chatAreaWrapper.classList.remove('hidden');
      chatAreaWrapper.classList.add('flex', 'w-full', 'md:w-2/3');
      chatAreaWrapper.style.display = 'flex';
    }

    if (chatPlaceholder) chatPlaceholder.style.display = 'none';
    if (chatContainer) {
      chatContainer.classList.remove('hidden');
      chatContainer.classList.add('flex');
      chatContainer.style.display = 'flex';
      // Store conversation ID for message form
      chatContainer.dataset.conversationId = conversationId;
    }

    // Update chat header with participant info (add back button for mobile)
    if (chatHeader) {
      chatHeader.innerHTML = `
        <div class="flex items-center">
          <button id="back-to-conversations-mobile" class="mr-3 md:hidden text-gray-600 hover:text-gray-900">
            <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
            </svg>
          </button>
          <div>
            <h3 class="text-lg font-semibold text-gray-900">${otherParticipantName}</h3>
            <p class="text-sm text-gray-500">${otherParticipantRole}</p>
            ${conversation.subject ? `<p class="text-sm text-gray-600 mt-1"><strong>Subject:</strong> ${conversation.subject}</p>` : ''}
          </div>
        </div>
      `;

      // Add event listener for mobile back button
      const backBtn = document.getElementById('back-to-conversations-mobile');
      if (backBtn) {
        backBtn.addEventListener('click', () => {
          // Hide chat area wrapper on mobile
          if (chatAreaWrapper) {
            chatAreaWrapper.classList.add('hidden', 'md:flex');
            chatAreaWrapper.classList.remove('flex', 'w-full');
            chatAreaWrapper.style.display = '';
          }
          // Hide chat container
          if (chatContainer) {
            chatContainer.classList.add('hidden');
            chatContainer.style.display = 'none';
          }
          // Show conversation list
          if (conversationsList) {
            conversationsList.classList.remove('hidden', 'md:block');
            conversationsList.classList.add('block');
          }
          // Show placeholder on desktop
          if (chatPlaceholder) {
            chatPlaceholder.style.display = '';
          }
        });
      }
    }

    // Markeer conversatie als gelezen
    await markConversationAsRead(conversationId, currentUser.uid);

    // Laad berichten
    await loadMessages(conversationId);

    // Activeer Lucide icons
    if (window.lucide) {
      window.lucide.createIcons();
    }

  } catch (error) {
    console.error("Error opening conversation:", error);
    alert("Could not open conversation: " + error.message);
  }
}

/**
 * Laadt alle berichten van een conversatie
 * @param {string} conversationId - Conversation ID
 */
export async function loadMessages(conversationId) {
  const messagesContainer = document.getElementById('messages-container');

  if (!messagesContainer) {
    console.error("Messages container not found");
    return;
  }

  // Show loading state
  messagesContainer.innerHTML = '<p class="text-center text-gray-500">Loading messages...</p>';

  try {
    const messages = await fetchMessages(conversationId);
    const currentUser = getStore('currentUser');

    if (!currentUser) {
      throw new Error('No user logged in');
    }

    // Display messages
    displayMessages(messages, currentUser.uid);

  } catch (error) {
    console.error("Error loading messages:", error);
    messagesContainer.innerHTML = `
      <div class="text-center py-8">
        <p class="text-red-500">Error loading messages. Please refresh the page.</p>
        <p class="text-sm text-gray-500 mt-2">${error.message}</p>
      </div>
    `;
  }
}

/**
 * Handle inline message form submit (for replying in existing conversations)
 * This is now called from global event delegation in ui.js
 * @param {Event} e - Form submit event
 */
async function handleInlineMessageSubmit(e) {
  e.preventDefault();

  const messageInput = document.getElementById('message-input');
  const messageText = messageInput.value.trim();

  if (!messageText) return;

  const chatContainer = document.getElementById('chat-container');
  const conversationId = chatContainer.dataset.conversationId;

  if (!conversationId) {
    console.error("No conversation ID found");
    return;
  }

  try {
    const currentUser = getStore('currentUser');
    const currentUserData = getStore('currentUserData');

    if (!currentUser || !currentUserData) {
      throw new Error('User not logged in');
    }

    // Send message
    await addMessage(conversationId, currentUser.uid, currentUserData, messageText);

    // Clear input
    messageInput.value = '';

    // Reload messages
    await loadMessages(conversationId);

    // Scroll to bottom
    scrollToBottom();

  } catch (error) {
    console.error("Error sending message:", error);
    alert("Failed to send message. Please try again.");
  }
}

/**
 * Bekijk het profiel van een gebruiker (programmer of artist)
 * @param {string} userId - User ID
 * @param {string} role - User role ('programmer' or 'artist')
 */
async function viewUserProfile(userId, role) {
  console.log("Viewing profile:", userId, role);

  try {
    if (role === 'programmer') {
      // Fetch programmer data
      const programmer = await fetchUserProfile(userId, 'programmer');

      if (!programmer) {
        alert('Programmer profile not found.');
        return;
      }

      // Display programmer profile modal
      showProgrammerProfileModal(programmer);

    } else if (role === 'artist') {
      // For artists, we can reuse the existing artist detail view
      const currentUserData = getStore('currentUserData');

      if (currentUserData && currentUserData.role === 'programmer') {
        // We're a programmer viewing an artist
        const artist = await fetchUserProfile(userId, 'artist');

        if (!artist) {
          alert('Artist profile not found.');
          return;
        }

        alert(`Artist Profile:\n\nName: ${artist.stageName || artist.firstName + ' ' + artist.lastName}\nLocation: ${artist.location}\nGenres: ${artist.genres?.join(', ')}\n\nClick on the artist in the search to see full profile.`);
      }
    }

  } catch (error) {
    console.error("Error viewing profile:", error);
    alert('Could not load profile: ' + error.message);
  }
}

/**
 * Setup real-time badge listener voor unread conversations
 * Deze functie moet worden aangeroepen na login
 */
export function setupBadgeListener() {
  const currentUser = getStore('currentUser');

  if (!currentUser) {
    console.log("No user logged in, skipping badge listener setup");
    return;
  }

  console.log("Setting up real-time badge listener for:", currentUser.uid);

  // Setup real-time listener
  badgeListenerUnsubscribe = setupConversationsListener(currentUser.uid, (conversations) => {
    // Update badge met unread count
    updateUnreadBadge(conversations, currentUser.uid);

    console.log(`Badge updated: ${conversations.filter(c => c.unreadBy && c.unreadBy.includes(currentUser.uid)).length} unread`);
  });

  return badgeListenerUnsubscribe;
}

/**
 * Stop de badge listener (bij logout)
 */
export function stopBadgeListener() {
  if (badgeListenerUnsubscribe) {
    badgeListenerUnsubscribe();
    badgeListenerUnsubscribe = null;
    console.log("Badge listener stopped");
  }
}

/**
 * Initialiseert de messaging event listeners
 */
export function setupMessaging() {
  // Close modal buttons
  const closeBtn = document.getElementById('close-message-modal');
  const cancelBtn = document.getElementById('cancel-message-btn');

  if (closeBtn) {
    closeBtn.addEventListener('click', closeMessageModal);
  }

  if (cancelBtn) {
    cancelBtn.addEventListener('click', closeMessageModal);
  }

  // Form submit
  const messageForm = document.getElementById('send-message-form');
  if (messageForm) {
    messageForm.addEventListener('submit', handleSendMessage);
  }

  // Note: Inline message form (message-form) is handled by global event delegation in ui.js
  // to avoid conflicts and duplicate listeners

  // Close modal when clicking outside
  const modal = document.getElementById('message-modal');
  if (modal) {
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        closeMessageModal();
      }
    });
  }

  console.log("Messaging listeners ingesteld.");
}

// Export the addMessage function for use in other modules (like recommendations.js)
export { addMessage } from './messaging-service.js';
export { appendMessageToUI } from './messaging-ui.js';

// Export sendRecommendationNotification for use in recommendations.js
export { sendRecommendationNotification } from './messaging-service.js';
</file>

<file path="src/modules/messaging/messaging-service.js">
/**
 * messaging-service.js
 * Firebase/Data Layer for Messaging
 * Handles all Firebase Firestore interactions for conversations and messages
 */

import { collection, addDoc, doc, setDoc, getDoc, serverTimestamp, query, where, getDocs, orderBy, onSnapshot } from "firebase/firestore";
import { db } from '../../services/firebase.js';

/**
 * Zoekt naar een bestaande conversatie tussen twee users
 * @param {string} userId1 - First user ID
 * @param {string} userId2 - Second user ID
 * @returns {Promise<object|null>} Conversation object or null
 */
export async function findExistingConversation(userId1, userId2) {
  try {
    const conversationsRef = collection(db, 'conversations');

    // Query voor conversaties waar beide users participants zijn
    const q = query(
      conversationsRef,
      where('participants', 'array-contains', userId1)
    );

    const querySnapshot = await getDocs(q);

    // Filter client-side voor de tweede participant
    let existingConv = null;
    querySnapshot.forEach((doc) => {
      const data = doc.data();
      if (data.participants.includes(userId2)) {
        existingConv = { id: doc.id, ...data };
      }
    });

    return existingConv;
  } catch (error) {
    console.error("Error finding existing conversation:", error);
    return null;
  }
}

/**
 * Maakt een nieuwe conversatie aan
 * @param {string} programmerId - Programmer user ID
 * @param {object} programmerData - Programmer data object
 * @param {object} artist - Artist object
 * @param {string} subject - Conversation subject
 * @returns {Promise<string>} Conversation ID
 */
export async function createConversation(programmerId, programmerData, artist, subject) {
  try {
    const artistId = artist.uid || artist.id;

    const conversationData = {
      participants: [programmerId, artistId],
      participantNames: {
        [programmerId]: `${programmerData.firstName} ${programmerData.lastName}`,
        [artistId]: artist.stageName || `${artist.firstName} ${artist.lastName}`
      },
      participantRoles: {
        [programmerId]: 'programmer',
        [artistId]: 'artist'
      },
      participantEmails: {
        [programmerId]: programmerData.email,
        [artistId]: artist.email
      },
      participantProfilePics: {
        [programmerId]: programmerData.profilePicUrl || '',
        [artistId]: artist.profilePicUrl || ''
      },
      subject: subject,
      lastMessage: '',
      lastMessageAt: serverTimestamp(),
      unreadBy: [artistId],
      createdAt: serverTimestamp()
    };

    const docRef = await addDoc(collection(db, 'conversations'), conversationData);
    return docRef.id;
  } catch (error) {
    console.error("Error creating conversation:", error);
    throw new Error("Failed to create conversation. Please try again.");
  }
}

/**
 * Voegt een bericht toe aan een conversatie
 * @param {string} conversationId - Conversation ID
 * @param {string} senderId - Sender user ID
 * @param {object} senderData - Sender data object
 * @param {string} messageText - Message text
 * @returns {Promise<void>}
 */
export async function addMessage(conversationId, senderId, senderData, messageText) {
  try {
    // 1. Voeg bericht toe aan messages subcollection
    const messageData = {
      senderId: senderId,
      senderName: `${senderData.firstName} ${senderData.lastName}`,
      senderRole: senderData.role,
      senderProfilePic: senderData.profilePicUrl || '',
      text: messageText,
      createdAt: serverTimestamp(),
      read: false
    };

    await addDoc(collection(db, `conversations/${conversationId}/messages`), messageData);

    // 2. Update de conversatie met laatste bericht info
    const conversationRef = doc(db, 'conversations', conversationId);
    const conversationSnap = await getDoc(conversationRef);
    const conversationData = conversationSnap.data();

    // Bepaal wie de ontvanger is (de andere participant)
    const receiverId = conversationData.participants.find(id => id !== senderId);

    await setDoc(conversationRef, {
      lastMessage: messageText.substring(0, 100),
      lastMessageAt: serverTimestamp(),
      unreadBy: [receiverId]
    }, { merge: true });
  } catch (error) {
    console.error("Error adding message:", error);
    throw new Error("Failed to send message. Please try again.");
  }
}

/**
 * Haalt alle conversaties op voor een specifieke gebruiker
 * @param {string} userId - User ID
 * @returns {Promise<Array>} Array of conversation objects
 */
export async function fetchConversations(userId) {
  try {
    const conversationsRef = collection(db, 'conversations');
    const q = query(
      conversationsRef,
      where('participants', 'array-contains', userId),
      orderBy('lastMessageAt', 'desc')
    );

    const querySnapshot = await getDocs(q);

    const conversations = [];
    querySnapshot.forEach((doc) => {
      conversations.push({ id: doc.id, ...doc.data() });
    });

    return conversations;
  } catch (error) {
    console.error("Error fetching conversations:", error);
    throw new Error("Failed to load conversations. Please refresh the page.");
  }
}

/**
 * Haalt alle berichten op van een conversatie
 * @param {string} conversationId - Conversation ID
 * @returns {Promise<Array>} Array of message objects
 */
export async function fetchMessages(conversationId) {
  try {
    const messagesRef = collection(db, `conversations/${conversationId}/messages`);
    const q = query(messagesRef, orderBy('createdAt', 'asc'));

    const querySnapshot = await getDocs(q);

    const messages = [];
    querySnapshot.forEach((doc) => {
      messages.push({ id: doc.id, ...doc.data() });
    });

    return messages;
  } catch (error) {
    console.error("Error fetching messages:", error);
    throw new Error("Failed to load messages. Please refresh the page.");
  }
}

/**
 * Haalt een specifieke conversatie op
 * @param {string} conversationId - Conversation ID
 * @returns {Promise<object|null>} Conversation object or null
 */
export async function fetchConversation(conversationId) {
  try {
    const conversationRef = doc(db, 'conversations', conversationId);
    const conversationSnap = await getDoc(conversationRef);

    if (!conversationSnap.exists()) {
      return null;
    }

    return { id: conversationSnap.id, ...conversationSnap.data() };
  } catch (error) {
    console.error("Error fetching conversation:", error);
    throw new Error("Failed to load conversation. Please refresh the page.");
  }
}

/**
 * Markeer conversatie als gelezen voor de huidige gebruiker
 * @param {string} conversationId - Conversation ID
 * @param {string} userId - User ID
 * @returns {Promise<void>}
 */
export async function markConversationAsRead(conversationId, userId) {
  try {
    const conversationRef = doc(db, 'conversations', conversationId);
    const conversationSnap = await getDoc(conversationRef);

    if (!conversationSnap.exists()) return;

    const conversationData = conversationSnap.data();
    const unreadBy = conversationData.unreadBy || [];

    // Als de gebruiker in de unreadBy lijst staat, verwijder hem
    if (unreadBy.includes(userId)) {
      const newUnreadBy = unreadBy.filter(id => id !== userId);

      await setDoc(conversationRef, {
        unreadBy: newUnreadBy
      }, { merge: true });
    }

  } catch (error) {
    console.error("Error marking conversation as read:", error);
  }
}

/**
 * Setup real-time listener voor conversations
 * @param {string} userId - User ID
 * @param {Function} callback - Callback function to call when conversations update
 * @returns {Function} Unsubscribe function
 */
export function setupConversationsListener(userId, callback) {
  const conversationsRef = collection(db, 'conversations');
  const q = query(
    conversationsRef,
    where('participants', 'array-contains', userId)
  );

  // Setup real-time listener
  const unsubscribe = onSnapshot(q, (querySnapshot) => {
    const conversations = [];
    querySnapshot.forEach((doc) => {
      conversations.push({ id: doc.id, ...doc.data() });
    });

    callback(conversations);
  }, (error) => {
    console.error("Error in conversations listener:", error);
  });

  return unsubscribe;
}

/**
 * Haalt user data op (programmer of artist)
 * @param {string} userId - User ID
 * @param {string} role - User role ('programmer' or 'artist')
 * @returns {Promise<object|null>} User data or null
 */
export async function fetchUserProfile(userId, role) {
  try {
    const collectionName = role === 'artist' ? 'artists' : 'programmers';
    const userDocRef = doc(db, collectionName, userId);
    const userDocSnap = await getDoc(userDocRef);

    if (!userDocSnap.exists()) {
      return null;
    }

    return { id: userDocSnap.id, ...userDocSnap.data() };
  } catch (error) {
    console.error("Error fetching user profile:", error);
    return null;
  }
}

/**
 * Send recommendation notification to artist
 * @param {string} artistId - Artist user ID
 * @param {string} artistEmail - Artist email
 * @param {string} artistName - Artist name
 * @param {string} programmerId - Programmer user ID
 * @param {object} programmerData - Programmer data
 * @param {string} recommendationText - The recommendation text
 * @returns {Promise<void>}
 */
export async function sendRecommendationNotification(artistId, artistEmail, artistName, programmerId, programmerData, recommendationText) {
  try {
    // Check if conversation exists
    const existingConversation = await findExistingConversation(programmerId, artistId);

    let conversationId;

    if (existingConversation) {
      conversationId = existingConversation.id;
    } else {
      // Create new conversation
      const conversationData = {
        participants: [programmerId, artistId],
        participantNames: {
          [programmerId]: `${programmerData.firstName} ${programmerData.lastName}`,
          [artistId]: artistName
        },
        participantRoles: {
          [programmerId]: 'programmer',
          [artistId]: 'artist'
        },
        participantEmails: {
          [programmerId]: programmerData.email,
          [artistId]: artistEmail
        },
        participantProfilePics: {
          [programmerId]: programmerData.profilePicUrl || '',
          [artistId]: ''
        },
        subject: 'üåü New Recommendation',
        lastMessage: '',
        lastMessageAt: serverTimestamp(),
        unreadBy: [artistId],
        createdAt: serverTimestamp()
      };

      const convRef = await addDoc(collection(db, 'conversations'), conversationData);
      conversationId = convRef.id;
    }

    // Send notification message
    const notificationText = `I've written a recommendation for you! Here's what I said:\n\n"${recommendationText}"\n\nYou can view all your recommendations in your artist dashboard.`;

    await addMessage(conversationId, programmerId, programmerData, notificationText);

  } catch (error) {
    console.error("Error sending recommendation notification:", error);
    throw error;
  }
}
</file>

<file path="src/modules/messaging/messaging-ui.js">
/**
 * messaging-ui.js
 * UI/Rendering Layer for Messaging
 * Handles all HTML generation and DOM manipulation for messaging views
 */

import { fetchUserProfile } from './messaging-service.js';

/**
 * Format timestamp naar "time ago" formaat
 * @param {Date} date - Date object
 * @returns {string} Formatted time ago string
 */
export function formatTimeAgo(date) {
  const now = new Date();
  const diffMs = now - date;
  const diffMins = Math.floor(diffMs / 60000);
  const diffHours = Math.floor(diffMs / 3600000);
  const diffDays = Math.floor(diffMs / 86400000);

  if (diffMins < 1) return 'Just now';
  if (diffMins < 60) return `${diffMins}m ago`;
  if (diffHours < 24) return `${diffHours}h ago`;
  if (diffDays < 7) return `${diffDays}d ago`;

  // Format as date if older than a week
  return date.toLocaleDateString('en-GB', { day: 'numeric', month: 'short' });
}

/**
 * Toont de lijst met conversaties
 * @param {Array} conversations - Array of conversation objects
 * @param {string} currentUserId - Current user ID
 * @param {Function} onConversationClick - Callback when conversation is clicked
 * @param {Function} onProfileClick - Callback when profile picture is clicked
 * @returns {Promise<void>}
 */
export async function displayConversations(conversations, currentUserId, onConversationClick, onProfileClick) {
  const listEl = document.getElementById('conversations-list');

  if (!listEl) return;

  listEl.innerHTML = '';
  listEl.style.display = 'block';

  // Fetch profile pictures for all participants
  const conversationsWithPics = await Promise.all(conversations.map(async (conversation) => {
    // Bepaal de andere participant
    const otherParticipantId = conversation.participants.find(id => id !== currentUserId);
    const otherParticipantRole = conversation.participantRoles[otherParticipantId] || '';

    // Fetch profile picture
    let profilePic = conversation.participantProfilePics?.[otherParticipantId] || '';

    // If not in conversation data, fetch from user's profile
    if (!profilePic) {
      const userData = await fetchUserProfile(otherParticipantId, otherParticipantRole);
      if (userData) {
        profilePic = userData.profilePicUrl || '';
      }
    }

    return {
      ...conversation,
      otherParticipantId,
      otherParticipantRole,
      otherParticipantPic: profilePic
    };
  }));

  // Now display all conversations with their profile pictures
  conversationsWithPics.forEach(conversation => {
    const otherParticipantName = conversation.participantNames[conversation.otherParticipantId] || 'Unknown';

    // Use fetched profile picture with fallback
    const profilePic = conversation.otherParticipantPic ||
                       'https://placehold.co/80x80/e0e7ff/6366f1?text=' +
                       encodeURIComponent(otherParticipantName.charAt(0));

    // Check of dit bericht unread is
    const isUnread = conversation.unreadBy && conversation.unreadBy.includes(currentUserId);

    // Format timestamp
    let timeAgo = 'Just now';
    if (conversation.lastMessageAt && conversation.lastMessageAt.toDate) {
      const date = conversation.lastMessageAt.toDate();
      timeAgo = formatTimeAgo(date);
    }

    // Maak conversation card
    const conversationCard = document.createElement('div');
    conversationCard.className = `border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition ${isUnread ? 'bg-indigo-50 border-indigo-300' : ''}`;
    conversationCard.dataset.conversationId = conversation.id;
    conversationCard.dataset.otherParticipantId = conversation.otherParticipantId;
    conversationCard.dataset.otherParticipantRole = conversation.otherParticipantRole;

    // Profile Picture with Hover Effect
    conversationCard.innerHTML = `
      <div class="flex items-start space-x-4">
        <!-- Profile Picture with Hover Effect -->
        <div class="relative group flex-shrink-0">
          <img src="${profilePic}"
               alt="${otherParticipantName}"
               class="h-16 w-16 rounded-full object-cover border-2 ${isUnread ? 'border-indigo-300' : 'border-gray-200'} cursor-pointer hover:border-indigo-500 transition-all duration-200 hover:shadow-lg transform hover:scale-105"
               data-view-profile="${conversation.otherParticipantId}"
               data-profile-role="${conversation.otherParticipantRole}">

          <!-- Hover Tooltip (Subtle & Smaller) -->
          <div class="absolute -bottom-2 left-1/2 transform -translate-x-1/2 translate-y-full opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-10">
            <div class="bg-gray-800 text-white text-xs px-2 py-1 rounded shadow-md whitespace-nowrap mt-1">
              <svg class="inline-block h-2.5 w-2.5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
              </svg>
              View profile
            </div>
          </div>

          <!-- Click indicator icon (Smaller & More Subtle) -->
          <div class="absolute bottom-0 right-0 h-4 w-4 bg-indigo-500 rounded-full flex items-center justify-center shadow-sm opacity-0 group-hover:opacity-90 transition-opacity duration-200">
            <svg class="h-2 w-2 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M9 5l7 7-7 7"/>
            </svg>
          </div>
        </div>

        <!-- Conversation Info -->
        <div class="flex-1 min-w-0">
          <div class="flex items-center mb-1">
            <h3 class="text-lg font-semibold ${isUnread ? 'text-indigo-900' : 'text-gray-900'} truncate">${otherParticipantName}</h3>
            ${isUnread ? '<span class="ml-2 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-bold bg-red-500 text-white flex-shrink-0">New</span>' : ''}
            <span class="ml-2 text-sm text-gray-500 capitalize flex-shrink-0">${conversation.otherParticipantRole}</span>
          </div>
          <p class="text-sm text-gray-700 mb-1"><strong>Subject:</strong> ${conversation.subject || 'No subject'}</p>
          <p class="text-sm text-gray-600 line-clamp-2">${conversation.lastMessage || 'No messages yet'}</p>
        </div>

        <!-- Timestamp & Status -->
        <div class="text-right flex-shrink-0">
          <p class="text-xs text-gray-500 whitespace-nowrap">${timeAgo}</p>
          ${isUnread ? '<div class="mt-2"><i data-lucide="mail" class="h-5 w-5 text-indigo-600"></i></div>' : ''}
        </div>
      </div>
    `;

    // Click handler om conversatie te openen OF profiel te bekijken
    conversationCard.addEventListener('click', (e) => {
      // Check if clicked on profile picture
      if (e.target.hasAttribute('data-view-profile')) {
        e.stopPropagation();
        const userId = e.target.getAttribute('data-view-profile');
        const role = e.target.getAttribute('data-profile-role');
        onProfileClick(userId, role);
      } else {
        onConversationClick(conversation.id);
      }
    });

    listEl.appendChild(conversationCard);
  });

  // Activeer Lucide icons
  if (window.lucide) {
    window.lucide.createIcons();
  }
}

/**
 * Toont de lijst met berichten
 * @param {Array} messages - Array of message objects
 * @param {string} currentUserId - Current user ID
 * @returns {void}
 */
export function displayMessages(messages, currentUserId) {
  const messagesContainer = document.getElementById('messages-container');

  if (!messagesContainer) return;

  messagesContainer.innerHTML = '';

  if (messages.length === 0) {
    messagesContainer.innerHTML = '<p class="text-gray-500 text-center py-4">No messages yet.</p>';
  } else {
    messages.forEach(message => {
      const isOwnMessage = message.senderId === currentUserId;

      // Format timestamp
      let timeAgo = 'Just now';
      if (message.createdAt && message.createdAt.toDate) {
        const date = message.createdAt.toDate();
        timeAgo = formatTimeAgo(date);
      }

      // Get profile picture with proper fallback
      const profilePic = message.senderProfilePic ||
                        'https://placehold.co/48x48/e0e7ff/6366f1?text=' +
                        encodeURIComponent(message.senderName?.charAt(0) || '?');

      // Create message bubble
      const messageDiv = document.createElement('div');
      messageDiv.className = `flex items-start space-x-3 mb-4 ${isOwnMessage ? 'flex-row-reverse space-x-reverse' : ''}`;

      messageDiv.innerHTML = `
        <div class="flex-shrink-0">
          <img src="${profilePic}"
               alt="${message.senderName}"
               class="h-10 w-10 rounded-full object-cover">
        </div>

        <div class="max-w-xl ${isOwnMessage ? 'bg-indigo-100' : 'bg-gray-100'} rounded-lg p-4 shadow-sm">
          <div class="flex items-center mb-2">
            <span class="font-semibold text-sm ${isOwnMessage ? 'text-indigo-900' : 'text-gray-900'}">${message.senderName}</span>
            <span class="text-xs text-gray-500 ml-2 capitalize">${message.senderRole || ''}</span>
          </div>
          <p class="text-gray-800 whitespace-pre-wrap">${message.text}</p>
          <p class="text-xs text-gray-500 mt-2">${timeAgo}</p>
        </div>
      `;

      messagesContainer.appendChild(messageDiv);
    });
  }

  // Scroll to latest message with smooth behavior
  setTimeout(() => {
    messagesContainer.scrollTo({
      top: messagesContainer.scrollHeight,
      behavior: 'smooth'
    });
  }, 100);
}

/**
 * Append a single message to the UI immediately (optimistic UI)
 * @param {object} message - Message object
 * @param {string} currentUserId - Current user ID
 * @returns {void}
 */
export function appendMessageToUI(message, currentUserId) {
  const messagesContainer = document.getElementById('messages-container');

  if (!messagesContainer) return;

  // Remove "no messages" placeholder if it exists
  const placeholder = messagesContainer.querySelector('p.text-gray-500');
  if (placeholder) {
    placeholder.remove();
  }

  const isOwnMessage = message.senderId === currentUserId;

  // Format timestamp
  let timeAgo = 'Just now';
  if (message.createdAt && message.createdAt.toDate) {
    const date = message.createdAt.toDate();
    timeAgo = formatTimeAgo(date);
  }

  // Get profile picture with proper fallback
  const profilePic = message.senderProfilePic ||
                    'https://placehold.co/48x48/e0e7ff/6366f1?text=' +
                    encodeURIComponent(message.senderName?.charAt(0) || '?');

  // Create message bubble
  const messageDiv = document.createElement('div');
  messageDiv.className = `flex items-start space-x-3 mb-4 ${isOwnMessage ? 'flex-row-reverse space-x-reverse' : ''}`;

  messageDiv.innerHTML = `
    <div class="flex-shrink-0">
      <img src="${profilePic}"
           alt="${message.senderName}"
           class="h-10 w-10 rounded-full object-cover">
    </div>

    <div class="max-w-xl ${isOwnMessage ? 'bg-indigo-100' : 'bg-gray-100'} rounded-lg p-4 shadow-sm">
      <div class="flex items-center mb-2">
        <span class="font-semibold text-sm ${isOwnMessage ? 'text-indigo-900' : 'text-gray-900'}">${message.senderName}</span>
        <span class="text-xs text-gray-500 ml-2 capitalize">${message.senderRole || ''}</span>
      </div>
      <p class="text-gray-800 whitespace-pre-wrap">${message.text}</p>
      <p class="text-xs text-gray-500 mt-2">${timeAgo}</p>
    </div>
  `;

  // Append message
  messagesContainer.appendChild(messageDiv);

  // Smooth scroll to the new message (keep focus on message + input field)
  // Use requestAnimationFrame for better scroll performance
  requestAnimationFrame(() => {
    messagesContainer.scrollTo({
      top: messagesContainer.scrollHeight,
      behavior: 'smooth'
    });

    // Keep focus on input field after sending
    const messageInput = document.getElementById('message-input');
    if (messageInput) {
      messageInput.focus();
    }
  });
}

/**
 * Update all unread badges in navigation (desktop, mobile, legacy)
 * @param {Array} conversations - Array of conversation objects
 * @param {string} currentUserId - Current user ID
 * @returns {void}
 */
export function updateUnreadBadge(conversations, currentUserId) {
  // Get all badge elements
  const badgeDesktop = document.getElementById('messages-badge-desktop');
  const badgeMobile = document.getElementById('messages-badge-mobile');
  const badgeLegacy = document.getElementById('messages-badge'); // Legacy badge

  // Tel unread conversaties
  const unreadCount = conversations.filter(conv =>
    conv.unreadBy && conv.unreadBy.includes(currentUserId)
  ).length;

  console.log(`[MESSAGING] Updating badges: ${unreadCount} unread conversations`);

  // Update desktop badge
  if (badgeDesktop) {
    if (unreadCount > 0) {
      badgeDesktop.textContent = unreadCount;
      badgeDesktop.classList.remove('hidden');
    } else {
      badgeDesktop.classList.add('hidden');
    }
  }

  // Update mobile badge
  if (badgeMobile) {
    if (unreadCount > 0) {
      badgeMobile.textContent = unreadCount;
      badgeMobile.classList.remove('hidden');
    } else {
      badgeMobile.classList.add('hidden');
    }
  }

  // Update legacy badge (if it exists)
  if (badgeLegacy) {
    if (unreadCount > 0) {
      badgeLegacy.textContent = unreadCount;
      badgeLegacy.classList.remove('hidden');
    } else {
      badgeLegacy.classList.add('hidden');
    }
  }
}

/**
 * Scroll to bottom of messages container
 * @returns {void}
 */
export function scrollToBottom() {
  const messagesContainer = document.getElementById('messages-container');
  if (messagesContainer) {
    setTimeout(() => {
      messagesContainer.scrollTo({
        top: messagesContainer.scrollHeight,
        behavior: 'smooth'
      });
    }, 100);
  }
}

/**
 * Toon programmer profiel in een modal
 * @param {object} programmer - Programmer data object
 * @returns {void}
 */
export function showProgrammerProfileModal(programmer) {
  // Create modal element
  const modal = document.createElement('div');
  modal.id = 'programmer-profile-modal';
  modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';

  const profilePic = programmer.profilePicUrl ||
                     'https://placehold.co/200x200/e0e7ff/6366f1?text=' +
                     encodeURIComponent((programmer.firstName || 'P').charAt(0));

  modal.innerHTML = `
    <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
      <div class="p-6">
        <!-- Header -->
        <div class="flex items-start justify-between mb-6">
          <h2 class="text-2xl font-bold text-gray-900">Programmer Profile</h2>
          <button id="close-programmer-modal" class="text-gray-400 hover:text-gray-600">
            <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>

        <!-- Profile Content -->
        <div class="space-y-6">
          <!-- Profile Picture & Basic Info -->
          <div class="flex items-start space-x-6">
            <img src="${profilePic}"
                 alt="${programmer.firstName}"
                 class="h-32 w-32 rounded-full object-cover flex-shrink-0">
            <div class="flex-1">
              <h3 class="text-xl font-semibold text-gray-900 mb-1">
                ${programmer.firstName} ${programmer.lastName}
              </h3>
              <p class="text-indigo-600 font-medium mb-2">${programmer.organizationName || 'Organization'}</p>
              <div class="space-y-1 text-sm text-gray-600">
                <div class="flex items-center">
                  <svg class="h-4 w-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                  </svg>
                  ${programmer.email || 'No email'}
                </div>
                ${programmer.phone ? `
                  <div class="flex items-center">
                    <svg class="h-4 w-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                    </svg>
                    ${programmer.phone}
                  </div>
                ` : ''}
                ${programmer.website ? `
                  <div class="flex items-center">
                    <svg class="h-4 w-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"/>
                    </svg>
                    <a href="${programmer.website}" target="_blank" class="text-indigo-600 hover:text-indigo-800">
                      ${programmer.website}
                    </a>
                  </div>
                ` : ''}
              </div>
            </div>
          </div>

          <!-- About Organization -->
          ${programmer.organizationAbout ? `
            <div>
              <h4 class="text-lg font-semibold text-gray-900 mb-2">About the Organization</h4>
              <p class="text-gray-700 whitespace-pre-wrap">${programmer.organizationAbout}</p>
            </div>
          ` : ''}

          <!-- Status Badge -->
          <div class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${
            programmer.status === 'pro' ? 'bg-green-100 text-green-800' :
            programmer.status === 'trial' ? 'bg-yellow-100 text-yellow-800' :
            'bg-gray-100 text-gray-800'
          }">
            ${programmer.status === 'pro' ? '‚úì Pro Member' :
              programmer.status === 'trial' ? 'Trial Member' :
              'Pending Approval'}
          </div>
        </div>
      </div>
    </div>
  `;

  // Add to page
  document.body.appendChild(modal);

  // DOM race condition guard - check element exists before adding listener
  const closeBtn = document.getElementById('close-programmer-modal');
  if (closeBtn) {
    closeBtn.addEventListener('click', () => {
      modal.remove();
    });
  } else {
    console.warn('[MESSAGING] close-programmer-modal element not found in modal');
  }

  // Click outside to close
  modal.addEventListener('click', (e) => {
    if (e.target === modal) {
      modal.remove();
    }
  });
}
</file>

<file path="firestore.indexes.json">
{
  "indexes": [
    {
      "collectionGroup": "conversations",
      "queryScope": "COLLECTION",
      "fields": [
        {
          "fieldPath": "participants",
          "arrayConfig": "CONTAINS"
        },
        {
          "fieldPath": "lastMessageAt",
          "order": "DESCENDING"
        },
        {
          "fieldPath": "__name__",
          "order": "DESCENDING"
        }
      ],
      "density": "SPARSE_ALL"
    },
    {
      "collectionGroup": "recommendations",
      "queryScope": "COLLECTION",
      "fields": [
        {
          "fieldPath": "artistId",
          "order": "ASCENDING"
        },
        {
          "fieldPath": "isApproved",
          "order": "ASCENDING"
        },
        {
          "fieldPath": "createdAt",
          "order": "DESCENDING"
        },
        {
          "fieldPath": "__name__",
          "order": "DESCENDING"
        }
      ],
      "density": "SPARSE_ALL"
    }
  ],
  "fieldOverrides": []
}
</file>

<file path="firebase.json">
{
  "firestore": {
    "rules": "firestore.rules",
    "indexes": "firestore.indexes.json"
  },
  "functions": [
    {
      "source": "functions",
      "codebase": "default",
      "ignore": [
        "node_modules",
        ".git",
        "firebase-debug.log",
        "firebase-debug.*.log",
        "*.local"
      ]
    }
  ],
  "hosting": {
    "public": "dist",
    "ignore": [
      "firebase.json",
      "**/.*",
      "**/node_modules/**"
    ],
    "rewrites": [
      {
        "source": "**",
        "destination": "/index.html"
      }
    ],
    "headers": [
      {
        "source": "**/*.@(jpg|jpeg|gif|png|svg|webp)",
        "headers": [
          {
            "key": "Cache-Control",
            "value": "max-age=31536000"
          }
        ]
      },
      {
        "source": "**/*.@(js|css)",
        "headers": [
          {
            "key": "Cache-Control",
            "value": "max-age=31536000"
          }
        ]
      }
    ]
  },
  "storage": {
    "rules": "storage.rules"
  }
}
</file>

<file path=".gitignore">
# Dependencies
node_modules/
.npm/

# Build output
dist/
build/
.output/

# Firebase
.firebase/
.firebaserc
firebase-debug.log
firebase-debug.*.log
ui-debug.log
database-debug.log
firestore-debug.log
pubsub-debug.log

# Service Account Keys (BELANGRIJK!)
serviceAccountKey.json
*-firebase-adminsdk-*.json
serviceAccountKey*.json
.env*.local

# Environment variables
.env
.env.production
.env.staging
.env.local
.env.*.local

# IDE
.vscode/
.idea/
*.swp
*.swo
*~

# OS
.DS_Store
Thumbs.db

# Logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# Temporary files
*.tmp
.cache/deploy.js
.env
deploy.js
.aider*
</file>

<file path="package.json">
{
  "name": "spoken-word-database",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "build:staging": "node scripts/validate-env.cjs staging && vite build --mode staging",
    "build:prod": "node scripts/validate-env.cjs production && vite build --mode production",
    "preview": "vite preview",
    "deploy": "npm run build && node deploy.js",
    
    "// --- NIEUWE VEILIGHEIDS SCRIPTS ---": "",
    "check:staging": "if grep -q 'VITE_APP_ENV=staging' .env.staging; then echo '‚úÖ Environment is Staging'; else echo '‚ùå FOUT: Verkeerde env file!'; exit 1; fi",
    "check:prod": "if grep -q 'VITE_APP_ENV=production' .env.production; then echo '‚úÖ Environment is Production'; else echo '‚ùå FOUT: Verkeerde env file!'; exit 1; fi",
    
    "// --- AUTOMATED DEPLOYMENT (Bespaart AI Tokens) ---": "",
    "release:staging": "npm run check:staging && npm run build:staging && firebase deploy --only hosting --project ddd-spark",
    "release:prod": "npm run check:prod && npm run build:prod && firebase deploy --only hosting --project dans-dichter-db"
  },
  "devDependencies": {
    "autoprefixer": "^10.4.19",
    "ftp": "^0.3.10",
    "ftp-deploy": "^2.4.7",
    "postcss": "^8.4.38",
    "tailwindcss": "^3.4.4",
    "vite": "^5.0.0"
  },
  "dependencies": {
    "firebase": "^10.7.0",
    "firebase-admin": "^13.5.0"
  }
}
</file>

<file path=".github/workflows/deploy.yml">
name: Deploy to Firebase Hosting

on:
  push:
    branches:
      - main

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest
    steps:
      # Stap 1: Haal de code op uit je GitHub repo
      - name: Check out code
        uses: actions/checkout@v4

      # Stap 2: Setup Node.js (Nodig voor de build-stap)
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20' # Of '18' als je dat liever hebt
          cache: 'npm'

      # Stap 3: Installeer de dependencies
      - name: Install dependencies
        run: npm ci

      # Stap 4: Bouw het project (dit maakt de 'dist' map aan)
      - name: Build project
        run: npm run build

      # Stap 5: Publiceer naar Firebase
      - name: Deploy to Firebase Hosting
        uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: ${{ secrets.GITHUB_TOKEN }}
          firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT }}
          projectId: dans-dichter-db
          channelId: live
</file>

<file path="main.js">
/**
 * main.js
 * Dit is het HOOFD startpunt van de applicatie.
 * Het importeert alle modules en start de app.
 */

// Global error handler for uncaught errors
window.addEventListener('error', (event) => {
  console.error('‚ùå GLOBAL ERROR:', event.error);
  const loadingView = document.getElementById('loading-view');
  if (loadingView && loadingView.style.display !== 'none') {
    loadingView.innerHTML = `
      <div class="text-center text-red-500 p-8 max-w-lg mx-auto bg-white shadow-lg rounded-lg">
        <h1 class="text-2xl font-bold mb-4">Application Error</h1>
        <p class="mb-4">Er is een fout opgetreden bij het laden van de applicatie.</p>
        <p class="text-sm font-mono bg-red-100 p-3 rounded break-all mb-4">${event.error?.message || event.message}</p>
        <button onclick="location.reload()" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">
          Probeer opnieuw
        </button>
      </div>
    `;
    loadingView.style.display = 'block';
  }
});

// Global promise rejection handler
window.addEventListener('unhandledrejection', (event) => {
  console.error('‚ùå UNHANDLED PROMISE REJECTION:', event.reason);
});

// Importeer de initialisatie-functies van onze modules
import { monitorAuthState } from './src/services/auth.js';
import { initNavigation, setupGlobalFormHandlers, showPage, showDashboard, showMessages, showAccountSettings, showProgrammerSettings } from './src/ui/ui.js';
import { getStore } from './src/utils/store.js';
import { setupProgrammerProfile } from './src/modules/programmer/programmer-profile.js';
// ‚úÖ setupArtistSearch moved to ui.js (imported there)
import { setupMessaging } from './src/modules/messaging/messaging-controller.js';
import { initTranslations } from './src/utils/translations.js';
import { setupRecommendations } from './src/modules/recommendations/recommendations.js';
import { setupUserSettings } from './src/modules/settings/user-settings.js';
import { renderDesktopNav, renderMobileNav } from './src/modules/navigation/navigation.js';

/**
 * initApp
 * De hoofdfunctie die de hele applicatie initialiseert.
 */
function initApp() {
  try {
    console.log("=".repeat(60));
    console.log("üöÄ Starting application initialization...");
    console.log("=".repeat(60));

    // Setup global form handlers first (before any UI rendering)
    // This ensures login/signup forms work regardless of when they're rendered
    setupGlobalFormHandlers();

    // Initialize translations (default to Dutch)
    initTranslations();

    // Render navigation components (will be hidden until user logs in)
    renderDesktopNav();
    renderMobileNav();

    // Stel de navigatieknoppen in (Login, Home, etc.)
    initNavigation();

    // Stel de listener in die kijkt of we in- of uitgelogd zijn
    // Deze verbergt ook de lader en toont de homepagina
    monitorAuthState();

    // Stel de listeners in voor het programmeurs-profiel (edit profile)
    setupProgrammerProfile();

    // ‚úÖ FIX: setupArtistSearch() moved to ui.js after renderArtistSearch()
    // This ensures event listeners attach after HTML is rendered

    // Stel de messaging listeners in (send message button, modal)
    setupMessaging();

    // Stel de recommendations listeners in (modal, form)
    setupRecommendations();

    // Stel de user settings listeners in (modal, language, email, password)
    setupUserSettings();

    // Setup browser back/forward button handler
    setupBrowserNavigation();

    console.log("=".repeat(60));
    console.log("‚úÖ Application initialization complete!");
    console.log("=".repeat(60));

  } catch (error) {
    console.error("Fout bij initialiseren van de app:", error);
    // Toon een fatale foutmelding aan de gebruiker
    const loadingView = document.getElementById('loading-view');
    if (loadingView) {
      loadingView.style.display = 'block'; // Zorg dat de lader zichtbaar is
      loadingView.innerHTML = `
        <div class="text-center text-red-500 p-8 max-w-lg mx-auto bg-white shadow-lg rounded-lg">
            <h1 class="text-2xl font-bold mb-4">Fatale Fout</h1>
            <p>Kon de applicatie niet laden. Probeer het later opnieuw.</p>
            <p class="mt-4 text-sm font-mono bg-red-100 p-2 rounded break-all">${error.message}</p>
        </div>
      `;
    }
  }
}

/**
 * Setup browser navigation (back/forward buttons)
 * Handles URL hash changes and browser history
 */
function setupBrowserNavigation() {
  // Handle browser back/forward buttons
  window.addEventListener('popstate', (event) => {
    console.log('[BROWSER NAV] Popstate event triggered:', event.state);

    const currentUser = getStore('currentUser');
    const hash = window.location.hash.replace('#', '');

    // Auth guard: redirect to login if not authenticated
    const protectedRoutes = ['profile', 'messages', 'account-settings', 'profile-settings', 'dashboard'];
    if (protectedRoutes.includes(hash) && !currentUser) {
      console.warn('[BROWSER NAV] Protected route accessed without auth, redirecting to home');
      showPage('home-view', false);
      return;
    }

    // Route based on hash
    switch(hash) {
      case 'profile':
      case 'dashboard':
        showDashboard();
        break;
      case 'messages':
        showMessages();
        break;
      case 'account-settings':
        showAccountSettings();
        break;
      case 'profile-settings':
        showProgrammerSettings();
        break;
      case 'login':
        showPage('login-view', false);
        break;
      case 'signup':
        showPage('signup-view', false);
        break;
      case 'home':
      case '':
        showPage('home-view', false);
        break;
      default:
        console.warn('[BROWSER NAV] Unknown route:', hash);
        showPage('home-view', false);
    }
  });

  // Handle initial hash on page load
  const initialHash = window.location.hash.replace('#', '');
  if (initialHash) {
    console.log('[BROWSER NAV] Initial hash detected:', initialHash);
    // Let monitorAuthState handle the initial routing
  }

  console.log('[BROWSER NAV] Browser navigation setup complete');
}

// Start de applicatie zodra de HTML-pagina is geladen
document.addEventListener('DOMContentLoaded', initApp);
</file>

<file path="index.html">
<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Spoken Word Platform</title>

    <!-- Apple-inspired System Font Stack -->
    <style>
        :root {
            --app-max-width: 1536px; /* Extra wide for desktop grid (was 1280px) */
            --primary-color: #6366f1; /* Indigo */
            --bg-color: #F2F2F7; /* iOS Gray */
            --text-primary: #000000;
            --text-secondary: #8E8E93;
            --nav-height: 72px;
        }

        * {
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "SF Pro Text", "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Mobile Container */
        #app-container {
            max-width: var(--app-max-width);
            margin: 0 auto;
            min-height: 100vh;
            background: white;
            position: relative;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.08);
            overflow-x: hidden;
        }

        @media (min-width: 481px) {
            body {
                background: var(--bg-color);
                padding: 20px 0;
            }
        }

        /* Desktop Container Padding */
        @media (min-width: 768px) {
            #app-container {
                padding: 0 1.5rem;
            }
        }

        /* Extra Wide for Large Screens */
        @media (min-width: 1280px) {
            #app-container {
                padding: 0 3rem;
            }
        }

        /* Glassmorphism Bottom Nav (Mobile Only) */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            max-width: var(--app-max-width);
            width: 100%;
            height: var(--nav-height);
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border-top: 0.5px solid rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 20px;
            z-index: 1000;
            safe-area-inset-bottom: env(safe-area-inset-bottom);
        }

        /* Hide bottom nav on desktop (>= 768px) */
        @media (min-width: 768px) {
            .bottom-nav {
                display: none !important;
            }
        }

        .bottom-nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.2s;
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            user-select: none;
        }

        .bottom-nav-item:active {
            transform: scale(0.95);
            background: rgba(0, 0, 0, 0.05);
        }

        .bottom-nav-item.active {
            color: var(--primary-color);
        }

        .bottom-nav-icon {
            width: 24px;
            height: 24px;
            margin-bottom: 4px;
        }

        .bottom-nav-label {
            font-size: 10px;
            font-weight: 500;
            letter-spacing: -0.2px;
        }

        /* Content padding for bottom nav */
        .content-wrapper {
            padding-bottom: calc(var(--nav-height) + 20px);
        }

        /* Button Press Effect */
        .btn-press {
            transition: transform 0.1s ease;
        }

        .btn-press:active {
            transform: scale(0.95);
        }

        /* Badge for notifications - positioned at top-right of icon */
        .notification-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background: #FF3B30;
            color: white;
            font-size: 10px;
            font-weight: 700;
            min-width: 18px;
            height: 18px;
            border-radius: 9px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 4px;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
        }

        /* Hide default scrollbar but keep functionality */
        * {
            scrollbar-width: thin;
            scrollbar-color: rgba(0, 0, 0, 0.2) transparent;
        }

        *::-webkit-scrollbar {
            width: 4px;
        }

        *::-webkit-scrollbar-track {
            background: transparent;
        }

        *::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 2px;
        }

        /* Responsive Modal Behavior */
        /* Mobile (< 768px): Bottom Sheet */
        @media (max-width: 767px) {
            .profile-modal {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                max-height: 90vh;
                border-radius: 1.5rem 1.5rem 0 0;
                transform: translateY(100%);
                transition: transform 0.3s ease-out;
                overflow-y: auto;
            }

            .profile-modal.active {
                transform: translateY(0);
            }
        }

        /* Desktop (>= 768px): Centered Modal */
        @media (min-width: 768px) {
            .profile-modal {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                max-width: 800px;
                width: 90%;
                max-height: 90vh;
                border-radius: 1rem;
                overflow-y: auto;
            }

            .profile-modal.active {
                /* No animation needed on desktop */
                display: block;
            }
        }

        /* Search Module - Pill Filters (Mobile) */
        .pill {
            padding: 0.5rem 1rem;
            background-color: #f3f4f6;
            color: #374151;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
            white-space: nowrap;
            transition: background-color 0.2s;
            border: none;
            cursor: pointer;
        }

        .pill:hover {
            background-color: #e5e7eb;
        }

        .pill-active {
            padding: 0.5rem 1rem;
            background-color: #e0e7ff;
            color: #4f46e5;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
            white-space: nowrap;
            border: none;
            cursor: pointer;
        }

        /* Mobile Filter Menu Slide-in */
        .mobile-filter-menu-open {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top-left-radius: 1rem;
            border-top-right-radius: 1rem;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
            z-index: 50;
            padding: 1.5rem;
            max-height: 70vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
            }
            to {
                transform: translateY(0);
            }
        }

        /* Hide scrollbar for mobile pills container */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Mobile Filter Bar - Horizontal Slide */
        #mobile-filter-bar {
            transition: transform 0.3s ease-out;
        }
    </style>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>

    <!-- Tailwind CSS -->
    <link rel="stylesheet" href="/style.css">
</head>

<body class="bg-gray-50 text-gray-900 antialiased overflow-x-hidden">

    <!-- Main App Container -->
    <div id="app-container">

        <!-- Desktop Navigation Container (rendered by navigation.js) -->
        <div id="desktop-nav-container" class="hidden md:block"></div>

        <!-- App Header (only shown when logged in on mobile) -->
        <header id="app-header" class="md:hidden bg-white border-b border-gray-200 px-6 py-4 sticky top-0 z-40">
            <div class="flex items-center justify-between">
                <h1 class="text-lg font-bold text-gray-900 tracking-tight">SPOKEN WORD PLATFORM</h1>
                <button id="nav-logout-mobile" class="text-red-500 text-sm font-semibold px-3 py-1.5 rounded-lg hover:bg-red-50 transition-colors">
                    Logout
                </button>
            </div>
        </header>

        <!-- Content Wrapper -->
        <div class="content-wrapper">

            <!-- Loading View (shown during initial app load) -->
            <div id="loading-view" class="fixed inset-0 bg-white flex justify-center items-center z-50">
                <div class="text-center">
                    <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mb-4"></div>
                    <p class="text-gray-600 font-medium">Loading...</p>
                </div>
            </div>

            <!-- Main App Content Container - all views rendered here dynamically -->
            <main id="app-content" class="min-h-screen"></main>

        </div>

        <!-- Mobile Navigation Container (rendered by navigation.js) -->
        <div id="mobile-nav-container" class="hidden"></div>

    </div>

    <!-- Modals (keep existing modals) -->

    <!-- Recommendation Modal -->
    <div id="recommendation-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl shadow-xl max-w-md w-full">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold">Schrijf Aanbeveling</h3>
                    <button id="close-recommendation-modal" class="text-gray-400 hover:text-gray-600">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                <p id="recommendation-artist-name" class="text-base text-indigo-600 font-semibold mt-2">Artist Name</p>
            </div>

            <form id="recommendation-form" class="p-6 space-y-4">
                <div>
                    <label for="recommendation-text" class="block text-sm font-semibold text-gray-700 mb-2">Je Aanbeveling</label>
                    <textarea
                        id="recommendation-text"
                        rows="6"
                        required
                        minlength="10"
                        class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="Deel je positieve ervaring met deze artiest..."></textarea>
                    <p class="mt-1 text-xs text-gray-500">Minimum 10 karakters.</p>
                </div>

                <div id="recommendation-error" class="hidden p-3 bg-red-100 text-red-700 rounded-xl text-sm"></div>
                <div id="recommendation-success" class="hidden p-3 bg-green-100 text-green-700 rounded-xl text-sm"></div>

                <div class="flex justify-end space-x-3">
                    <button type="button" id="cancel-recommendation-btn" class="btn-press px-4 py-2 bg-gray-100 rounded-xl text-gray-700 hover:bg-gray-200 font-medium">
                        Annuleren
                    </button>
                    <button type="submit" class="btn-press px-6 py-2 bg-indigo-600 text-white rounded-xl font-semibold hover:bg-indigo-700">
                        Versturen
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Message Modal -->
    <div id="message-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl shadow-xl max-w-md w-full">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold">Verstuur Bericht</h3>
                    <button id="close-message-modal" class="text-gray-400 hover:text-gray-600">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                <p class="text-base text-gray-700 mt-2">Verstuur een bericht naar <strong id="message-artist-name"></strong></p>
            </div>
            <div class="p-6">
                <form id="send-message-form" class="space-y-4">
                    <div>
                        <label for="message-subject" class="block text-sm font-semibold text-gray-700 mb-2">Onderwerp</label>
                        <input id="message-subject" type="text" required
                            class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label for="message-text" class="block text-sm font-semibold text-gray-700 mb-2">Bericht</label>
                        <textarea id="message-text" rows="4" required
                            class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
                    </div>

                    <div id="message-error" class="hidden p-3 bg-red-100 text-red-700 rounded-xl text-sm"></div>
                    <div id="message-success" class="hidden p-3 bg-green-100 text-green-700 rounded-xl text-sm"></div>

                    <div class="flex justify-end space-x-3">
                        <button type="button" id="cancel-message-btn"
                            class="btn-press px-4 py-2 bg-gray-100 rounded-xl text-gray-700 hover:bg-gray-200 font-medium">
                            Annuleren
                        </button>
                        <button type="submit"
                            class="btn-press px-6 py-2 bg-indigo-600 text-white rounded-xl font-semibold hover:bg-indigo-700">
                            <i data-lucide="send" class="h-4 w-4 inline mr-2"></i>
                            Versturen
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Profile View Modal -->
    <div id="profile-view-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden items-center justify-center z-50 overflow-y-auto p-4">
        <div class="bg-white rounded-2xl shadow-xl max-w-2xl w-full my-8">
            <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-xl font-bold">Profiel</h3>
                <button id="close-profile-modal" class="text-gray-500 hover:text-gray-700">
                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div id="profile-modal-content" class="p-6">
                <!-- Profile content will be inserted here -->
            </div>
        </div>
    </div>

    <!-- User Settings Modal -->
    <div id="user-settings-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden items-center justify-center z-50 overflow-y-auto p-4">
        <div class="bg-white rounded-2xl shadow-xl max-w-lg w-full my-8">
            <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-xl font-bold">Account Instellingen</h3>
                <button id="close-settings-modal" class="text-gray-500 hover:text-gray-700">
                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div class="p-6 space-y-6">
                <!-- Language Selection -->
                <div class="border-b border-gray-200 pb-6">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Taal</label>
                    <select id="settings-language-select" class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="nl">Nederlands</option>
                        <option value="en">English</option>
                    </select>
                    <p class="mt-1 text-xs text-gray-500">Kies je voorkeurstaal voor de interface</p>
                </div>

                <!-- Change Email -->
                <div class="border-b border-gray-200 pb-6">
                    <h4 class="text-sm font-semibold text-gray-700 mb-3">Email Wijzigen</h4>
                    <div class="space-y-3">
                        <div>
                            <label for="settings-current-password-email" class="block text-xs text-gray-600 mb-1">Huidig Wachtwoord</label>
                            <input id="settings-current-password-email" type="password" class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <div>
                            <label for="settings-new-email" class="block text-xs text-gray-600 mb-1">Nieuw Email Adres</label>
                            <input id="settings-new-email" type="email" class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <button id="settings-update-email-btn" class="btn-press w-full bg-indigo-600 text-white px-4 py-3 rounded-xl hover:bg-indigo-700 font-semibold">Email Bijwerken</button>
                        <p id="settings-email-error" class="text-red-500 text-sm hidden"></p>
                        <p id="settings-email-success" class="text-green-600 text-sm hidden"></p>
                    </div>
                </div>

                <!-- Change Password -->
                <div>
                    <h4 class="text-sm font-semibold text-gray-700 mb-3">Wachtwoord Wijzigen</h4>
                    <div class="space-y-3">
                        <div>
                            <label for="settings-current-password-pw" class="block text-xs text-gray-600 mb-1">Huidig Wachtwoord</label>
                            <input id="settings-current-password-pw" type="password" class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <div>
                            <label for="settings-new-password" class="block text-xs text-gray-600 mb-1">Nieuw Wachtwoord</label>
                            <input id="settings-new-password" type="password" class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <div>
                            <label for="settings-confirm-password" class="block text-xs text-gray-600 mb-1">Bevestig Nieuw Wachtwoord</label>
                            <input id="settings-confirm-password" type="password" class="w-full px-4 py-3 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <button id="settings-update-password-btn" class="btn-press w-full bg-indigo-600 text-white px-4 py-3 rounded-xl hover:bg-indigo-700 font-semibold">Wachtwoord Bijwerken</button>
                        <p id="settings-password-error" class="text-red-500 text-sm hidden"></p>
                        <p id="settings-password-success" class="text-green-600 text-sm hidden"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module" src="/main.js"></script>

    <!-- Initialize Lucide Icons -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (window.lucide) {
                lucide.createIcons();
            }
        });
    </script>

</body>
</html>
</file>

</files>
